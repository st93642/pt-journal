{
  "id": "windows_ctf",
  "title": "Windows CTF",
  "description": "Comprehensive Windows Capture The Flag methodology covering Active Directory reconnaissance, PowerShell exploitation, credential dumping, privilege escalation, and lateral movement techniques for beginner to intermediate CTF players",
  "type": "tutorial",
  "steps": [
    {
      "id": "windows-ctf-lab-setup",
      "title": "Windows CTF lab setup and attacker/target preparation",
      "content": "OBJECTIVE: Establish a comprehensive Windows penetration testing environment with Active Directory domain controller, Windows targets, and Linux attacker machine configured with essential Windows exploitation tools.\n\nACADEMIC BACKGROUND:\nWindows CTF challenges require understanding of Active Directory architecture, Kerberos authentication, NTLM protocols, and Windows privilege models. MITRE ATT&CK framework documents Windows-specific techniques across tactics. According to Verizon DBIR, Windows systems remain primary targets in enterprise environments. NIST SP 800-123 provides Windows security guidance. Proper lab setup ensures safe, isolated practice without affecting production systems.\n\nSTEP-BY-STEP PROCESS:\n\n1. Virtual Machine Architecture Planning:\n```bash\n# Recommended lab topology:\n# Network: 192.168.100.0/24 (isolated virtual network)\n# - 192.168.100.10: Windows Server 2019 (Domain Controller \"DC01\")\n# - 192.168.100.20: Windows 10 Pro (Domain-joined workstation \"WS01\")\n# - 192.168.100.30: Windows Server 2019 (Member server \"SRV01\")\n# - 192.168.100.50: Kali Linux (Attacker machine)\n\n# Minimum requirements per VM:\n# DC01: 2 GB RAM, 60 GB disk, 1 CPU\n# WS01: 2 GB RAM, 40 GB disk, 1 CPU  \n# SRV01: 2 GB RAM, 40 GB disk, 1 CPU\n# Kali: 4 GB RAM, 40 GB disk, 2 CPUs\n\n# VirtualBox/VMware network configuration:\n# Create Internal/Host-Only network: vboxnet0 / VMnet2\n# All VMs on same isolated network\n# No internet access for Windows VMs (prevent updates/telemetry)\n```\n\n2. Windows Server 2019 Domain Controller Setup:\n```powershell\n# On DC01 (Windows Server 2019):\n# Set static IP address:\nNew-NetIPAddress -InterfaceAlias \"Ethernet\" -IPAddress 192.168.100.10 `\n    -PrefixLength 24 -DefaultGateway 192.168.100.1\nSet-DnsClientServerAddress -InterfaceAlias \"Ethernet\" `\n    -ServerAddresses 127.0.0.1\n\n# Set hostname:\nRename-Computer -NewName \"DC01\" -Restart\n\n# Install Active Directory Domain Services:\nInstall-WindowsFeature -Name AD-Domain-Services -IncludeManagementTools\n\n# Promote to Domain Controller:\nInstall-ADDSForest `\n    -DomainName \"ctf.local\" `\n    -DomainNetbiosName \"CTF\" `\n    -ForestMode \"WinThreshold\" `\n    -DomainMode \"WinThreshold\" `\n    -InstallDns:$true `\n    -SafeModeAdministratorPassword (ConvertTo-SecureString \"P@ssw0rd123!\" -AsPlainText -Force) `\n    -Force:$true\n\n# After reboot, create test users and groups:\nNew-ADUser -Name \"John Smith\" -SamAccountName \"jsmith\" `\n    -UserPrincipalName \"jsmith@ctf.local\" `\n    -AccountPassword (ConvertTo-SecureString \"Welcome2024!\" -AsPlainText -Force) `\n    -Enabled $true -PasswordNeverExpires $true\n\nNew-ADUser -Name \"Admin User\" -SamAccountName \"adm_backup\" `\n    -UserPrincipalName \"adm_backup@ctf.local\" `\n    -AccountPassword (ConvertTo-SecureString \"BackupAdmin2024!\" -AsPlainText -Force) `\n    -Enabled $true -PasswordNeverExpires $true\n\n# Add adm_backup to Backup Operators (interesting for privilege escalation):\nAdd-ADGroupMember -Identity \"Backup Operators\" -Members \"adm_backup\"\n\n# Create vulnerable service account (for Kerberoasting):\nNew-ADUser -Name \"SQL Service\" -SamAccountName \"svc_sql\" `\n    -ServicePrincipalName \"MSSQLSvc/srv01.ctf.local:1433\" `\n    -UserPrincipalName \"svc_sql@ctf.local\" `\n    -AccountPassword (ConvertTo-SecureString \"SQLService2020!\" -AsPlainText -Force) `\n    -Enabled $true -PasswordNeverExpires $true\n\n# Create computer accounts:\nNew-ADComputer -Name \"WS01\" -Path \"CN=Computers,DC=ctf,DC=local\"\nNew-ADComputer -Name \"SRV01\" -Path \"CN=Computers,DC=ctf,DC=local\"\n```\n\n3. Windows 10 Workstation Setup:\n```powershell\n# On WS01 (Windows 10 Pro):\n# Set static IP:\nNew-NetIPAddress -InterfaceAlias \"Ethernet\" -IPAddress 192.168.100.20 `\n    -PrefixLength 24 -DefaultGateway 192.168.100.1\nSet-DnsClientServerAddress -InterfaceAlias \"Ethernet\" `\n    -ServerAddresses 192.168.100.10\n\n# Set hostname:\nRename-Computer -NewName \"WS01\" -Restart\n\n# Join domain:\nAdd-Computer -DomainName \"ctf.local\" `\n    -Credential (Get-Credential) `\n    -Restart\n# Use CTF\\Administrator credentials\n\n# After joining, log in as domain user jsmith\n# Enable PSRemoting for exploitation practice:\nEnable-PSRemoting -Force\nSet-Item WSMan:\\localhost\\Client\\TrustedHosts -Value \"*\" -Force\n\n# Configure vulnerable settings (for CTF only!):\n# Disable Windows Defender:\nSet-MpPreference -DisableRealtimeMonitoring $true\nSet-MpPreference -DisableIOAVProtection $true\n\n# Disable Windows Firewall (for easier exploitation):\nSet-NetFirewallProfile -Profile Domain,Public,Private -Enabled False\n```\n\n4. Windows Server Member Server Setup:\n```powershell\n# On SRV01 (Windows Server 2019):\n# Similar to WS01, set IP 192.168.100.30, join domain\n# Install vulnerable services for CTF:\n\n# Install IIS with ASP.NET:\nInstall-WindowsFeature Web-Server,Web-Asp-Net45 -IncludeManagementTools\n\n# Create SMB shares with weak permissions:\nNew-Item -Path \"C:\\Shares\\Public\" -ItemType Directory\nNew-SmbShare -Name \"Public\" -Path \"C:\\Shares\\Public\" `\n    -FullAccess \"Everyone\"\n\n# Place flag file:\n\"flag{windows_smb_share_access}\" | Out-File \"C:\\Shares\\Public\\flag.txt\"\n\n# Enable WinRM:\nEnable-PSRemoting -Force\n```\n\n5. Kali Linux Attacker Setup:\n```bash\n# On Kali Linux (192.168.100.50):\n# Set static IP:\nsudo ip addr add 192.168.100.50/24 dev eth0\nsudo ip route add default via 192.168.100.1\n\n# Or using NetworkManager:\nsudo nmcli con mod \"Wired connection 1\" ipv4.addresses 192.168.100.50/24\nsudo nmcli con mod \"Wired connection 1\" ipv4.gateway 192.168.100.1\nsudo nmcli con mod \"Wired connection 1\" ipv4.dns 192.168.100.10\nsudo nmcli con mod \"Wired connection 1\" ipv4.method manual\nsudo nmcli con up \"Wired connection 1\"\n\n# Update and install Windows-specific tools:\nsudo apt update && sudo apt upgrade -y\n\n# Install Impacket (Python tools for Windows protocols):\nsudo apt install -y python3-impacket impacket-scripts\n\n# Verify Impacket tools:\nwhich psexec.py smbexec.py wmiexec.py secretsdump.py GetNPUsers.py GetUserSPNs.py\n\n# Install CrackMapExec (Swiss Army knife for Windows networks):\nsudo apt install -y crackmapexec\n\n# Install enum4linux-ng (improved SMB enumeration):\nsudo apt install -y enum4linux-ng\n\n# Install Responder (LLMNR/NBT-NS poisoning):\nsudo apt install -y responder\n\n# Install BloodHound (AD attack path analysis):\nsudo apt install -y bloodhound neo4j\n\n# Install Windows binaries for upload:\nsudo apt install -y powershell-empire starkiller\n\n# Install Rubeus (Kerberos exploitation) - Windows binary:\nwget https://github.com/r3motecontrol/Ghostpack-CompiledBinaries/raw/master/Rubeus.exe -O ~/tools/Rubeus.exe\n\n# Install winPEAS (Windows privilege escalation):\nwget https://github.com/carlospolop/PEASS-ng/releases/latest/download/winPEASx64.exe -O ~/tools/winPEASx64.exe\n\n# Install Mimikatz:\nmkdir -p ~/tools/mimikatz\ncd ~/tools/mimikatz\nwget https://github.com/gentilkiwi/mimikatz/releases/latest/download/mimikatz_trunk.zip\nunzip mimikatz_trunk.zip\n\n# Install SharpHound (BloodHound ingestor):\nwget https://github.com/BloodHoundAD/BloodHound/raw/master/Collectors/SharpHound.exe -O ~/tools/SharpHound.exe\n```\n\n6. Network Connectivity Verification:\n```bash\n# From Kali, verify connectivity to all Windows hosts:\nping -c 3 192.168.100.10  # DC01\nping -c 3 192.168.100.20  # WS01\nping -c 3 192.168.100.30  # SRV01\n\n# DNS resolution test:\nnslookup dc01.ctf.local 192.168.100.10\nnslookup ctf.local 192.168.100.10\n\n# Add to /etc/hosts for convenience:\necho \"192.168.100.10 dc01.ctf.local dc01 ctf.local\" | sudo tee -a /etc/hosts\necho \"192.168.100.20 ws01.ctf.local ws01\" | sudo tee -a /etc/hosts\necho \"192.168.100.30 srv01.ctf.local srv01\" | sudo tee -a /etc/hosts\n\n# SMB connectivity test:\nsmbclient -L //192.168.100.10 -N  # Null session\ncrackmapexec smb 192.168.100.0/24  # Network scan\n```\n\n7. Active Directory Vulnerable Configuration (CTF Scenarios):\n```powershell\n# On DC01, create intentional vulnerabilities for practice:\n\n# Scenario 1: AS-REP Roasting (user without Kerberos pre-authentication):\nNew-ADUser -Name \"Service Account\" -SamAccountName \"svc_backup\" `\n    -UserPrincipalName \"svc_backup@ctf.local\" `\n    -AccountPassword (ConvertTo-SecureString \"Backup2020!\" -AsPlainText -Force) `\n    -Enabled $true -PasswordNeverExpires $true\nSet-ADAccountControl -Identity \"svc_backup\" -DoesNotRequirePreAuth $true\n\n# Scenario 2: Weak password for brute-force:\nNew-ADUser -Name \"Temp User\" -SamAccountName \"tempuser\" `\n    -UserPrincipalName \"tempuser@ctf.local\" `\n    -AccountPassword (ConvertTo-SecureString \"Password123\" -AsPlainText -Force) `\n    -Enabled $true\n\n# Scenario 3: User with DCSync rights (for testing):\nAdd-ADGroupMember -Identity \"Domain Admins\" -Members \"adm_backup\"\n# Then remove from Domain Admins but add DCSync rights:\n$user = Get-ADUser adm_backup\n$acl = Get-Acl \"AD:\\DC=ctf,DC=local\"\n$sid = $user.SID\n$identity = [System.Security.Principal.IdentityReference] $sid\n$adRights = [System.DirectoryServices.ActiveDirectoryRights] \"GenericAll\"\n$type = [System.Security.AccessControl.AccessControlType] \"Allow\"\n$inheritanceType = [System.DirectoryServices.ActiveDirectorySecurityInheritance] \"All\"\n$ace = New-Object System.DirectoryServices.ActiveDirectoryAccessRule($identity,$adRights,$type,$inheritanceType)\n$acl.AddAccessRule($ace)\nSet-Acl -Path \"AD:\\DC=ctf,DC=local\" -AclObject $acl\n\n# Scenario 4: SMB share with passwords in files:\n\"admin:P@ssw0rd123!\" | Out-File \"C:\\Shares\\Public\\passwords.txt\"\n\"jsmith:Welcome2024!\" | Out-File -Append \"C:\\Shares\\Public\\passwords.txt\"\n```\n\n8. Workspace Organization on Kali:\n```bash\n# Create organized CTF workspace:\nmkdir -p ~/ctf/windows/{scans,enum,creds,loot,screenshots,tools,notes}\n\n# Create enumeration tracking file:\ncat > ~/ctf/windows/notes/checklist.md << 'EOF'\n# Windows CTF Enumeration Checklist\n\n## Network Enumeration\n- [ ] Port scanning (nmap)\n- [ ] SMB enumeration (enum4linux-ng, crackmapexec)\n- [ ] DNS enumeration\n- [ ] LDAP enumeration\n\n## User Enumeration\n- [ ] Username enumeration (kerbrute, enum4linux)\n- [ ] Valid credentials found\n- [ ] AS-REP roastable accounts identified\n- [ ] Kerberoastable accounts identified\n\n## Exploitation\n- [ ] Password spraying attempted\n- [ ] AS-REP roasting successful\n- [ ] Kerberoasting successful\n- [ ] Initial access gained\n\n## Post-Exploitation\n- [ ] Credential dumping (mimikatz, secretsdump.py)\n- [ ] BloodHound data collected\n- [ ] Privilege escalation path identified\n- [ ] Lateral movement performed\n\n## Flags Captured\n- [ ] Flag 1: \n- [ ] Flag 2:\n- [ ] Flag 3:\nEOF\n\n# Create automated enumeration script:\ncat > ~/ctf/windows/tools/auto_enum.sh << 'EOF'\n#!/bin/bash\nTARGET=$1\nDOMAIN=$2\n\nif [ -z \"$TARGET\" ] || [ -z \"$DOMAIN\" ]; then\n    echo \"Usage: $0 <target_ip> <domain>\"\n    exit 1\nfi\n\necho \"[+] Starting automated Windows enumeration\"\nOUTDIR=\"scans/$(date +%Y%m%d_%H%M%S)\"\nmkdir -p \"$OUTDIR\"\n\necho \"[*] Nmap scan...\"\nnmap -sV -sC -p- \"$TARGET\" -oA \"$OUTDIR/nmap_full\"\n\necho \"[*] SMB enumeration...\"\nenum4linux-ng \"$TARGET\" -A -C > \"$OUTDIR/enum4linux.txt\"\n\necho \"[*] CrackMapExec enumeration...\"\ncrackmapexec smb \"$TARGET\" --shares > \"$OUTDIR/cme_shares.txt\"\ncrackmapexec smb \"$TARGET\" --users > \"$OUTDIR/cme_users.txt\"\n\necho \"[*] Kerberos user enumeration...\"\nkerbrute userenum /usr/share/seclists/Usernames/Names/names.txt -d \"$DOMAIN\" --dc \"$TARGET\" > \"$OUTDIR/kerbrute.txt\"\n\necho \"[+] Enumeration complete. Results in $OUTDIR/\"\nEOF\nchmod +x ~/ctf/windows/tools/auto_enum.sh\n```\n\n9. Neo4j and BloodHound Configuration:\n```bash\n# Start Neo4j database for BloodHound:\nsudo neo4j console &\n# Default credentials: neo4j:neo4j (will prompt to change on first login)\n# Change to: neo4j:bloodhound (or your preference)\n\n# Wait for Neo4j to start (http://localhost:7474)\nsleep 10\n\n# Start BloodHound:\nbloodhound &\n\n# Configure BloodHound:\n# 1. Connect to database (bolt://localhost:7687)\n# 2. Credentials: neo4j:bloodhound\n# 3. Ready to import SharpHound data\n```\n\n10. Initial Environment Testing:\n```bash\n# Test 1: Verify SMB access to domain:\ncrackmapexec smb 192.168.100.10 -u '' -p ''  # Null session\ncrackmapexec smb 192.168.100.10 -u 'guest' -p ''  # Guest account\n\n# Test 2: Enumerate domain users:\nenum4linux-ng 192.168.100.10 -A\n\n# Test 3: Try known credentials:\ncrackmapexec smb 192.168.100.0/24 -u 'jsmith' -p 'Welcome2024!'\n\n# Test 4: Verify DNS:\ndig @192.168.100.10 ctf.local\n\n# Test 5: LDAP query:\nldapsearch -x -H ldap://192.168.100.10 -b \"DC=ctf,DC=local\"\n\n# Document findings:\ncat > ~/ctf/windows/notes/initial_test.txt << EOF\nEnvironment Test Results:\n- DC01 (192.168.100.10): Responding on ports 53, 88, 135, 139, 389, 445, 3389\n- WS01 (192.168.100.20): Responding on ports 135, 139, 445, 5985 (WinRM)\n- SRV01 (192.168.100.30): Responding on ports 80, 135, 139, 445\n- Domain: ctf.local\n- Users discovered: jsmith, adm_backup, svc_sql, svc_backup, tempuser\n- Null session: Enabled (intentional for CTF)\n- Guest account: Enabled\nEOF\n```\n\nWHAT TO LOOK FOR:\n- **Virtual network isolation**: Ensure no accidental connection to production networks\n- **Domain controller operational**: AD DS service running, DNS functioning\n- **Domain-joined machines**: Successfully authenticated to ctf.local domain\n- **Tool availability on Kali**: All Impacket, CrackMapExec, BloodHound tools installed\n- **Network connectivity**: Bi-directional communication between Kali and Windows hosts\n- **Vulnerable configurations**: Intentional misconfigurations present for exploitation practice\n- **Service availability**: SMB (445), WinRM (5985), RDP (3389), Kerberos (88) accessible\n\nSECURITY IMPLICATIONS:\n- **Isolated Environment Critical**: Lab must never connect to production Active Directory\n- **Weak Passwords Intentional**: Real environments require strong password policies (NIST 800-63B)\n- **Disabled Security Features**: Defender, Firewall disabled for learning; violates production security\n- **Open Shares**: \"Everyone\" permissions demonstrate CIS Control 14 violations\n- **AS-REP Roasting**: Pre-auth disabled users violate Microsoft security baselines\n- **Legal Practice Only**: Skills learned must only be applied to authorized testing environments\n\nCOMMON PITFALLS:\n- **Insufficient RAM**: Domain controller with <2 GB RAM performs poorly\n- **Network configuration errors**: Wrong network adapter settings prevent DC communication\n- **DNS misconfiguration**: Clients not pointing to DC for DNS causes domain join failures\n- **Firewall blocking**: Even with Windows Firewall off, hypervisor firewall may block traffic\n- **Licensing issues**: Windows Server requires evaluation license or paid license\n- **Snapshot before exploitation**: Forgetting to snapshot VMs before testing makes reset difficult\n- **Tool version mismatches**: Outdated Impacket or CME may have compatibility issues\n- **Time synchronization**: Kerberos requires synchronized clocks (within 5 minutes)\n\nTOOLS REFERENCE:\n- **VirtualBox**: https://www.virtualbox.org/ (Free hypervisor)\n- **VMware Workstation**: https://www.vmware.com/products/workstation-pro.html (Commercial hypervisor)\n- **Windows Server Evaluation**: https://www.microsoft.com/en-us/evalcenter/evaluate-windows-server-2019 (180-day trial)\n- **Windows 10 Enterprise Evaluation**: https://www.microsoft.com/en-us/evalcenter/evaluate-windows-10-enterprise (90-day trial)\n- **Impacket**: https://github.com/fortra/impacket (Python Windows protocol library)\n- **CrackMapExec**: https://github.com/Porchetta-Industries/CrackMapExec (Network assessment tool)\n- **BloodHound**: https://github.com/BloodHoundAD/BloodHound (AD attack path tool)\n- **Rubeus**: https://github.com/GhostPack/Rubeus (Kerberos abuse toolkit)\n- **winPEAS**: https://github.com/carlospolop/PEASS-ng (Windows privilege escalation enumeration)\n\nFURTHER READING:\n- Active Directory Security: https://adsecurity.org/\n- HackTricks Windows: https://book.hacktricks.xyz/windows-hardening/\n- Microsoft Security Baselines: https://learn.microsoft.com/en-us/windows/security/operating-system-security/device-management/windows-security-configuration-framework/windows-security-baselines\n- MITRE ATT&CK Windows: https://attack.mitre.org/matrices/enterprise/windows/\n- NIST SP 800-123 Windows Security: https://csrc.nist.gov/publications/detail/sp/800-123/final\n- PentestLab Windows Attacks: https://pentestlab.blog/category/red-team/",
      "tags": [
        "windows",
        "ctf",
        "lab-setup",
        "active-directory",
        "kali-linux"
      ]
    },
    {
      "id": "active-directory-enum",
      "title": "Active Directory enumeration and reconnaissance",
      "content": "OBJECTIVE: Test content for step 2",
      "tags": [
        "windows",
        "active-directory",
        "enumeration",
        "reconnaissance",
        "ldap"
      ]
    }
  ]
}