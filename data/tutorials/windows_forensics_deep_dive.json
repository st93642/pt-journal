{
  "id": "windows_forensics_deep_dive",
  "title": "Windows Forensics Deep Dive",
  "description": "Comprehensive Windows forensics covering NTFS analysis, evidence acquisition, registry forensics, and critical Windows artifact locations.",
  "type": "tutorial",
  "steps": [
    {
      "id": "ntfs_deep_analysis",
      "title": "NTFS Deep Analysis",
      "content": "OBJECTIVE: Master advanced NTFS forensic analysis including MFT parsing, alternate data streams, and journal analysis.\n\nACADEMIC BACKGROUND:\nNTFS (New Technology File System) is the primary file system for Windows. Its complex metadata structures provide rich forensic artifacts. Understanding NTFS internals enables recovery of deleted files, detection of hidden data, and reconstruction of user activity through journaling.\n\nNTFS INTERNALS:\n\n1. MFT DETAILED ANALYSIS:\n   ```\n   MFT Record Structure (1024 bytes typical):\n   \n   Header (42 bytes):\n   Offset  Size  Field\n   0x00    4     Signature (\"FILE\")\n   0x04    2     Offset to fixup array\n   0x06    2     Entries in fixup array\n   0x08    8     $LogFile Sequence Number (LSN)\n   0x10    2     Sequence number\n   0x12    2     Link count\n   0x14    2     Offset to first attribute\n   0x16    2     Flags (0x01=in use, 0x02=directory)\n   0x18    4     Used size of MFT entry\n   0x1C    4     Allocated size of entry\n   0x20    8     Base file record (0 if base)\n   0x28    2     Next attribute ID\n   \n   Common Attributes:\n   | Type | Name | Purpose |\n   |------|------|--------|\n   | 0x10 | $STANDARD_INFORMATION | Timestamps, flags |\n   | 0x30 | $FILE_NAME | Filename, parent ref |\n   | 0x40 | $OBJECT_ID | Unique identifier |\n   | 0x50 | $SECURITY_DESCRIPTOR | ACL |\n   | 0x60 | $VOLUME_NAME | Volume label |\n   | 0x70 | $VOLUME_INFORMATION | Version |\n   | 0x80 | $DATA | File content |\n   | 0x90 | $INDEX_ROOT | Directory index |\n   | 0xA0 | $INDEX_ALLOCATION | Large directory index |\n   | 0xB0 | $BITMAP | Allocation bitmap |\n   | 0xC0 | $REPARSE_POINT | Symbolic link |\n   | 0xD0 | $EA_INFORMATION | Extended attributes |\n   | 0xE0 | $EA | Extended attribute data |\n   ```\n\n2. MFT EXTRACTION AND PARSING:\n   ```bash\n   # Extract MFT from mounted image\n   icat -o 2048 /forensics/evidence.dd 0 > /forensics/MFT\n   \n   # Or using FTK Imager\n   # Navigate to [root] > $MFT > Export\n   \n   # Parse MFT with analyzeMFT\n   python analyzeMFT.py -f /forensics/MFT -o /forensics/mft.csv\n   \n   # Parse with MFTECmd (Zimmerman tools)\n   MFTECmd.exe -f /forensics/MFT --csv /forensics/ --csvf mft_output.csv\n   \n   # Output columns include:\n   # - Entry number\n   # - Sequence number\n   # - Parent entry\n   # - Filename\n   # - $SI timestamps (MACE)\n   # - $FN timestamps (MACE)\n   # - Size\n   # - Flags\n   ```\n\n3. TIMESTAMP ANALYSIS:\n   ```\n   NTFS Timestamp Types (MACE):\n   \n   M - Modified: Content last changed\n   A - Accessed: Last read/executed\n   C - Changed: MFT entry modified\n   E - Entry created: File created (Birth time)\n   \n   $STANDARD_INFORMATION vs $FILE_NAME:\n   \n   $SI Timestamps:\n   - Updated by OS and applications\n   - Can be easily modified by tools\n   - Used for display in Explorer\n   \n   $FN Timestamps:\n   - Harder to modify directly\n   - Updated less frequently\n   - More reliable for forensics\n   \n   Timestamp Discrepancy Detection:\n   ```bash\n   # Compare SI vs FN timestamps\n   python analyzeMFT.py -f /forensics/MFT -o /forensics/mft.csv\n   \n   # Look for:\n   # - $SI Created < $FN Created (backdating)\n   # - $SI times identical (timestomping tool)\n   # - $FN times from distant past but $SI recent\n   \n   # Using MFTECmd\n   MFTECmd.exe -f /forensics/MFT --csv /forensics/ --csvf mft.csv\n   # Import CSV and compare Created0x10 vs Created0x30\n   ```\n\n4. ALTERNATE DATA STREAMS:\n   ```bash\n   # List ADS in NTFS\n   # Live system\n   dir /r C:\\Users\\\n   Get-Item -Path C:\\file.txt -Stream *\n   \n   # From forensic image using TSK\n   fls -r -o 2048 /forensics/evidence.dd | grep \"\\$DATA\"\n   \n   # Extract ADS content\n   icat -o 2048 /forensics/evidence.dd <inode>:<stream_name>\n   \n   # Common legitimate ADS:\n   # Zone.Identifier - Download source\n   # SmartScreen - Windows Defender data\n   # $EA, $OBJECT_ID - System metadata\n   \n   # Zone.Identifier contents:\n   # [ZoneTransfer]\n   # ZoneId=3\n   # ReferrerUrl=https://source.com/\n   # HostUrl=https://download.com/file.exe\n   \n   # Zone IDs:\n   # 0 - Local Machine\n   # 1 - Intranet\n   # 2 - Trusted\n   # 3 - Internet\n   # 4 - Untrusted\n   ```\n\n5. $USNJRNL ANALYSIS:\n   ```bash\n   # USN Journal tracks all file changes\n   \n   # Extract $UsnJrnl:$J\n   icat -o 2048 /forensics/evidence.dd <$Extend_inode>-128-<$J_attr_id> > /forensics/UsnJrnl\n   \n   # Using fsutil on live system\n   fsutil usn readjournal C: csv > usn.csv\n   \n   # Parse with usn.py\n   python usn.py -f /forensics/UsnJrnl -o /forensics/usn_parsed.csv\n   \n   # Using MFTECmd\n   MFTECmd.exe -f /forensics/UsnJrnl --csv /forensics/ --csvf usn.csv\n   \n   # USN Reason Codes:\n   | Code | Meaning |\n   |------|--------|\n   | 0x00000001 | DATA_OVERWRITE |\n   | 0x00000002 | DATA_EXTEND |\n   | 0x00000004 | DATA_TRUNCATION |\n   | 0x00000100 | FILE_CREATE |\n   | 0x00000200 | FILE_DELETE |\n   | 0x00001000 | RENAME_OLD_NAME |\n   | 0x00002000 | RENAME_NEW_NAME |\n   | 0x00080000 | SECURITY_CHANGE |\n   ```\n\n6. $LOGFILE ANALYSIS:\n   ```bash\n   # $LogFile contains transaction log\n   \n   # Extract $LogFile\n   icat -o 2048 /forensics/evidence.dd 2 > /forensics/LogFile\n   \n   # Parse with LogFileParser\n   python LogFileParser.py -f /forensics/LogFile -o /forensics/logfile_parsed.csv\n   \n   # Contains:\n   # - Recent file operations\n   # - Recovery information\n   # - Deleted file metadata (sometimes)\n   ```\n\n7. DELETED FILE RECOVERY:\n   ```bash\n   # List deleted files\n   fls -r -d -o 2048 /forensics/evidence.dd\n   # * indicates deleted\n   \n   # Recover by inode\n   icat -o 2048 /forensics/evidence.dd <inode> > /forensics/recovered_file\n   \n   # Bulk recovery\n   tsk_recover -o 2048 /forensics/evidence.dd /forensics/recovered/\n   \n   # Recovery from unallocated space\n   blkls -o 2048 /forensics/evidence.dd > /forensics/unalloc.bin\n   foremost -i /forensics/unalloc.bin -o /forensics/carved/\n   ```\n\nFORENSIC REPORT:\n```\nNTFS Analysis Findings:\n\nFile System: NTFS 3.1\nCluster Size: 4096 bytes\nMFT Entries: 245,678\n\n$MFT Analysis:\n- Total files: 245,678\n- Deleted entries: 12,456\n- Entries with ADS: 34,567\n\nTimestamp Anomalies Detected:\n| File | Issue | Details |\n|------|-------|--------|\n| payload.exe | Backdating | $SI: 2020-01-01, $FN: 2024-03-14 |\n| report.docx | Timestomping | All $SI identical to second |\n\nAlternate Data Streams:\n| File | Stream | Size | Content |\n|------|--------|------|--------|\n| document.pdf | :hidden | 45KB | Encrypted data |\n| image.jpg | :Zone.Identifier | 152B | Internet download |\n\n$UsnJrnl Analysis:\n- Journal entries: 1,245,678\n- File creations: 23,456\n- File deletions: 12,345\n- Mass deletion event detected: 2024-03-15 08:00-08:30\n```\n\nDETECTION INDICATORS:\n- MFT fully parsed\n- Timestamp discrepancies identified\n- ADS examined\n- USN Journal analyzed\n\nCOMMON PITFALLS:\n- Missing $FN timestamp comparison\n- Not checking for ADS\n- Ignoring USN Journal\n- Incomplete deleted file recovery\n\nFURTHER READING:\n- Brian Carrier's \"File System Forensic Analysis\"\n- NTFS.com documentation\n- Microsoft NTFS technical reference",
      "tags": ["forensics", "ntfs", "mft", "windows", "file-system", "dfir"],
      "related_tools": ["strings", "xxd", "foremost", "scalpel"]
    },
    {
      "id": "windows_acquisition_methods",
      "title": "Windows Acquisition Methods",
      "content": "OBJECTIVE: Master Windows-specific acquisition techniques for various scenarios including live systems, encrypted volumes, and virtual machines.\n\nACADEMIC BACKGROUND:\nWindows acquisition requires consideration of encryption (BitLocker), memory acquisition for volatile data, and proper handling of running systems. The acquisition strategy depends on system state, encryption status, and investigation requirements.\n\nACQUISITION SCENARIOS:\n\n1. LIVE WINDOWS ACQUISITION:\n   ```powershell\n   # When to acquire live:\n   # - Full disk encryption (BitLocker)\n   # - Server that can't be shut down\n   # - Need volatile data (memory)\n   # - Active intrusion investigation\n   \n   # Check BitLocker status\n   manage-bde -status\n   Get-BitLockerVolume\n   \n   # FTK Imager (GUI - most common)\n   # File > Create Disk Image\n   # Select Physical Drive\n   # Choose E01 format with compression\n   \n   # FTK Imager CLI\n   ftkimager \\\\.\\PHYSICALDRIVE0 E:\\forensics\\evidence --e01 --verify\n   \n   # Memory acquisition first (if encrypted)\n   winpmem_mini_x64.exe E:\\forensics\\memory.raw\n   ```\n\n2. BITLOCKER HANDLING:\n   ```powershell\n   # BitLocker encryption states\n   # - Fully encrypted: Need key or memory\n   # - Decrypted (suspended): Can image normally\n   # - Unlocked (mounted): Acquire logical + memory\n   \n   # Check protection status\n   manage-bde -status C:\n   \n   # If unlocked but encrypted:\n   # 1. Acquire memory first (contains key)\n   # 2. Acquire logical image of unlocked volume\n   # 3. Acquire physical for encrypted blocks\n   \n   # Recovery key locations:\n   # - Microsoft account (cloud)\n   # - Active Directory (domain)\n   # - USB drive (user saved)\n   # - Printed (user printed)\n   # - Azure AD (enterprise)\n   \n   # Extract key from memory (using memory dump)\n   volatility -f memory.raw --profile=Win10x64 bitlocker\n   \n   # Or use Elcomsoft Forensic Disk Decryptor\n   ```\n\n3. DEAD ACQUISITION:\n   ```bash\n   # System powered off - standard forensic imaging\n   \n   # Boot from forensic USB (CAINE, Paladin)\n   # Drives mounted read-only by default\n   \n   # Using dc3dd (Linux forensic boot)\n   dc3dd if=/dev/sda hof=/forensics/evidence.dd hash=sha256 \\\n         log=/forensics/acquisition.log\n   \n   # Using ewfacquire for E01\n   ewfacquire /dev/sda -t /forensics/evidence -c best -S 2G\n   \n   # Verify hash\n   dc3dd if=/forensics/evidence.dd hash=sha256\n   ```\n\n4. VSS (VOLUME SHADOW COPY) ACQUISITION:\n   ```powershell\n   # List shadow copies\n   vssadmin list shadows\n   \n   # Create symbolic link to access shadow copy\n   mklink /d C:\\ShadowAccess \\\\?\\GLOBALROOT\\Device\\HarddiskVolumeShadowCopy1\\\n   \n   # Access previous file versions\n   dir C:\\ShadowAccess\\Users\\*\n   \n   # Using vshadowmount (Linux)\n   vshadowinfo /forensics/evidence.dd\n   vshadowmount /forensics/evidence.dd /mnt/vss/\n   ls /mnt/vss/vss1/\n   \n   # Arsenal Image Mounter (Windows)\n   # Can mount E01 and access VSS\n   ```\n\n5. TRIAGE ACQUISITION:\n   ```powershell\n   # Fast collection of critical artifacts\n   # When full acquisition not possible\n   \n   # KAPE (Kroll Artifact Parser and Extractor)\n   kape.exe --tsource C: --tdest E:\\triage --target KapeTriage\n   \n   # Targets include:\n   # - Registry hives\n   # - Event logs\n   # - Prefetch\n   # - Browser data\n   # - $MFT\n   # - $UsnJrnl\n   # - Amcache\n   # - SRUM\n   \n   # CyLR (Cyber Triage)\n   CyLR.exe -od E:\\collection -of hostname_collection.zip\n   \n   # Velociraptor (enterprise)\n   velociraptor.exe artifacts collect Windows.KapeFiles.Targets\n   ```\n\n6. REMOTE ACQUISITION:\n   ```powershell\n   # Using F-Response or similar\n   # Presents remote disk as local\n   \n   # PowerShell remoting for triage\n   Enter-PSSession -ComputerName TARGET\n   # Collect artifacts via WMI/WinRM\n   \n   # Using Velociraptor\n   # Deploy agent to endpoints\n   # Collect artifacts centrally\n   \n   # Using WMIC for remote info\n   wmic /node:TARGET process list full\n   wmic /node:TARGET startup list full\n   ```\n\n7. VIRTUAL MACHINE ACQUISITION:\n   ```bash\n   # VMware\n   # Suspend VM, copy files:\n   # - .vmx (config)\n   # - .vmdk (disk)\n   # - .vmem (memory if suspended)\n   # - .vmsn (snapshot)\n   \n   # Convert VMDK to raw\n   qemu-img convert -O raw disk.vmdk disk.raw\n   \n   # Hyper-V\n   # Export VM or copy:\n   # - .vhdx (disk)\n   # - .xml (config)\n   # - Checkpoint files\n   \n   # Mount VHDX (Windows)\n   Mount-VHD -Path \"C:\\VMs\\disk.vhdx\" -ReadOnly\n   \n   # VirtualBox\n   # Copy:\n   # - .vdi (disk)\n   # - .vbox (config)\n   \n   # Convert VDI to raw\n   VBoxManage clonehd disk.vdi disk.raw --format RAW\n   ```\n\n8. ACQUISITION DOCUMENTATION:\n   ```\n   Windows Acquisition Form:\n   \n   Case: 2024-FORENSIC-001\n   Date: 2024-03-15\n   \n   System Information:\n   Computer Name: WORKSTATION-01\n   OS: Windows 10 Pro 22H2 (Build 19045)\n   Hardware: Dell Latitude 5520\n   Serial: ABC123XYZ\n   \n   Storage:\n   - Disk 0: Samsung SSD 970 EVO 500GB\n     - Partition 1: EFI (100MB)\n     - Partition 2: MSR (16MB)\n     - Partition 3: Windows C: (465GB, BitLocker)\n   \n   Encryption Status:\n   - C: BitLocker ENABLED (unlocked at acquisition)\n   - Recovery Key ID: 12345678-...\n   \n   Acquisition Method:\n   - Memory: WinPmem 4.0\n   - Disk: FTK Imager 4.7 (E01, compression 6)\n   - Logical: Mounted BitLocker volume\n   \n   Files Created:\n   - memory.raw (16GB) - SHA256: abc123...\n   - evidence.E01 (series) - SHA256: def456...\n   \n   Notes:\n   - System was running at acquisition\n   - User logged in (session preserved in memory)\n   - Chrome browser open with multiple tabs\n   ```\n\nDETECTION INDICATORS:\n- Encryption status documented\n- Memory acquired when needed\n- VSS examined\n- Proper chain of custody\n\nCOMMON PITFALLS:\n- Acquiring encrypted drive without key/memory\n- Missing Volume Shadow Copies\n- Not documenting BitLocker status\n- Forgetting memory on live systems\n\nFURTHER READING:\n- SANS Windows Forensic Analysis\n- FTK Imager User Guide\n- BitLocker recovery documentation",
      "tags": ["forensics", "windows", "acquisition", "bitlocker", "vss", "dfir"],
      "related_tools": ["bulk_extractor"]
    },
    {
      "id": "registry_forensics",
      "title": "Registry Forensics",
      "content": "OBJECTIVE: Extract and analyze Windows Registry hives to recover system configuration, user activity, and evidence of malicious activity.\n\nACADEMIC BACKGROUND:\nThe Windows Registry is a hierarchical database storing system and user configuration. It contains evidence of installed software, user activity, network connections, USB devices, and malware persistence. Registry forensics is essential for Windows investigations.\n\nREGISTRY FUNDAMENTALS:\n\n1. REGISTRY HIVE LOCATIONS:\n   ```\n   System Hives (C:\\Windows\\System32\\config\\):\n   | Hive | Registry Path | Purpose |\n   |------|--------------|--------|\n   | SAM | HKLM\\SAM | User accounts |\n   | SECURITY | HKLM\\SECURITY | Security settings |\n   | SOFTWARE | HKLM\\SOFTWARE | Installed software |\n   | SYSTEM | HKLM\\SYSTEM | System config |\n   | DEFAULT | HKU\\.DEFAULT | Default user |\n   \n   User Hives:\n   | Location | Registry Path | Purpose |\n   |----------|--------------|--------|\n   | NTUSER.DAT | HKCU | User settings |\n   | UsrClass.dat | HKCU\\Software\\Classes | User classes |\n   \n   Paths:\n   - NTUSER.DAT: C:\\Users\\<user>\\NTUSER.DAT\n   - UsrClass.dat: C:\\Users\\<user>\\AppData\\Local\\Microsoft\\Windows\\UsrClass.dat\n   ```\n\n2. EXTRACTING REGISTRY HIVES:\n   ```bash\n   # From forensic image\n   icat -o 2048 /forensics/evidence.dd <inode> > /forensics/registry/SAM\n   \n   # Using FTK Imager\n   # Navigate to: Windows\\System32\\config\\\n   # Export: SAM, SECURITY, SOFTWARE, SYSTEM\n   \n   # Live system (requires admin)\n   reg save HKLM\\SAM C:\\forensics\\SAM\n   reg save HKLM\\SYSTEM C:\\forensics\\SYSTEM\n   reg save HKLM\\SOFTWARE C:\\forensics\\SOFTWARE\n   reg save HKLM\\SECURITY C:\\forensics\\SECURITY\n   \n   # Copy user hives\n   copy C:\\Users\\*\\NTUSER.DAT C:\\forensics\\users\\\n   copy C:\\Users\\*\\AppData\\Local\\Microsoft\\Windows\\UsrClass.dat C:\\forensics\\users\\\n   ```\n\n3. REGRIPPER ANALYSIS:\n   ```bash\n   # RegRipper - automated registry parsing\n   \n   # Run all plugins on SYSTEM hive\n   rip.pl -r /forensics/SYSTEM -f system > /forensics/system_report.txt\n   \n   # Run all plugins on SOFTWARE hive\n   rip.pl -r /forensics/SOFTWARE -f software > /forensics/software_report.txt\n   \n   # Run all plugins on NTUSER.DAT\n   rip.pl -r /forensics/NTUSER.DAT -f ntuser > /forensics/ntuser_report.txt\n   \n   # Run specific plugin\n   rip.pl -r /forensics/SYSTEM -p compname\n   rip.pl -r /forensics/SYSTEM -p timezone\n   rip.pl -r /forensics/NTUSER.DAT -p userassist\n   \n   # Key plugins:\n   # system: compname, timezone, shutdown, usbstor\n   # software: profilelist, run, uninstall, services\n   # ntuser: userassist, recentdocs, typedpaths, runmru\n   # sam: samparse (user accounts)\n   ```\n\n4. KEY FORENSIC ARTIFACTS:\n   ```bash\n   # Autostart Locations (Persistence)\n   # HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run\n   # HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\RunOnce\n   # HKCU\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run\n   # HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\n   \n   rip.pl -r /forensics/SOFTWARE -p run\n   rip.pl -r /forensics/NTUSER.DAT -p run\n   \n   # USB Device History\n   # HKLM\\SYSTEM\\CurrentControlSet\\Enum\\USBSTOR\n   # HKLM\\SYSTEM\\CurrentControlSet\\Enum\\USB\n   \n   rip.pl -r /forensics/SYSTEM -p usbstor\n   rip.pl -r /forensics/SYSTEM -p usbdevices\n   \n   # Network Connections\n   # HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\NetworkList\\Signatures\n   # HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\NetworkList\\Profiles\n   \n   rip.pl -r /forensics/SOFTWARE -p networklist\n   \n   # Recent Documents\n   # HKCU\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Explorer\\RecentDocs\n   \n   rip.pl -r /forensics/NTUSER.DAT -p recentdocs\n   ```\n\n5. USER ACTIVITY RECONSTRUCTION:\n   ```bash\n   # UserAssist (Program execution with ROT13 encoding)\n   # HKCU\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Explorer\\UserAssist\n   \n   rip.pl -r /forensics/NTUSER.DAT -p userassist\n   \n   # RecentDocs (MRU lists)\n   rip.pl -r /forensics/NTUSER.DAT -p recentdocs\n   \n   # TypedPaths (Explorer address bar)\n   rip.pl -r /forensics/NTUSER.DAT -p typedpaths\n   \n   # TypedURLs (IE/Edge address bar)\n   rip.pl -r /forensics/NTUSER.DAT -p typedurls\n   \n   # RunMRU (Run dialog)\n   rip.pl -r /forensics/NTUSER.DAT -p runmru\n   \n   # LastVisitedMRU (Open/Save dialogs)\n   rip.pl -r /forensics/NTUSER.DAT -p comdlg32\n   \n   # WordWheelQuery (Explorer search)\n   rip.pl -r /forensics/NTUSER.DAT -p wordwheelquery\n   ```\n\n6. SYSTEM INFORMATION:\n   ```bash\n   # Computer Name\n   rip.pl -r /forensics/SYSTEM -p compname\n   \n   # Timezone\n   rip.pl -r /forensics/SYSTEM -p timezone\n   \n   # Last Shutdown\n   rip.pl -r /forensics/SYSTEM -p shutdown\n   \n   # Installed Software\n   rip.pl -r /forensics/SOFTWARE -p uninstall\n   \n   # Services\n   rip.pl -r /forensics/SYSTEM -p services\n   \n   # User Accounts\n   rip.pl -r /forensics/SAM -p samparse\n   ```\n\n7. SHELLBAGS ANALYSIS:\n   ```bash\n   # Shellbags track folder access\n   # Even deleted folders leave traces\n   \n   # Location: UsrClass.dat\n   # HKCU\\Software\\Classes\\Local Settings\\Software\\Microsoft\\Windows\\Shell\\BagMRU\n   # HKCU\\Software\\Classes\\Local Settings\\Software\\Microsoft\\Windows\\Shell\\Bags\n   \n   # Using ShellBags Explorer (Zimmerman)\n   SBECmd.exe -d /forensics/users --csv /forensics/ --csvf shellbags.csv\n   \n   # Using RegRipper\n   rip.pl -r /forensics/UsrClass.dat -p shellbags\n   \n   # Reveals:\n   # - Folders accessed (including network/USB)\n   # - First and last access times\n   # - Folder window positions\n   # - Access to deleted folders\n   ```\n\n8. AMCACHE AND SHIMCACHE:\n   ```bash\n   # Application Compatibility Cache (Shimcache)\n   # HKLM\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\\AppCompatCache\n   # Tracks program execution\n   \n   rip.pl -r /forensics/SYSTEM -p shimcache\n   \n   # Or use AppCompatCacheParser\n   AppCompatCacheParser.exe -f /forensics/SYSTEM --csv /forensics/\n   \n   # Amcache.hve\n   # C:\\Windows\\AppCompat\\Programs\\Amcache.hve\n   # Contains SHA1 hashes of executables\n   \n   AmcacheParser.exe -f /forensics/Amcache.hve --csv /forensics/\n   \n   # Provides:\n   # - SHA1 hash of executables\n   # - Full path\n   # - First execution time\n   # - Compiler timestamp\n   ```\n\n9. COMPREHENSIVE REGISTRY SCRIPT:\n   ```bash\n   #!/bin/bash\n   # Registry forensics extraction script\n   \n   REGISTRY_DIR=\"$1\"\n   OUTPUT=\"$2\"\n   mkdir -p \"$OUTPUT\"\n   \n   echo \"[*] Processing SYSTEM hive...\"\n   rip.pl -r \"$REGISTRY_DIR/SYSTEM\" -f system > \"$OUTPUT/system.txt\"\n   \n   echo \"[*] Processing SOFTWARE hive...\"\n   rip.pl -r \"$REGISTRY_DIR/SOFTWARE\" -f software > \"$OUTPUT/software.txt\"\n   \n   echo \"[*] Processing SAM hive...\"\n   rip.pl -r \"$REGISTRY_DIR/SAM\" -f sam > \"$OUTPUT/sam.txt\"\n   \n   echo \"[*] Processing SECURITY hive...\"\n   rip.pl -r \"$REGISTRY_DIR/SECURITY\" -f security > \"$OUTPUT/security.txt\"\n   \n   for ntuser in \"$REGISTRY_DIR\"/NTUSER.DAT*; do\n       user=$(basename \"$ntuser\")\n       echo \"[*] Processing $user...\"\n       rip.pl -r \"$ntuser\" -f ntuser > \"$OUTPUT/${user}_ntuser.txt\"\n   done\n   \n   echo \"[*] Generating summary...\"\n   echo \"=== Registry Forensics Summary ===\" > \"$OUTPUT/summary.txt\"\n   \n   echo \"\\n--- Computer Name ---\" >> \"$OUTPUT/summary.txt\"\n   rip.pl -r \"$REGISTRY_DIR/SYSTEM\" -p compname >> \"$OUTPUT/summary.txt\"\n   \n   echo \"\\n--- Autostart Programs ---\" >> \"$OUTPUT/summary.txt\"\n   rip.pl -r \"$REGISTRY_DIR/SOFTWARE\" -p run >> \"$OUTPUT/summary.txt\"\n   \n   echo \"\\n--- USB Devices ---\" >> \"$OUTPUT/summary.txt\"\n   rip.pl -r \"$REGISTRY_DIR/SYSTEM\" -p usbstor >> \"$OUTPUT/summary.txt\"\n   \n   echo \"[*] Complete. Output in $OUTPUT\"\n   ```\n\nREGISTRY ANALYSIS REPORT:\n```\nRegistry Forensics Report:\n\nSystem: WORKSTATION-01\nTimezone: Eastern Standard Time (UTC-5)\nLast Shutdown: 2024-03-15 17:30:45\n\nUser Accounts (SAM):\n| Username | RID | Last Login | Password Hint |\n|----------|-----|------------|---------------|\n| Administrator | 500 | 2024-01-15 | - |\n| jsmith | 1001 | 2024-03-15 | \"pet name\" |\n\nAutostart Programs (Persistence):\n| Location | Name | Command |\n|----------|------|--------|\n| HKLM\\Run | SecurityUpdate | C:\\Users\\Public\\update.exe |\n| HKCU\\Run | Dropbox | C:\\Program Files\\Dropbox\\... |\n\nUSB Device History:\n| Device | Serial | First Connected | Last Connected |\n|--------|--------|-----------------|----------------|\n| SanDisk Cruzer | 4C530001234567 | 2024-03-01 | 2024-03-14 |\n| Seagate Backup | ABC123 | 2023-12-15 | 2024-03-10 |\n\nSuspicious Findings:\n1. Unknown autostart: C:\\Users\\Public\\update.exe\n   - Not in legitimate software list\n   - Added: 2024-03-14 09:45:00\n\n2. USB device connected during incident window\n   - SanDisk Cruzer: 2024-03-14 08:00-08:30\n\n3. Shellbags show access to:\n   - E:\\ (USB drive)\n   - C:\\Confidential\\ (sensitive folder)\n```\n\nDETECTION INDICATORS:\n- All hives extracted and parsed\n- Autostart locations checked\n- USB history analyzed\n- User activity reconstructed\n\nCOMMON PITFALLS:\n- Missing user hives (NTUSER.DAT)\n- Not analyzing UsrClass.dat (Shellbags)\n- Ignoring Amcache/Shimcache\n- Not correlating with timeline\n\nFURTHER READING:\n- RegRipper documentation\n- Eric Zimmerman tools\n- SANS Windows Registry Analysis",
      "tags": ["forensics", "windows", "registry", "artifacts", "persistence", "dfir"],
      "related_tools": ["bulk_extractor", "strings"]
    },
    {
      "id": "windows_artifact_locations",
      "title": "Windows Artifact Locations",
      "content": "OBJECTIVE: Identify and analyze critical Windows forensic artifacts beyond the registry including event logs, prefetch, SRUM, and browser data.\n\nACADEMIC BACKGROUND:\nWindows stores evidence across numerous locations. Understanding where artifacts reside and what they contain enables comprehensive investigation. This includes execution evidence, user activity, network history, and system events.\n\nARTIFACT CATEGORIES:\n\n1. EVENT LOGS:\n   ```bash\n   # Location: C:\\Windows\\System32\\winevt\\Logs\\\n   # Format: EVTX\n   \n   # Key Log Files:\n   | Log | Purpose | Key Events |\n   |-----|---------|------------|\n   | Security.evtx | Authentication | 4624 (logon), 4625 (failed), 4672 (admin) |\n   | System.evtx | System events | 7045 (service install), 104 (log cleared) |\n   | Application.evtx | App events | 1000-1002 (crashes) |\n   | PowerShell/Operational | PS execution | 4103, 4104 (script block) |\n   | Sysmon/Operational | If installed | Process creation, network |\n   | TaskScheduler/Operational | Scheduled tasks | 106 (task registered) |\n   \n   # Parse with evtxexport\n   evtxexport Security.evtx > Security.txt\n   \n   # Parse with EvtxECmd (Zimmerman)\n   EvtxECmd.exe -f Security.evtx --csv /output/ --csvf security.csv\n   \n   # Key Security Events:\n   # 4624 - Successful logon\n   # 4625 - Failed logon\n   # 4634/4647 - Logoff\n   # 4648 - Explicit credentials\n   # 4672 - Special privileges assigned\n   # 4688 - Process creation\n   # 4698/4699 - Scheduled task created/deleted\n   # 4720 - User account created\n   # 1102 - Audit log cleared\n   ```\n\n2. PREFETCH:\n   ```bash\n   # Location: C:\\Windows\\Prefetch\\\n   # Format: .pf files\n   # Purpose: Program execution evidence\n   \n   # Contains:\n   # - Executable name\n   # - Run count\n   # - Last 8 run times (Windows 8+)\n   # - Files/directories accessed\n   # - Volume information\n   \n   # Naming: EXECUTABLE-XXXXXXXX.pf\n   # Hash based on path and command line\n   \n   # Parse with PECmd (Zimmerman)\n   PECmd.exe -d C:\\Windows\\Prefetch --csv /output/ --csvf prefetch.csv\n   \n   # Or use prefetch parser\n   python prefetch.py C:\\Windows\\Prefetch\\*.pf\n   \n   # Windows 10: Up to 1024 prefetch files\n   # Windows 8: Format changed (compressed)\n   # Windows 7: Up to 128 files\n   \n   # Forensic Value:\n   # - Proves program execution\n   # - Shows run count and times\n   # - Lists files accessed at execution\n   ```\n\n3. SRUM (SYSTEM RESOURCE USAGE MONITOR):\n   ```bash\n   # Location: C:\\Windows\\System32\\sru\\SRUDB.dat\n   # Format: ESE database\n   # Purpose: Resource usage tracking\n   \n   # Tracks (last 30-60 days):\n   # - Application resource usage\n   # - Network usage per app\n   # - Energy usage\n   # - Push notifications\n   \n   # Parse with SrumECmd (Zimmerman)\n   SrumECmd.exe -f SRUDB.dat --csv /output/\n   \n   # Or use srum-dump\n   python srum_dump.py -i SRUDB.dat -o srum_report.xlsx -r SOFTWARE\n   \n   # Requires SOFTWARE hive for SID-to-user mapping\n   \n   # Forensic Value:\n   # - Proves application usage\n   # - Network bytes sent/received per app\n   # - Timeline of app usage\n   # - Survives log clearing\n   ```\n\n4. BROWSER ARTIFACTS:\n   ```bash\n   # Chrome:\n   # C:\\Users\\<user>\\AppData\\Local\\Google\\Chrome\\User Data\\Default\\\n   # - History (SQLite)\n   # - Cookies (SQLite)\n   # - Login Data (SQLite, encrypted)\n   # - Web Data (autofill)\n   # - Bookmarks (JSON)\n   # - Preferences (JSON)\n   \n   # Firefox:\n   # C:\\Users\\<user>\\AppData\\Roaming\\Mozilla\\Firefox\\Profiles\\*\n   # - places.sqlite (history, bookmarks)\n   # - cookies.sqlite\n   # - logins.json + key4.db (credentials)\n   # - formhistory.sqlite\n   \n   # Edge:\n   # C:\\Users\\<user>\\AppData\\Local\\Microsoft\\Edge\\User Data\\Default\\\n   # (Same structure as Chrome)\n   \n   # IE:\n   # C:\\Users\\<user>\\AppData\\Local\\Microsoft\\Windows\\WebCache\\WebCacheV01.dat\n   # (ESE database)\n   \n   # Parse with Hindsight (Chrome)\n   python hindsight.py -i \"C:\\Users\\*\\AppData\\Local\\Google\\Chrome\\User Data\\Default\" -o chrome_report\n   \n   # Parse with BrowsingHistoryView (NirSoft)\n   BrowsingHistoryView.exe /scomma output.csv\n   ```\n\n5. LNK FILES AND JUMP LISTS:\n   ```bash\n   # LNK Files (Shortcuts):\n   # C:\\Users\\<user>\\AppData\\Roaming\\Microsoft\\Windows\\Recent\\\n   # C:\\Users\\<user>\\Desktop\\\n   \n   # Contains:\n   # - Target path\n   # - MAC times of target\n   # - Volume serial number\n   # - Machine ID\n   \n   # Parse with LECmd (Zimmerman)\n   LECmd.exe -d \"C:\\Users\\*\\AppData\\Roaming\\Microsoft\\Windows\\Recent\" --csv /output/\n   \n   # Jump Lists (Recent files per app):\n   # C:\\Users\\<user>\\AppData\\Roaming\\Microsoft\\Windows\\Recent\\AutomaticDestinations\\\n   # C:\\Users\\<user>\\AppData\\Roaming\\Microsoft\\Windows\\Recent\\CustomDestinations\\\n   \n   # Parse with JLECmd\n   JLECmd.exe -d AutomaticDestinations --csv /output/\n   \n   # Forensic Value:\n   # - Shows file access (even deleted)\n   # - Reveals external drive access\n   # - Timestamps of target file\n   ```\n\n6. RECYCLE BIN:\n   ```bash\n   # Location: C:\\$Recycle.Bin\\<SID>\\\n   # Files: $I (index) and $R (content)\n   \n   # $I file contains:\n   # - Original path\n   # - Deletion time\n   # - Original size\n   \n   # Parse with RBCmd (Zimmerman)\n   RBCmd.exe -d \"C:\\$Recycle.Bin\" --csv /output/\n   \n   # Or manually\n   # $I file header (Windows 10):\n   # Bytes 0-7: Version (2)\n   # Bytes 8-15: File size\n   # Bytes 16-23: Deletion time\n   # Bytes 24+: Original path (Unicode)\n   ```\n\n7. SCHEDULED TASKS:\n   ```bash\n   # Location: C:\\Windows\\System32\\Tasks\\\n   # Format: XML\n   \n   # Contains:\n   # - Task name and description\n   # - Triggers (time, event)\n   # - Actions (execute, email)\n   # - Principal (user context)\n   # - Registration date\n   \n   # List tasks\n   schtasks /query /xml ONE > tasks.xml\n   \n   # Parse with TaskSchedulerECmd\n   # Or manually examine XML files\n   \n   # Common malware techniques:\n   # - Daily/hourly persistence\n   # - On-logon triggers\n   # - Hidden tasks (names starting with spaces)\n   ```\n\n8. WINDOWS SEARCH INDEX:\n   ```bash\n   # Location: C:\\ProgramData\\Microsoft\\Search\\Data\\Applications\\Windows\\Windows.edb\n   # Format: ESE database\n   \n   # Contains:\n   # - Indexed file metadata\n   # - File content (portions)\n   # - Email content (Outlook)\n   # - Deleted file references\n   \n   # Parse with SearchIndexer tools\n   # Or use Cellebrite/EnCase\n   ```\n\n9. ARTIFACT COLLECTION SCRIPT:\n   ```powershell\n   # PowerShell artifact collection\n   \n   $output = \"C:\\forensics\\artifacts\"\n   New-Item -ItemType Directory -Path $output -Force\n   \n   # Event Logs\n   Copy-Item \"C:\\Windows\\System32\\winevt\\Logs\\*.evtx\" \"$output\\eventlogs\\\"\n   \n   # Prefetch\n   Copy-Item \"C:\\Windows\\Prefetch\\*.pf\" \"$output\\prefetch\\\"\n   \n   # SRUM\n   Copy-Item \"C:\\Windows\\System32\\sru\\SRUDB.dat\" \"$output\\\"\n   \n   # Registry (use reg save for locked hives)\n   reg save HKLM\\SAM \"$output\\registry\\SAM\"\n   reg save HKLM\\SYSTEM \"$output\\registry\\SYSTEM\"\n   reg save HKLM\\SOFTWARE \"$output\\registry\\SOFTWARE\"\n   \n   # User artifacts\n   Get-ChildItem \"C:\\Users\" -Directory | ForEach-Object {\n       $user = $_.Name\n       $userOut = \"$output\\users\\$user\"\n       New-Item -ItemType Directory -Path $userOut -Force\n       \n       Copy-Item \"$($_.FullName)\\NTUSER.DAT\" \"$userOut\\\" 2>$null\n       Copy-Item \"$($_.FullName)\\AppData\\Roaming\\Microsoft\\Windows\\Recent\\*\" \"$userOut\\recent\\\" 2>$null\n       Copy-Item \"$($_.FullName)\\AppData\\Local\\Google\\Chrome\\User Data\\Default\\History\" \"$userOut\\chrome\\\" 2>$null\n   }\n   \n   # Scheduled Tasks\n   Copy-Item \"C:\\Windows\\System32\\Tasks\\*\" \"$output\\tasks\\\" -Recurse\n   \n   Write-Host \"Artifact collection complete: $output\"\n   ```\n\nARTIFACT ANALYSIS REPORT:\n```\nWindows Artifact Analysis:\n\nSystem: WORKSTATION-01\nCollection Date: 2024-03-15\n\nEvent Log Analysis:\n| Event | Count | Notable |\n|-------|-------|--------|\n| 4624 (Logon) | 456 | 23 RDP logons from external IP |\n| 4625 (Failed) | 1,234 | Brute force: 2024-03-14 02:00-04:00 |\n| 4688 (Process) | 12,456 | cmd.exe spawned by WINWORD.EXE |\n| 7045 (Service) | 12 | Unknown service: \"SecurityUpdate\" |\n\nPrefetch Analysis:\n| Executable | Run Count | Last Run |\n|------------|-----------|----------|\n| MIMIKATZ.EXE | 3 | 2024-03-14 10:30 |\n| PSEXEC.EXE | 5 | 2024-03-14 11:00 |\n| PAYLOAD.EXE | 1 | 2024-03-14 09:45 |\n\nSRUM Network Usage:\n| Application | Bytes Sent | Bytes Received |\n|-------------|------------|----------------|\n| chrome.exe | 145 MB | 2.3 GB |\n| powershell.exe | 450 MB | 12 MB |\n| update.exe | 234 MB | 5 MB |\n\nLNK/Jump List Analysis:\n- Recent access to: \\\\192.168.1.50\\share$\\passwords.xlsx\n- USB drive: E:\\Confidential (2024-03-14)\n\nRecycle Bin:\n- report_FINAL.docx (deleted 2024-03-15 08:00)\n- passwords_backup.txt (deleted 2024-03-15 08:05)\n```\n\nDETECTION INDICATORS:\n- Event logs parsed for suspicious events\n- Prefetch shows program execution\n- SRUM reveals network activity\n- LNK files show file access\n\nCOMMON PITFALLS:\n- Missing Prefetch (disabled on SSDs sometimes)\n- Not parsing SRUM\n- Ignoring Jump Lists\n- Not correlating artifact timestamps\n\nFURTHER READING:\n- Eric Zimmerman Tools documentation\n- SANS Windows Forensic Analysis Poster\n- 13Cubed YouTube channel",
      "tags": ["forensics", "windows", "artifacts", "event-logs", "prefetch", "srum", "dfir"],
      "related_tools": ["bulk_extractor", "exiftool", "strings"]
    }
  ]
}
