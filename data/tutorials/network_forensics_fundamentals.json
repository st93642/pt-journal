{
  "id": "network_forensics_fundamentals",
  "title": "Network Forensics Fundamentals",
  "description": "Comprehensive network forensics covering packet capture analysis, protocol examination, traffic reconstruction, and intrusion detection using industry-standard tools.",
  "type": "tutorial",
  "steps": [
    {
      "id": "packet_capture_analysis",
      "title": "Packet Capture Analysis",
      "content": "OBJECTIVE: Master packet capture acquisition, filtering, and initial analysis using Wireshark and command-line tools.\n\nACADEMIC BACKGROUND:\nNetwork forensics examines network traffic to identify security incidents, data exfiltration, and malicious communication. Packet captures (PCAP files) preserve network evidence for detailed analysis. Understanding network protocols and traffic patterns is essential for effective investigation.\n\nPACKET CAPTURE FUNDAMENTALS:\n\n1. CAPTURE METHODS:\n   ```bash\n   # tcpdump - Command line capture\n   tcpdump -i eth0 -w capture.pcap\n   \n   # With filters\n   tcpdump -i eth0 -w capture.pcap host 192.168.1.100\n   tcpdump -i eth0 -w capture.pcap port 443\n   tcpdump -i eth0 -w capture.pcap \"tcp and port 80\"\n   \n   # Capture options\n   tcpdump -i eth0 -w capture.pcap -c 10000   # Capture count\n   tcpdump -i eth0 -w capture.pcap -s 0       # Full packets\n   tcpdump -i eth0 -w capture.pcap -G 3600    # Rotate hourly\n   tcpdump -i eth0 -w capture_%Y%m%d_%H.pcap -G 3600 -W 24  # 24 files\n   \n   # Wireshark/tshark\n   tshark -i eth0 -w capture.pcap\n   tshark -i eth0 -w capture.pcap -f \"host 192.168.1.100\"\n   \n   # dumpcap (capture only, efficient)\n   dumpcap -i eth0 -w capture.pcap\n   ```\n\n2. WIRESHARK BASICS:\n   ```\n   Opening Captures:\n   - File > Open > select .pcap/.pcapng\n   - Drag and drop file\n   - Command: wireshark capture.pcap\n   \n   Interface Layout:\n   - Packet List (top): Summary of each packet\n   - Packet Details (middle): Protocol breakdown\n   - Packet Bytes (bottom): Hex dump\n   \n   Column Configuration:\n   - Edit > Preferences > Appearance > Columns\n   - Add: Source Port, Destination Port, TCP Flags\n   \n   Time Display:\n   - View > Time Display Format\n   - \"Seconds Since Capture\" for timeline\n   - \"Date and Time of Day\" for absolute\n   ```\n\n3. DISPLAY FILTERS:\n   ```\n   Wireshark Display Filter Syntax:\n   \n   IP Filters:\n   ip.addr == 192.168.1.100\n   ip.src == 192.168.1.100\n   ip.dst == 10.0.0.1\n   ip.addr == 192.168.1.0/24\n   \n   TCP Filters:\n   tcp.port == 80\n   tcp.srcport == 443\n   tcp.dstport == 22\n   tcp.flags.syn == 1\n   tcp.flags.reset == 1\n   tcp.analysis.retransmission\n   tcp.analysis.zero_window\n   \n   UDP Filters:\n   udp.port == 53\n   dns\n   \n   Protocol Filters:\n   http\n   https\n   ftp\n   smtp\n   icmp\n   arp\n   \n   Content Filters:\n   http.request.uri contains \"login\"\n   http.host contains \"evil.com\"\n   frame contains \"password\"\n   tcp contains \"cmd.exe\"\n   \n   Combining Filters:\n   ip.src == 192.168.1.100 and tcp.port == 80\n   http or dns\n   !(arp or icmp)\n   (http.request or http.response) and ip.addr == 10.0.0.1\n   ```\n\n4. TSHARK ANALYSIS:\n   ```bash\n   # Basic reading\n   tshark -r capture.pcap\n   \n   # With display filter\n   tshark -r capture.pcap -Y \"http\"\n   tshark -r capture.pcap -Y \"ip.addr == 192.168.1.100\"\n   \n   # Extract specific fields\n   tshark -r capture.pcap -T fields -e ip.src -e ip.dst -e tcp.port\n   \n   # HTTP analysis\n   tshark -r capture.pcap -Y http.request -T fields \\\n          -e ip.src -e http.host -e http.request.uri\n   \n   # DNS analysis\n   tshark -r capture.pcap -Y dns.qry.name -T fields \\\n          -e ip.src -e dns.qry.name -e dns.a\n   \n   # Statistics\n   tshark -r capture.pcap -q -z io,stat,60  # Traffic per 60s\n   tshark -r capture.pcap -q -z conv,tcp    # TCP conversations\n   tshark -r capture.pcap -q -z endpoints,ip # Endpoints\n   tshark -r capture.pcap -q -z http,tree   # HTTP statistics\n   ```\n\n5. TRAFFIC STATISTICS:\n   ```bash\n   # Wireshark Statistics menu:\n   Statistics > Capture File Properties  # Overview\n   Statistics > Protocol Hierarchy        # Protocol breakdown\n   Statistics > Conversations            # Connections\n   Statistics > Endpoints                # Hosts\n   Statistics > HTTP > Requests          # HTTP requests\n   Statistics > DNS                      # DNS queries\n   \n   # capinfos for file statistics\n   capinfos capture.pcap\n   \n   # Output:\n   # File name:           capture.pcap\n   # File type:           Wireshark/tcpdump/... - pcap\n   # File encapsulation:  Ethernet\n   # Packet size limit:   file hance\n   # Number of packets:   1,234,567\n   # File size:           1,234 MB\n   # Data size:           1,100 MB\n   # Capture duration:    3600 seconds\n   # First packet time:   2024-03-15 09:00:00\n   # Last packet time:    2024-03-15 10:00:00\n   ```\n\n6. EXTRACTING OBJECTS:\n   ```bash\n   # Wireshark: File > Export Objects > HTTP\n   # Lists all HTTP transferred files\n   \n   # tshark export\n   tshark -r capture.pcap --export-objects http,/output/http/\n   tshark -r capture.pcap --export-objects smb,/output/smb/\n   tshark -r capture.pcap --export-objects imf,/output/email/\n   tshark -r capture.pcap --export-objects tftp,/output/tftp/\n   \n   # NetworkMiner (GUI)\n   # Automatically extracts files, images, credentials\n   \n   # Zeek/Bro for automated extraction\n   zeek -r capture.pcap local\n   # Creates: conn.log, dns.log, http.log, files.log\n   ```\n\n7. IDENTIFYING SUSPICIOUS TRAFFIC:\n   ```\n   Suspicious Indicators:\n   \n   Beaconing:\n   - Regular interval connections\n   - Same destination, similar timing\n   - Small data transfers\n   \n   Filter for potential beaconing:\n   Statistics > Conversations > TCP\n   Sort by Packets, look for regular patterns\n   \n   Large Data Transfers:\n   tcp.len > 10000\n   Statistics > Conversations, sort by Bytes\n   \n   Unusual Ports:\n   tcp.port > 49152 and tcp.port < 65535\n   Non-standard ports for protocols\n   \n   Known Bad:\n   http.host matches \".*\\.ru$\"\n   ip.addr == <threat_intel_IP>\n   ```\n\n8. CAPTURE FILE MANAGEMENT:\n   ```bash\n   # Merge capture files\n   mergecap -w merged.pcap file1.pcap file2.pcap\n   \n   # Split capture by size\n   editcap -c 100000 capture.pcap split_\n   \n   # Split by time interval\n   editcap -i 3600 capture.pcap hourly_\n   \n   # Extract time range\n   editcap -A \"2024-03-15 09:00:00\" -B \"2024-03-15 10:00:00\" \\\n           capture.pcap timerange.pcap\n   \n   # Apply filter (save filtered packets)\n   tshark -r capture.pcap -Y \"ip.addr == 192.168.1.100\" -w filtered.pcap\n   \n   # Convert format\n   editcap -F pcapng capture.pcap capture.pcapng\n   ```\n\nANALYSIS REPORT:\n```\nPacket Capture Analysis:\n\nCapture Information:\n- Filename: incident_20240315.pcap\n- Duration: 3,600 seconds (1 hour)\n- Packets: 1,245,678\n- Size: 1.2 GB\n- First packet: 2024-03-15 09:00:00 UTC\n- Last packet: 2024-03-15 10:00:00 UTC\n\nProtocol Distribution:\n| Protocol | Packets | Bytes | Percentage |\n|----------|---------|-------|------------|\n| TCP | 1,100,000 | 1.0 GB | 88% |\n| UDP | 120,000 | 150 MB | 10% |\n| ICMP | 5,678 | 1 MB | <1% |\n| Other | 20,000 | 50 MB | 2% |\n\nTop Talkers (by bytes):\n| Source | Destination | Bytes | Packets |\n|--------|-------------|-------|--------|\n| 192.168.1.100 | 185.220.101.1 | 450 MB | 234,567 |\n| 192.168.1.100 | 10.0.0.1 | 200 MB | 123,456 |\n\nSuspicious Findings:\n1. Beaconing to 185.220.101.1 (Tor exit node)\n   - Interval: Every 60 seconds\n   - Duration: Entire capture\n   - Data: ~2 KB per connection\n\n2. Large outbound transfer to external IP\n   - Destination: 91.234.99.42\n   - Total: 450 MB\n   - Port: 443 (HTTPS - encrypted)\n```\n\nDETECTION INDICATORS:\n- Capture file statistics reviewed\n- Protocol distribution analyzed\n- Top talkers identified\n- Suspicious patterns noted\n\nCOMMON PITFALLS:\n- Not setting capture filter (too much data)\n- Wrong interface selection\n- Missing packets (buffer overflow)\n- Not preserving original capture\n\nFURTHER READING:\n- Wireshark User's Guide\n- \"Practical Packet Analysis\" by Chris Sanders\n- SANS SEC503 course materials",
      "tags": ["forensics", "network", "wireshark", "pcap", "traffic-analysis", "dfir"],
      "related_tools": ["tcpdump", "wireshark", "tshark"]
    },
    {
      "id": "protocol_analysis",
      "title": "Protocol Analysis",
      "content": "OBJECTIVE: Analyze specific network protocols to extract forensic artifacts and identify malicious activity.\n\nACADEMIC BACKGROUND:\nEach network protocol has unique characteristics that can reveal user activity, data transfer, and attack patterns. Understanding protocol internals enables deep analysis beyond surface-level traffic inspection.\n\nPROTOCOL DEEP DIVES:\n\n1. HTTP ANALYSIS:\n   ```bash\n   # HTTP request/response\n   # Methods: GET, POST, PUT, DELETE, HEAD, OPTIONS\n   \n   # Wireshark filters\n   http.request\n   http.response\n   http.request.method == \"POST\"\n   http.request.uri contains \"login\"\n   http.response.code == 200\n   http.response.code >= 400\n   \n   # Extract all HTTP requests\n   tshark -r capture.pcap -Y http.request -T fields \\\n          -e frame.time -e ip.src -e ip.dst \\\n          -e http.host -e http.request.method -e http.request.uri\n   \n   # Extract POST data\n   tshark -r capture.pcap -Y \"http.request.method == POST\" -T fields \\\n          -e http.host -e http.request.uri -e http.file_data\n   \n   # Follow HTTP stream\n   # Wireshark: Right-click > Follow > HTTP Stream\n   \n   # Key artifacts:\n   # - User-Agent strings\n   # - Cookies\n   # - POST data (forms, uploads)\n   # - Response content\n   # - Referrer URLs\n   ```\n\n2. DNS ANALYSIS:\n   ```bash\n   # DNS query/response analysis\n   \n   # Wireshark filters\n   dns\n   dns.qry.name\n   dns.qry.type == 1    # A record\n   dns.qry.type == 28   # AAAA record\n   dns.qry.type == 5    # CNAME\n   dns.qry.type == 16   # TXT\n   dns.qry.type == 15   # MX\n   dns.flags.response == 1  # Responses\n   dns.flags.rcode != 0     # Errors\n   \n   # Extract DNS queries\n   tshark -r capture.pcap -Y dns.qry.name -T fields \\\n          -e frame.time -e ip.src -e dns.qry.name -e dns.a\n   \n   # DNS tunneling indicators:\n   # - Long subdomain names\n   # - High volume of TXT queries\n   # - Base64-like strings in queries\n   # - Unusual query patterns\n   \n   dns.qry.name matches \"^[a-zA-Z0-9]{32,}\"\n   dns.qry.type == 16 and dns.qry.name contains \"base64\"\n   \n   # Extract unique domains\n   tshark -r capture.pcap -Y dns.qry.name -T fields -e dns.qry.name | \\\n          sort -u > domains.txt\n   ```\n\n3. TLS/HTTPS ANALYSIS:\n   ```bash\n   # TLS handshake analysis\n   # Can't see encrypted content without key\n   \n   # Wireshark filters\n   tls\n   tls.handshake\n   tls.handshake.type == 1    # Client Hello\n   tls.handshake.type == 2    # Server Hello\n   tls.handshake.extensions_server_name  # SNI\n   \n   # Extract Server Name Indication (SNI)\n   tshark -r capture.pcap -Y \"tls.handshake.type == 1\" -T fields \\\n          -e ip.dst -e tls.handshake.extensions_server_name\n   \n   # JA3 fingerprinting (TLS client fingerprint)\n   # Identifies client applications\n   tshark -r capture.pcap -Y \"tls.handshake.type == 1\" -T fields \\\n          -e ip.src -e tls.handshake.ja3_full\n   \n   # JA3S (Server fingerprint)\n   tshark -r capture.pcap -Y \"tls.handshake.type == 2\" -T fields \\\n          -e ip.dst -e tls.handshake.ja3s_full\n   \n   # Decryption (if key available):\n   # Edit > Preferences > Protocols > TLS\n   # Pre-Master-Secret log filename: /path/to/sslkeylog.txt\n   ```\n\n4. SMB ANALYSIS:\n   ```bash\n   # SMB/CIFS file sharing analysis\n   \n   # Wireshark filters\n   smb\n   smb2\n   smb2.cmd == 5    # Create (file access)\n   smb2.cmd == 8    # Read\n   smb2.cmd == 9    # Write\n   smb2.filename\n   \n   # Extract file access\n   tshark -r capture.pcap -Y smb2.filename -T fields \\\n          -e ip.src -e ip.dst -e smb2.filename\n   \n   # SMB lateral movement indicators:\n   # - Admin share access (C$, ADMIN$)\n   # - PsExec patterns\n   # - Remote service creation\n   \n   smb2.filename contains \"ADMIN$\"\n   smb2.filename contains \"IPC$\"\n   smb2.filename contains \".exe\"\n   \n   # Export transferred files\n   # File > Export Objects > SMB\n   ```\n\n5. FTP ANALYSIS:\n   ```bash\n   # FTP command/data analysis\n   \n   # Wireshark filters\n   ftp\n   ftp-data\n   ftp.request.command == \"USER\"\n   ftp.request.command == \"PASS\"\n   ftp.request.command == \"RETR\"\n   ftp.request.command == \"STOR\"\n   ftp.response.code == 230  # Login successful\n   \n   # Extract credentials (plaintext!)\n   tshark -r capture.pcap -Y \"ftp.request.command == USER or ftp.request.command == PASS\" \\\n          -T fields -e ip.src -e ftp.request.command -e ftp.request.arg\n   \n   # Follow FTP stream\n   # Wireshark: Right-click > Follow > TCP Stream\n   \n   # Extract transferred files\n   # File > Export Objects > FTP-DATA\n   ```\n\n6. SMTP/EMAIL ANALYSIS:\n   ```bash\n   # Email protocol analysis\n   \n   # Wireshark filters\n   smtp\n   smtp.req.parameter contains \"@\"\n   smtp.data.fragment\n   imf  # Internet Message Format (email content)\n   \n   # Extract email addresses\n   tshark -r capture.pcap -Y smtp.req.command -T fields \\\n          -e ip.src -e smtp.req.command -e smtp.req.parameter\n   \n   # Extract email content\n   # File > Export Objects > IMF\n   \n   # Look for:\n   # - Sender/recipient addresses\n   # - Subject lines\n   # - Attachments\n   # - Phishing indicators\n   ```\n\n7. ICMP ANALYSIS:\n   ```bash\n   # ICMP analysis (ping, errors)\n   \n   # Wireshark filters\n   icmp\n   icmp.type == 8   # Echo request\n   icmp.type == 0   # Echo reply\n   icmp.type == 3   # Destination unreachable\n   icmp.type == 11  # Time exceeded (traceroute)\n   \n   # ICMP tunneling detection:\n   # - Large ICMP packets\n   # - Non-standard payload\n   # - High ICMP volume\n   \n   icmp and data.len > 64\n   \n   # Extract ICMP data\n   tshark -r capture.pcap -Y icmp -T fields \\\n          -e ip.src -e ip.dst -e icmp.type -e data\n   ```\n\n8. DHCP ANALYSIS:\n   ```bash\n   # DHCP analysis for host identification\n   \n   # Wireshark filters\n   dhcp\n   bootp  # Older name\n   dhcp.option.hostname\n   dhcp.option.vendor_class_id\n   \n   # Extract hostnames and MACs\n   tshark -r capture.pcap -Y dhcp -T fields \\\n          -e eth.src -e dhcp.option.hostname -e dhcp.option.requested_ip_address\n   \n   # Useful for:\n   # - Identifying hosts\n   # - Tracking device movement\n   # - MAC-to-IP correlation\n   ```\n\nPROTOCOL ANALYSIS REPORT:\n```\nProtocol Analysis Findings:\n\nHTTP Analysis:\n| Method | Count | Notable Requests |\n|--------|-------|------------------|\n| GET | 12,456 | /admin/config.php |\n| POST | 1,234 | /upload.php (file upload) |\n| PUT | 23 | /shell.php (suspicious) |\n\nCredentials Found (Plaintext):\n| Protocol | Username | Password | Destination |\n|----------|----------|----------|-------------|\n| FTP | admin | P@ssw0rd | 192.168.1.50 |\n| HTTP | jsmith | secret123 | 10.0.0.5:8080 |\n\nDNS Analysis:\n- Queries: 34,567\n- Unique domains: 1,234\n- Suspicious TXT queries: 456 (potential tunneling)\n- Newly registered domains: 23\n\nTLS/HTTPS:\n- Connections: 45,678\n- Unique SNI hosts: 567\n- Self-signed certificates: 12\n- Known malicious JA3: 3 matches\n\nSMB Activity:\n- File accesses: 234\n- Admin share access: 5 (from 192.168.1.100)\n- Executable transfers: 3\n```\n\nDETECTION INDICATORS:\n- All protocols examined\n- Credentials extracted\n- Suspicious patterns identified\n- Artifacts correlated\n\nCOMMON PITFALLS:\n- Missing encrypted content analysis\n- Not following streams\n- Ignoring metadata\n- Missing tunneling detection\n\nFURTHER READING:\n- Wireshark Protocol Reference\n- RFC documents for each protocol\n- SANS Network Forensics",
      "tags": ["forensics", "network", "protocols", "http", "dns", "tls", "dfir"],
      "related_tools": ["wireshark", "tshark", "tcpdump"]
    },
    {
      "id": "intrusion_detection_analysis",
      "title": "Intrusion Detection Analysis",
      "content": "OBJECTIVE: Identify attack patterns, malicious traffic, and indicators of compromise through network traffic analysis.\n\nACADEMIC BACKGROUND:\nNetwork intrusion detection involves identifying malicious activity patterns in network traffic. This includes reconnaissance, exploitation, command-and-control communication, and data exfiltration. Understanding attack signatures and behavioral patterns enables effective detection.\n\nINTRUSION PATTERNS:\n\n1. RECONNAISSANCE DETECTION:\n   ```bash\n   # Port scanning detection\n   \n   # SYN scan (half-open)\n   # Many SYN packets, few established connections\n   tcp.flags.syn == 1 and tcp.flags.ack == 0\n   \n   # Connect scan (full)\n   # Rapid RST after connection\n   tcp.flags.reset == 1\n   \n   # Statistics for scan detection\n   tshark -r capture.pcap -q -z ip_hosts,tree\n   # Look for source with many unique destinations\n   \n   # Specific scan patterns\n   # Nmap SYN scan:\n   tcp.flags == 0x002  # SYN only\n   tcp.window_size == 1024 or tcp.window_size == 2048\n   \n   # Nmap NULL scan:\n   tcp.flags == 0x000\n   \n   # Nmap FIN scan:\n   tcp.flags == 0x001\n   \n   # Nmap XMAS scan:\n   tcp.flags == 0x029  # FIN, PSH, URG\n   \n   # Detection script\n   tshark -r capture.pcap -Y \"tcp.flags.syn == 1\" -T fields \\\n          -e ip.src -e ip.dst -e tcp.dstport | \\\n          awk '{print $1\" -> \"$2\":\"$3}' | sort | uniq -c | sort -rn\n   ```\n\n2. EXPLOITATION ATTEMPTS:\n   ```bash\n   # SQL Injection\n   http.request.uri contains \"'\"\n   http.request.uri contains \"UNION\"\n   http.request.uri contains \"SELECT\"\n   http contains \"sqlmap\"\n   \n   # XSS attempts\n   http.request.uri contains \"<script\"\n   http.request.uri contains \"javascript:\"\n   http.request.uri contains \"onerror=\"\n   \n   # Directory traversal\n   http.request.uri contains \"../\"\n   http.request.uri contains \"..%2f\"\n   http.request.uri contains \"....//\"\n   \n   # Command injection\n   http.request.uri contains \";ls\"\n   http.request.uri contains \"|cat\"\n   http.request.uri contains \"`id`\"\n   \n   # Shell upload attempts\n   http.request.uri contains \".php\"\n   http.content_type contains \"multipart/form-data\"\n   http.file_data contains \"<?php\"\n   ```\n\n3. COMMAND AND CONTROL (C2):\n   ```bash\n   # Beaconing detection\n   # Regular interval connections to same destination\n   \n   # Statistical analysis\n   tshark -r capture.pcap -Y \"ip.dst == 185.220.101.1\" -T fields \\\n          -e frame.time_delta_displayed | \\\n          awk '{sum+=$1; count++} END {print \"Avg interval: \" sum/count \" seconds\"}\n   \n   # Common C2 patterns:\n   # - HTTP/HTTPS on standard ports\n   # - Long polling connections\n   # - Encoded data in URLs/headers\n   # - DNS tunneling\n   \n   # Cobalt Strike indicators\n   http.request.uri matches \"/.....\\.php\"\n   http.cookie contains \"SESSIONID=\"\n   tls.handshake.ja3 == \"72a589da586844d7f0818ce684948eea\"  # Known CS JA3\n   \n   # Empire/Meterpreter\n   http.user_agent contains \"Mozilla/5.0\"\n   http.content_length == 0 and http.request.method == \"POST\"\n   \n   # DNS C2\n   dns.qry.name matches \"^[a-zA-Z0-9]{30,}\\.\"\n   dns.qry.type == 16  # TXT records\n   ```\n\n4. DATA EXFILTRATION:\n   ```bash\n   # Large outbound transfers\n   ip.src == 192.168.0.0/16 and ip.dst != 192.168.0.0/16\n   \n   # Statistics\n   tshark -r capture.pcap -q -z conv,tcp | \\\n          awk '$5 > 100000000 {print $1\" -> \"$3\": \"$5\" bytes\"}'\n   \n   # DNS exfiltration (data in queries)\n   dns.qry.name matches \"^[a-zA-Z0-9+/=]{20,}\\.\"\n   \n   # ICMP exfiltration\n   icmp and data.len > 100\n   \n   # HTTP exfiltration\n   http.request.method == \"POST\" and tcp.len > 10000\n   \n   # Cloud storage\n   http.host contains \"dropbox\"\n   http.host contains \"onedrive\"\n   http.host contains \"drive.google\"\n   tls.handshake.extensions_server_name contains \"mega.nz\"\n   ```\n\n5. LATERAL MOVEMENT:\n   ```bash\n   # SMB lateral movement\n   smb2.cmd == 5 and smb2.filename contains \"ADMIN$\"\n   smb2.cmd == 5 and smb2.filename contains \"IPC$\"\n   smb2.filename matches \".*\\.exe$\"\n   \n   # PsExec pattern\n   smb2.filename contains \"PSEXESVC\"\n   \n   # WMI lateral movement\n   dce_rpc and ip.src == 192.168.1.100\n   \n   # RDP connections\n   tcp.port == 3389\n   rdp\n   \n   # SSH lateral movement\n   ssh\n   tcp.port == 22 and ip.src == internal_range\n   \n   # Pass-the-hash / Kerberos\n   kerberos\n   kerberos.error_code != 0\n   ```\n\n6. MALWARE TRAFFIC PATTERNS:\n   ```bash\n   # Known malware user agents\n   http.user_agent == \"\"\n   http.user_agent contains \"MSIE 6.0\"\n   http.user_agent matches \"^Mozilla/[45]\\.0 \\(compatible;\\)$\"\n   \n   # Suspicious TLS patterns\n   tls.handshake.extensions_server_name matches \"^[0-9]+\\.[0-9]+\\.[0-9]+\\.[0-9]+$\"\n   # (Direct IP in SNI)\n   \n   # Self-signed certificates\n   x509sat.printableString contains \"localhost\"\n   x509sat.printableString contains \"self-signed\"\n   \n   # Encoded data\n   http.request.uri matches \"[A-Za-z0-9+/]{50,}=\"\n   \n   # IRC (botnet)\n   irc\n   tcp.port == 6667\n   \n   # Tor traffic\n   tls.handshake.extensions_server_name matches \"\\.onion$\"\n   tcp.port == 9001 or tcp.port == 9030\n   ```\n\n7. ZEEK/BRO ANALYSIS:\n   ```bash\n   # Process PCAP with Zeek\n   zeek -r capture.pcap local\n   \n   # Output logs:\n   # conn.log - All connections\n   # dns.log - DNS queries\n   # http.log - HTTP requests\n   # ssl.log - TLS connections\n   # files.log - File transfers\n   # notice.log - Alerts\n   \n   # Analyze connection log\n   cat conn.log | zeek-cut id.orig_h id.resp_h id.resp_p proto conn_state | \\\n          sort | uniq -c | sort -rn | head\n   \n   # Find long connections (potential C2)\n   cat conn.log | zeek-cut id.orig_h id.resp_h duration | \\\n          awk '$3 > 3600 {print}'\n   \n   # High-volume DNS\n   cat dns.log | zeek-cut id.orig_h query | \\\n          awk '{print $1}' | sort | uniq -c | sort -rn | head\n   \n   # Suspicious HTTP\n   cat http.log | zeek-cut id.orig_h host uri | grep -i \"upload\\|shell\\|cmd\"\n   ```\n\n8. SNORT/SURICATA RULES:\n   ```bash\n   # Apply IDS rules to PCAP\n   \n   # Suricata\n   suricata -r capture.pcap -s /etc/suricata/rules/\n   cat eve.json | jq 'select(.event_type==\"alert\")'\n   \n   # Custom rule examples\n   # Detect nmap scan\n   alert tcp any any -> any any (msg:\"Possible Nmap SYN Scan\"; \\\n          flags:S; threshold:type threshold, track by_src, count 50, seconds 10; \\\n          classtype:attempted-recon; sid:1000001;)\n   \n   # Detect SQL injection\n   alert http any any -> any any (msg:\"SQL Injection Attempt\"; \\\n          content:\"UNION\"; http_uri; nocase; \\\n          content:\"SELECT\"; http_uri; nocase; \\\n          classtype:web-application-attack; sid:1000002;)\n   \n   # Detect C2 beaconing\n   alert http any any -> any any (msg:\"Possible C2 Beacon\"; \\\n          threshold:type threshold, track by_src, count 100, seconds 3600; \\\n          classtype:trojan-activity; sid:1000003;)\n   ```\n\nINTRUSION ANALYSIS REPORT:\n```\nIntrusion Detection Analysis:\n\nReconnaissance Detected:\n| Source | Type | Targets | Time |\n|--------|------|---------|------|\n| 10.0.0.50 | SYN Scan | 192.168.1.0/24 | 2024-03-14 02:00 |\n| 10.0.0.50 | Service Scan | 192.168.1.100 | 2024-03-14 02:15 |\n\nExploitation Attempts:\n| Source | Target | Attack | Success |\n|--------|--------|--------|--------|\n| 10.0.0.50 | 192.168.1.100:80 | SQL Injection | Yes |\n| 10.0.0.50 | 192.168.1.100:80 | File Upload | Yes |\n\nC2 Communication:\n| Internal | External | Protocol | Interval | Duration |\n|----------|----------|----------|----------|----------|\n| 192.168.1.100 | 185.220.101.1 | HTTPS | 60s | 8 hours |\n| 192.168.1.100 | 91.234.99.42 | DNS TXT | 300s | 6 hours |\n\nLateral Movement:\n| Source | Destination | Method | Timestamp |\n|--------|-------------|--------|----------|\n| 192.168.1.100 | 192.168.1.50 | SMB/PsExec | 2024-03-14 10:30 |\n| 192.168.1.100 | 192.168.1.51 | RDP | 2024-03-14 11:00 |\n\nData Exfiltration:\n| Source | Destination | Volume | Method |\n|--------|-------------|--------|--------|\n| 192.168.1.100 | 185.220.101.1 | 450 MB | HTTPS |\n| 192.168.1.50 | 91.234.99.42 | 2.3 GB | DNS Tunnel |\n\nAttack Timeline:\n02:00 - Reconnaissance scan from 10.0.0.50\n02:15 - Service enumeration\n09:45 - SQL injection exploitation\n09:50 - Webshell upload\n10:00 - C2 established to 185.220.101.1\n10:30 - Lateral movement to 192.168.1.50\n11:00 - Data exfiltration begins\n17:30 - Last observed C2 communication\n```\n\nDETECTION INDICATORS:\n- Attack phases identified\n- C2 patterns detected\n- Lateral movement traced\n- Exfiltration quantified\n\nCOMMON PITFALLS:\n- Missing encrypted C2\n- Not correlating events\n- Ignoring DNS anomalies\n- Missing low-and-slow attacks\n\nFURTHER READING:\n- MITRE ATT&CK Framework\n- Zeek documentation\n- Suricata rules documentation",
      "tags": ["forensics", "network", "intrusion-detection", "ids", "c2", "dfir"],
      "related_tools": ["wireshark", "tcpdump"]
    },
    {
      "id": "network_artifact_correlation",
      "title": "Network Artifact Correlation",
      "content": "OBJECTIVE: Correlate network evidence with host artifacts to build a comprehensive investigation timeline.\n\nACADEMIC BACKGROUND:\nNetwork forensics gains maximum value when correlated with host-based evidence. IP addresses, domains, and timestamps in network traffic must be linked to user activity, malware execution, and system events. This correlation provides attribution and impact assessment.\n\nCORRELATION TECHNIQUES:\n\n1. TIMELINE INTEGRATION:\n   ```bash\n   # Create network timeline from PCAP\n   tshark -r capture.pcap -T fields \\\n          -e frame.time -e ip.src -e ip.dst -e tcp.srcport -e tcp.dstport \\\n          -e http.host -e dns.qry.name \\\n          -E header=y -E separator=, > network_timeline.csv\n   \n   # Zeek timeline\n   cat conn.log | zeek-cut -d ts id.orig_h id.orig_p id.resp_h id.resp_p \\\n          proto service > zeek_timeline.tsv\n   \n   # Combine with host timeline\n   # plaso for host artifacts\n   log2timeline.py timeline.plaso /forensics/evidence.dd\n   psort.py -o l2tcsv timeline.plaso > host_timeline.csv\n   \n   # Merge and sort by timestamp\n   # Look for correlations:\n   # - Process execution -> Network connection\n   # - Browser history -> HTTP/DNS traffic\n   # - File download -> File creation\n   ```\n\n2. IP-TO-HOST CORRELATION:\n   ```bash\n   # Extract IPs from network capture\n   tshark -r capture.pcap -T fields -e ip.src | sort -u > src_ips.txt\n   tshark -r capture.pcap -T fields -e ip.dst | sort -u > dst_ips.txt\n   \n   # Correlate with host artifacts:\n   # - Browser history (History SQLite)\n   # - DNS cache (memory or ipconfig /displaydns)\n   # - Network connections (netstat output)\n   # - Firewall logs\n   \n   # DHCP logs for IP-to-hostname\n   tshark -r capture.pcap -Y dhcp -T fields \\\n          -e dhcp.option.requested_ip_address \\\n          -e dhcp.option.hostname \\\n          -e eth.src\n   \n   # ARP for IP-to-MAC\n   tshark -r capture.pcap -Y arp -T fields \\\n          -e arp.src.hw_mac -e arp.src.proto_ipv4\n   ```\n\n3. DOMAIN CORRELATION:\n   ```bash\n   # Extract domains from DNS\n   tshark -r capture.pcap -Y dns.qry.name -T fields -e dns.qry.name | \\\n          sort -u > domains.txt\n   \n   # Extract from TLS SNI\n   tshark -r capture.pcap -Y \"tls.handshake.type == 1\" -T fields \\\n          -e tls.handshake.extensions_server_name | sort -u >> domains.txt\n   \n   # Extract from HTTP Host headers\n   tshark -r capture.pcap -Y http.host -T fields -e http.host | \\\n          sort -u >> domains.txt\n   \n   # Correlate with:\n   # - Browser history\n   # - Browser cache\n   # - Downloaded files\n   # - Registry (TypedURLs)\n   ```\n\n4. PROCESS-TO-NETWORK CORRELATION:\n   ```bash\n   # From memory forensics\n   # Volatility netscan output\n   volatility -f memory.raw --profile=Win10x64 netscan > netscan.txt\n   \n   # Correlate PID with process info\n   volatility -f memory.raw --profile=Win10x64 pslist > pslist.txt\n   \n   # Join on PID\n   # Network connection -> Process -> Command line -> User\n   \n   # Example correlation:\n   # netscan: PID 4532 -> 185.220.101.1:443\n   # pslist: PID 4532 = powershell.exe\n   # cmdline: powershell -enc [base64]\n   # Parent: WINWORD.EXE (PID 2156)\n   # -> Malicious macro -> PowerShell -> C2\n   ```\n\n5. FILE TRANSFER CORRELATION:\n   ```bash\n   # Extract file hashes from network\n   # HTTP/FTP file transfers\n   tshark -r capture.pcap --export-objects http,/tmp/http_objects/\n   \n   # Hash extracted files\n   find /tmp/http_objects/ -type f -exec sha256sum {} \\; > network_file_hashes.txt\n   \n   # Compare with disk artifacts\n   # Recent files, Downloads folder, Temp folders\n   find /forensics/mounted_image/Users/*/Downloads -type f -exec sha256sum {} \\; > disk_file_hashes.txt\n   \n   # Find matches\n   comm -12 <(sort network_file_hashes.txt | cut -d' ' -f1) \\\n            <(sort disk_file_hashes.txt | cut -d' ' -f1)\n   \n   # Timestamp correlation\n   # Network transfer time -> File creation time\n   ```\n\n6. USER ATTRIBUTION:\n   ```bash\n   # Link network activity to users\n   \n   # From DHCP: IP -> Hostname\n   # From hostname: -> Assigned user\n   \n   # Browser artifacts per user\n   # ~/.config/google-chrome/Default/History\n   # Extract URLs, correlate with HTTP traffic\n   \n   # Login correlation\n   # Network logon (Event 4624 Type 3) -> Source IP\n   # RDP logon (Event 4624 Type 10) -> Source IP\n   \n   # Extract logon events\n   # Correlate timestamp with network traffic\n   ```\n\n7. THREAT INTELLIGENCE CORRELATION:\n   ```bash\n   # Extract IOCs from network\n   # IPs\n   tshark -r capture.pcap -T fields -e ip.dst | sort -u > ips.txt\n   \n   # Domains\n   tshark -r capture.pcap -Y dns.qry.name -T fields -e dns.qry.name | \\\n          sort -u > domains.txt\n   \n   # JA3 hashes\n   tshark -r capture.pcap -Y \"tls.handshake.type == 1\" -T fields \\\n          -e tls.handshake.ja3 | sort -u > ja3.txt\n   \n   # Compare against threat intel\n   # VirusTotal, AbuseIPDB, URLhaus, etc.\n   \n   # Example API check (VirusTotal)\n   for ip in $(cat ips.txt); do\n       curl -s \"https://www.virustotal.com/api/v3/ip_addresses/$ip\" \\\n            -H \"x-apikey: YOUR_API_KEY\" | jq '.data.attributes.last_analysis_stats'\n   done\n   ```\n\n8. COMPREHENSIVE CORRELATION SCRIPT:\n   ```python\n   #!/usr/bin/env python3\n   \"\"\"Network-Host Correlation Script\"\"\"\n   \n   import csv\n   import json\n   from datetime import datetime\n   \n   def load_network_events(pcap_csv):\n       \"\"\"Load network timeline from tshark CSV export\"\"\"\n       events = []\n       with open(pcap_csv, 'r') as f:\n           reader = csv.DictReader(f)\n           for row in reader:\n               events.append({\n                   'timestamp': row['frame.time'],\n                   'type': 'network',\n                   'src_ip': row['ip.src'],\n                   'dst_ip': row['ip.dst'],\n                   'details': row\n               })\n       return events\n   \n   def load_host_events(plaso_csv):\n       \"\"\"Load host timeline from plaso output\"\"\"\n       events = []\n       with open(plaso_csv, 'r') as f:\n           reader = csv.DictReader(f)\n           for row in reader:\n               events.append({\n                   'timestamp': row['datetime'],\n                   'type': 'host',\n                   'source': row['source'],\n                   'details': row\n               })\n       return events\n   \n   def correlate_events(network_events, host_events, time_window=60):\n       \"\"\"Find network events close in time to host events\"\"\"\n       correlations = []\n       for net_event in network_events:\n           for host_event in host_events:\n               # Compare timestamps within window\n               # Add to correlations if related\n               pass\n       return correlations\n   \n   if __name__ == '__main__':\n       network = load_network_events('network_timeline.csv')\n       host = load_host_events('host_timeline.csv')\n       results = correlate_events(network, host)\n       print(json.dumps(results, indent=2))\n   ```\n\nCORRELATION REPORT:\n```\nNetwork-Host Correlation Analysis:\n\nAttack Chain Reconstruction:\n\n1. Initial Compromise (2024-03-14 09:45:00)\n   Network: HTTP POST to 10.0.0.50:80 (SQLi payload)\n   Host: Apache error log shows SQL error\n   Correlation: Attack source confirmed\n\n2. Payload Delivery (2024-03-14 09:50:00)\n   Network: HTTP upload to /uploads/shell.php\n   Host: File created C:\\inetpub\\wwwroot\\uploads\\shell.php\n   File hash match: SHA256 abc123...\n\n3. C2 Establishment (2024-03-14 10:00:00)\n   Network: HTTPS to 185.220.101.1:443 (every 60s)\n   Host: Process powershell.exe (PID 4532)\n   Memory: Network connection in netscan matches\n\n4. Lateral Movement (2024-03-14 10:30:00)\n   Network: SMB to 192.168.1.50 (ADMIN$ access)\n   Host: Event 4624 (Network logon from 192.168.1.100)\n   Host: New service installed (Event 7045)\n\n5. Data Exfiltration (2024-03-14 11:00-17:30)\n   Network: 450 MB to 185.220.101.1 via HTTPS\n   Host: Accessed files in C:\\Confidential\\\n   Registry: RecentDocs shows file access\n\nUser Attribution:\n- Compromised account: jsmith\n- Workstation: WORKSTATION-01\n- IP: 192.168.1.100\n\nIOCs Correlated:\n| Indicator | Network Evidence | Host Evidence |\n|-----------|------------------|---------------|\n| 185.220.101.1 | netscan, pcap | Registry, prefetch |\n| shell.php | HTTP upload | File on disk |\n| mimikatz.exe | None (memory only) | Prefetch, process |\n```\n\nDETECTION INDICATORS:\n- Attack phases correlated\n- Timeline unified\n- Attribution established\n- IOCs cross-referenced\n\nCOMMON PITFALLS:\n- Time zone mismatches\n- Missing correlation artifacts\n- Incomplete timeline\n- Not validating correlations\n\nFURTHER READING:\n- \"Network Forensics\" by Ric Messier\n- SANS FOR572 course\n- Plaso/log2timeline documentation",
      "tags": ["forensics", "network", "correlation", "timeline", "attribution", "dfir"],
      "related_tools": ["wireshark", "bulk_extractor"]
    }
  ]
}
